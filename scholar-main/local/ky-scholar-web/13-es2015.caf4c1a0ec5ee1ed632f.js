(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"YDg+":function(t,e,n){"use strict";n.r(e),n.d(e,"ResourceManageModule",(function(){return gn}));var i=n("PCNd"),o=n("tyNb"),a=n("mrSG"),c=n("fXoL"),r=n("+O+V"),s=n("Vhue"),l=n("cp0P"),d=n("PqYM"),h=n("qjn6"),g=n("WTGI"),u=n("wsOq"),p=n("AytR"),f=n("Fmhi"),b=n("pz6Z"),m=n("dEAy"),z=n("PScX"),P=n("uMH2"),C=n("19W7"),v=n("ofXK"),y=n("Nqz0"),w=n("Q8cG"),O=n("B+r4"),k=n("1zMu"),M=n("C2AL"),_=n("FwiY"),x=n("PTRe"),S=n("3Pt+"),E=n("zAKX"),I=n("OzZK"),T=n("RwU8"),Z=n("rMZv"),L=n("wyWf"),R=n("aeXB"),D=n("nJia"),N=n("xKc1"),j=n.n(N),F=function(){function t(t){this.elementRef=t,this.background="white",this.backgroundAlpha=1,this.foreground="black",this.foregroundAlpha=1,this.level="L",this.mime="image/png",this.padding=null,this.size=100,this.value="",this.canvas=!1}return t.prototype.ngOnChanges=function(t){("background"in t||"backgroundAlpha"in t||"foreground"in t||"foregroundAlpha"in t||"level"in t||"mime"in t||"padding"in t||"size"in t||"value"in t||"canvas"in t)&&this.generate()},t.prototype.generate=function(){try{var t=this.elementRef.nativeElement;t.innerHTML="";var e=new j.a({background:this.background,backgroundAlpha:this.backgroundAlpha,foreground:this.foreground,foregroundAlpha:this.foregroundAlpha,level:this.level,mime:this.mime,padding:this.padding,size:this.size,value:this.value});t.appendChild(this.canvas?e.canvas:e.image)}catch(n){console.error("Could not generate QR Code: "+n.message)}},t.\u0275fac=function(e){return new(e||t)(c.Ub(c.l))},t.\u0275cmp=c.Ob({type:t,selectors:[["qr-code"]],inputs:{background:"background",backgroundAlpha:"backgroundAlpha",foreground:"foreground",foregroundAlpha:"foregroundAlpha",level:"level",mime:"mime",padding:"padding",size:"size",value:"value",canvas:"canvas"},features:[c.Cb],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t}(),A=function(){function t(){}return t.\u0275mod=c.Sb({type:t}),t.\u0275inj=c.Rb({factory:function(e){return new(e||t)}}),t}(),U=n("u2sS");const V=["treeContainer"];function q(t,e){if(1&t){const t=c.bc();c.ac(0,"qkc-change-profession",51),c.ic("professionChange",(function(e){return c.Ec(t),c.lc().professionChange(e)})),c.Zb()}if(2&t){const t=c.lc();c.tc("select",t.selected)("hidden","scp"===t.from)}}function B(t,e){if(1&t){const t=c.bc();c.ac(0,"button",52),c.ic("click",(function(){return c.Ec(t),c.lc().goback()})),c.Pc(1,"\u5b8c\u6210\u8c03\u7528"),c.Zb()}}function G(t,e){if(1&t&&(c.ac(0,"button",53),c.Pc(1,"\u65b0\u589e\u9605\u8bfb "),c.Zb()),2&t){c.lc();const t=c.Cc(9);c.tc("nzDropdownMenu",t)}}function X(t,e){if(1&t){const t=c.bc();c.Yb(0),c.ac(1,"li",54),c.ic("click",(function(){c.Ec(t);const n=e.$implicit;return c.lc().selectMenu(n)})),c.Pc(2),c.Zb(),c.Xb()}if(2&t){const t=e.$implicit;c.Eb(2),c.Qc(null==t?null:t.name)}}function $(t,e){if(1&t){const t=c.bc();c.ac(0,"qkc-tree-knowledgegraph",55),c.ic("nodeChange",(function(e){return c.Ec(t),c.lc().nodeChange(e)})),c.Zb()}if(2&t){const t=c.lc();c.tc("professionId",null==t.selectedProfesson?null:t.selectedProfesson.id)("allNodes",!0)}}function W(t,e){if(1&t){const t=c.bc();c.ac(0,"button",56),c.ic("click",(function(){return c.Ec(t),c.lc().resetData()})),c.Pc(1," \u91cd\u7f6e "),c.Zb()}}function H(t,e){if(1&t){const t=c.bc();c.ac(0,"a",64),c.ic("click",(function(){c.Ec(t);const e=c.lc(2).$implicit;return c.lc().del(e)})),c.Pc(1,"\u5220\u9664"),c.Zb()}}function K(t,e){if(1&t){const t=c.bc();c.ac(0,"td",61),c.ac(1,"a",62),c.ic("click",(function(){c.Ec(t);const e=c.lc().$implicit;return c.lc().preview(e)})),c.Pc(2,"\u9884\u89c8 "),c.Zb(),c.ac(3,"a",62),c.ic("click",(function(){c.Ec(t);const e=c.lc().$implicit;return c.lc().edit(e)})),c.Pc(4,"\u7f16\u8f91 "),c.Zb(),c.ac(5,"a",62),c.ic("click",(function(){c.Ec(t);const e=c.lc().$implicit;return c.lc().qcode(e)})),c.Pc(6,"\u4e8c\u7ef4\u7801 "),c.Zb(),c.Nc(7,H,2,0,"a",63),c.Zb()}if(2&t){const t=c.lc().$implicit,e=c.lc();c.Eb(7),c.tc("ngIf",e.delIF(t))}}function Q(t,e){if(1&t){const t=c.bc();c.ac(0,"a",62),c.ic("click",(function(){c.Ec(t);const e=c.lc(2),n=e.$implicit,i=e.index;return c.lc().callResource(n,i)})),c.Pc(1,"\u8c03\u7528"),c.Zb()}}function J(t,e){if(1&t){const t=c.bc();c.ac(0,"a",64),c.ic("click",(function(){c.Ec(t);const e=c.lc(2),n=e.$implicit,i=e.index;return c.lc().cancelCallResource(n,i)})),c.Pc(1," \u53d6\u6d88\u8c03\u7528 "),c.Zb()}}function Y(t,e){if(1&t){const t=c.bc();c.ac(0,"a",64),c.ic("click",(function(){c.Ec(t);const e=c.lc(2),n=e.$implicit,i=e.index;return c.lc().cancelCallResource(n,i)})),c.Pc(1," \u53d6\u6d88\u8c03\u7528 "),c.Zb()}}function tt(t,e){1&t&&(c.ac(0,"a",67),c.Pc(1," \u5df2\u8c03\u7528 "),c.Zb())}function et(t,e){if(1&t){const t=c.bc();c.ac(0,"td",61),c.ac(1,"a",62),c.ic("click",(function(){c.Ec(t);const e=c.lc().$implicit;return c.lc().preview(e)})),c.Pc(2,"\u9884\u89c8 "),c.Zb(),c.Nc(3,Q,2,0,"a",65),c.Nc(4,J,2,0,"a",63),c.Nc(5,Y,2,0,"a",63),c.Nc(6,tt,2,0,"a",66),c.Zb()}if(2&t){const t=c.lc().$implicit,e=c.lc();c.Eb(3),c.tc("ngIf",!t.isCall&&t.supportType&&e.permitedCall),c.Eb(1),c.tc("ngIf",t.isCall&&!e.callResourceData.isStandard),c.Eb(1),c.tc("ngIf",t.isCall&&e.callResourceData.isStandard&&"4"===t.taskType),c.Eb(1),c.tc("ngIf",t.isCall&&e.callResourceData.isStandard&&"4"!==t.taskType)}}function nt(t,e){if(1&t&&(c.ac(0,"tr"),c.ac(1,"td"),c.ac(2,"span",57),c.Pc(3),c.Zb(),c.Zb(),c.ac(4,"td"),c.Pc(5),c.Zb(),c.ac(6,"td",58),c.ac(7,"span",59),c.Pc(8),c.Zb(),c.Zb(),c.ac(9,"td"),c.Pc(10),c.Zb(),c.ac(11,"td"),c.Pc(12),c.Zb(),c.ac(13,"td"),c.Pc(14),c.Zb(),c.ac(15,"td"),c.Pc(16),c.Zb(),c.ac(17,"td"),c.Pc(18),c.Zb(),c.Nc(19,K,8,1,"td",60),c.Nc(20,et,7,4,"td",60),c.Zb()),2&t){const t=e.$implicit,n=c.lc();c.Eb(3),c.Qc(null==t?null:t.title),c.Eb(2),c.Qc(n.getName(null==t?null:t.type,"MATERIAL_TYPE")),c.Eb(2),c.tc("nzTooltipTitle",null==t?null:t.pointName),c.Eb(1),c.Qc(null==t?null:t.pointName),c.Eb(2),c.Qc(n.getName(null==t?null:t.learningGoalCode,"LEARNING_TARGET")),c.Eb(2),c.Qc(null==t?null:t.createrName),c.Eb(2),c.Qc(null==t?null:t.authorName),c.Eb(2),c.Qc(n.getDate(null==t?null:t.lastModifiedTime)),c.Eb(2),c.Qc(null==t?null:t.useTime),c.Eb(1),c.tc("ngIf",""==n.from),c.Eb(1),c.tc("ngIf","scp"==n.from)}}function it(t,e){1&t&&c.Pc(0),2&t&&c.Rc("\u5171 ",e.$implicit," \u6761\u8bb0\u5f55")}function ot(t,e){if(1&t&&c.Vb(0,"qr-code",68),2&t){const t=c.lc();c.tc("value",t.qrcode)("size",t.size)}}function at(t,e){if(1&t){const t=c.bc();c.ac(0,"app-resource-preview-modal",69),c.ic("closePreview",(function(){return c.Ec(t),c.lc().closePreview()})),c.Zb()}if(2&t){const t=c.lc();c.tc("isPreviewpolyway",t.isPreviewpolyway)("previewTitle",t.previewTitle)("resourceUrl",t.resourceUrl)}}const ct=function(t){return{x:"1300px",y:t}},rt=function(){return[15,20,30,40,50]};let st=(()=>{class t extends h.l{constructor(t,e,n,i,o,a,c,s){super(),this.materialLibService=t,this.menuService=e,this.modalService=n,this.message=i,this.courseMgService=o,this.route=a,this.statisticsLogService=c,this.locale=s,this._PAGE_ID_="MaterialReadLibraryComponent",this.id=-1,this.materialMenus=r.g.filter(t=>"104"!==t.id),this.knowledgePointId="",this.from="",this.callResourceData={},this.callResourceId="MaterialCallResource",this.permitedCall=!0,this.type="0",this.fileType="0",this.selected="",this.getTwoWords=g.a.getTwoWords,this.getName=r.k,this.conditionObj={category:100,knowledgeSubjectId:"",knowledgeModuleId:"",knowledgeUnitId:"",knowledgePointId:"",condition:"",coursewareType:[],learningGoalCode:[]},this.condition="",this.coursewareType=[],this.learningGoalCode=[],this.init=!1,this.knowledgegraphTree=!0,this.changeProfession=!0,this.previewTitle="",this.isPreviewpolyway=!1,this.previewStart=!1,this.order=null,this.qrcode="",this.qrName="",this.size=200}initData(){this.selected=s.a.getReadtree()||s.a.getPacketInfoItem("code");const{from:t,task:e,reward:n}=this.route.snapshot.queryParams;this.task=e,this.reward=n,"scp"===t&&(this.from=t,"101"===this.task||"102"===this.task?(this.conditionObj.coursewareType=[this.task],this.coursewareType=[this.task]):(this.conditionObj.coursewareType=["101","102","103"],this.coursewareType=["101","102","103"]),this.storingData(),this.callResourceData=s.a.getScpResourceMaterial())}collectParam(){const{condition:t,learningGoalCode:e,coursewareType:n}=s.a.getSearch(this._PAGE_ID_);this.condition=t||"",this.learningGoalCode=e||[],this.coursewareType=n||[]}sybcParam(){this.conditionObj.condition=this.condition,this.conditionObj.coursewareType=this.coursewareType,this.conditionObj.learningGoalCode=this.learningGoalCode}storingData(){const{condition:t,coursewareType:e,learningGoalCode:n}=this;this.passData({condition:t,learningGoalCode:n,coursewareType:e})}resetInit(){this.condition="",this.coursewareType=[],this.learningGoalCode=[],this.conditionObj.coursewareType=[],this.conditionObj.learningGoalCode=[],this.conditionObj.condition=""}getDataList(){this.conditionObj.condition=this.conditionObj.condition.trim();const t=Object.assign(Object.assign({},this.conditionObj),{page:this.pageIndex,limit:this.pageSize});this.order&&(t.sort="ascend"===this.order?"useTime|asc":"useTime|desc"),this.conditionObj.coursewareType.length||(t.coursewareType=["101","102","103"]);const e=t=>{this.isLoading=!1,200===t.status?t.data&&t.data.records&&t.data.records.length?(this.data=t.data.records,this.total=t.data.total,"scp"===this.from&&this.callResourceData.nodes&&(this.data=this.data.map(t=>{const e=this.callResourceData.nodes.find(e=>e.id===t.id);return e?(t.isCall=!0,t.taskId=e.taskId,t.taskType=e.taskType):t.taskType="-1",t.supportType=this.supportType(t.fileType),t}),this.setPermitedCall())):(this.data=[],this.total=0):(this.data=[],this.total=0,this.message.create("error",t.message))},n=t=>{this.isLoading=!1,this.message.create("error",JSON.stringify(t))};this.isLoading=!0;const i=[this.materialLibService.resConditionQuery(t)];Object(l.a)(i).subscribe(t=>{this.isLoading=!1,e(t[0])},t=>{this.isLoading=!1,n(t)})}ngOnAttach(){this.selected=s.a.getReadtree()||s.a.getPacketInfoItem("code"),this.collectParam(),this.sybcParam(),this.init=!1,this.knowledgegraphTree=!1,this.changeProfession=!1,Object(d.a)(0).subscribe(()=>{this.knowledgegraphTree=!0,this.changeProfession=!0})}onResize({width:t}){const e=this.treeContainer&&this.treeContainer.nativeElement&&this.treeContainer.nativeElement.offsetWidth;e&&this.treeContainer.nativeElement.offsetWidth+50<t||e&&this.treeContainer.nativeElement.offsetWidth+10>t||(cancelAnimationFrame(this.id),this.id=requestAnimationFrame(()=>{this.width=t}))}professionChange(t){s.a.putReadtree(t.code),this.selectedProfesson=t,this.conditionObj.knowledgeSubjectId=t.id,this.init?(this.pageIndex=1,this.searchData()):(this.init=!0,this.searchData("collect"))}nodeChange(t){"1"===t.kType?(this.conditionObj.knowledgeSubjectId=t.id,this.conditionObj.knowledgeModuleId="",this.conditionObj.knowledgeUnitId="",this.conditionObj.knowledgePointId=""):"2"===t.kType?(this.conditionObj.knowledgeSubjectId="",this.conditionObj.knowledgeModuleId=t.id,this.conditionObj.knowledgeUnitId="",this.conditionObj.knowledgePointId=""):"3"===t.kType?(this.conditionObj.knowledgeSubjectId="",this.conditionObj.knowledgeModuleId="",this.conditionObj.knowledgeUnitId=t.id,this.conditionObj.knowledgePointId=""):"4"===t.kType&&(this.conditionObj.knowledgeSubjectId="",this.conditionObj.knowledgeModuleId="",this.conditionObj.knowledgeUnitId="",this.conditionObj.knowledgePointId=t.id,this.knowledgePointId=t.id),this.pageIndex=1,this.searchData()}selectMenu(t){if(!this.selectedProfesson)return this.message.error("\u8fd8\u6ca1\u6709\u5efa\u7acb\u5b66\u79d1\u54e6~");this.menuService.gotoUrl({url:"/m/rm/material-details",paramUrl:`/0/${t.id}/${this.selectedProfesson?this.selectedProfesson.id:0}?knowledgeId=${this.conditionObj.knowledgePointId||""}&t=${(new Date).getTime()}`,title:"\u65b0\u589e"+t.name})}edit(t){this.menuService.gotoUrl({url:"/m/rm/material-details",paramUrl:`/${t.id}/${t.type}/${this.selectedProfesson.id}`})}qcode(t){this.materialLibService.getResourceDetail(t.id,t.type).subscribe(e=>{200===e.status&&(this.qrName=e.data.title,this.qrcode="2"===t.sourceType?p.a.ow365.substr(0,p.a.ow365.length-5)+"polywayId="+e.data.resourceUrl+"&share=0&native=0&ow365=1":p.a.ow365+p.a.OSS_URL+("0"===e.data.resourceUrl.indexOf("/")?e.data.resourceUrl:"/"+e.data.resourceUrl)+"&share=0&native=0&ow365=1",this.qrcodeVisible=!0,console.log(this.qrcode))})}goback(){this.menuService.goBack(!1),this.menuService.gotoUrl({title:"\u8bfe\u5305\u5efa\u8bbe",url:"/m/course-manage/prepare-course",paramUrl:""})}preview(t){t.title.indexOf(".")<0&&"2"===t.sourceType&&"103"===t.type?(this.isPreviewpolyway=!1,this.previewStart=!1,Object(d.a)(0).subscribe(()=>{this.resourceUrl=t.fileType,this.previewTitle="",this.isPreviewpolyway=!0,this.previewStart=!0})):this.materialLibService.getResourceDetail(t.id,t.type).subscribe(e=>{200===e.status&&(e.data.attachmentName.indexOf(".")<0&&"2"===e.data.sourceType&&"103"===t.type?(this.previewStart=!1,this.isPreviewpolyway=!1,Object(d.a)(0).subscribe(()=>{this.resourceUrl=t.fileType,this.previewTitle="",this.isPreviewpolyway=!0,this.previewStart=!0})):(this.previewStart=!1,this.isPreviewpolyway=!1,Object(d.a)(0).subscribe(()=>{this.isPreviewpolyway=!1,this.resourceUrl=e.data.resourceUrl,this.previewTitle=e.data.title,this.previewStart=!0})))})}closePreview(){this.isPreviewpolyway=!1,this.resourceUrl="",this.previewTitle="",this.previewStart=!1}del(t,e){return new Promise(e=>{this.materialLibService.delResource(t.id).subscribe(t=>{200===t.status?(e(!0),this.searchData()):(e(!1),500===t.status&&this.message.error("\u670d\u52a1\u7aef\u4e1a\u52a1\u5f02\u5e38"))},t=>{e(!1),this.message.error(JSON.stringify(t))})})}setPermitedCall(){this.callResourceData.hasOwnProperty("limit")&&(this.permitedCall=0===Number(this.callResourceData.limit)||!(this.callResourceData.nodes.length>=this.callResourceData.limit||-1===Number(this.callResourceData.limit)))}supportType(t){return!t||!this.callResourceData.supportFileType||-1!==this.callResourceData.supportFileType.indexOf(t.toLowerCase())}callResource(t,e){const n=(()=>{if("scp-section-handout"===this.callResourceData.type)return Object.assign(Object.assign({},this.callResourceData.sectionInfo),{resourceId:t.id})})();"1"===this.task?(n.sourceType=t.sourceType,n.name=t.title,n.taskType="0",n.downloadType="0"):("2"===this.task||(n.sourceType=t.sourceType,n.downloadType="101"===this.task?"0":"2",n.resourceId=t.id,n.type=this.task,n.category=t.category),n.title=t.title),n.seq=s.a.getScpResourceMaterial().seq;const i=(t=>{if("scp-section-handout"===this.callResourceData.type)return"1"===this.task?this.courseMgService.invoke_courseSectionFileTask(t):"2"===this.task?this.courseMgService.levelInformationAddAndModify(t):this.courseMgService.invoke_courseSectionFile(t)})(n);this.isLoading=!0,i.subscribe(t=>{if(this.isLoading=!1,201===t.status){const{task:i}=this;let o="";o="1"===i?"learnSet-task-action":"101"===i?"learnSet-lecture-action":"104"===i?"learnSet-material-action":"learnSet-record-action",this.statisticsLogService.statisticsPacketInfoLog("1"===this.reward?{name:"\u5173\u5361\u5956\u52b1\u8bbe\u7f6e\u9605\u8bfb\u5e93\u8c03\u7528",actionCode:r.j.packetInfo["otherSet-levelthrough-action"].modify,content:JSON.stringify(n)}:{name:"\u9605\u8bfb\u5e93\u8c03\u7528",actionCode:r.j.packetInfo[o].addCode,content:JSON.stringify(n)}),t.data&&t.data.id&&(this.data[e].isCall=!0,this.data[e].taskId=t.data.id,this.data[e].taskType=t.data.taskType,this.callResourceData.nodes.push({id:this.data[e].id,taskId:t.data.id,taskType:t.data.taskType}),this.callResourceData.seq+=1,s.a.putScpResourceMaterial(this.callResourceData),this.setPermitedCall())}else this.message.error(500===t.status?"\u670d\u52a1\u5668\u4e1a\u52a1\u5f02\u5e38\u5bfc\u81f4\u8c03\u7528\u5931\u8d25\uff0c\u53ef\u80fd\u6807\u9898\u592a\u957f\uff0c\u8bf7\u4fdd\u630135\u5b57\u7b26\u4ee5\u5185":t.message)},t=>{this.isLoading=!1,this.message.warning(JSON.stringify(t))})}cancelCallResource(t,e){this.modalService.warning({nzTitle:"\u8b66\u544a",nzContent:"2"===this.task?"\u786e\u5b9a\u53d6\u6d88\u8c03\u7528\u5417\uff1f":"\u5220\u9664\u8be5\u8d44\u6e90\u5c06\u4f1a\u5bfc\u81f4\u73b0\u6709\u7684\u8bb0\u5f55\u4e22\u5931\uff0c\u786e\u5b9a\u5220\u9664\u5417\uff1f",nzCancelText:"\u53d6\u6d88",nzOkText:"\u786e\u5b9a",nzOnOk:()=>new Promise(n=>{this.isLoading=!0,(()=>{if("scp-section-handout"===this.callResourceData.type)return"1"===this.task?this.courseMgService.del_courseSectionFileTask(t.taskId):"2"===this.task?this.courseMgService.levelDataDeletion(t.taskId):this.courseMgService.del_courseSectionFile(t.taskId)})().subscribe(i=>{if(this.isLoading=!1,204===i.status){if("1"===this.reward)this.statisticsLogService.statisticsPacketInfoLog({name:"\u5173\u5361\u5956\u52b1\u8bbe\u7f6e\u9605\u8bfb\u5e93\u53d6\u6d88\u8c03\u7528",actionCode:r.j.packetInfo["otherSet-levelthrough-action"].modify,content:t.taskId});else{const{task:e}=this;let n="";n="1"===e?"learnSet-task-action":"101"===e?"learnSet-lecture-action":"104"===e?"learnSet-material-action":"learnSet-record-action",this.statisticsLogService.statisticsPacketInfoLog({name:"\u9605\u8bfb\u5e93\u53d6\u6d88\u8c03\u7528",actionCode:r.j.packetInfo[n].delCode,content:t.taskId})}this.data[e].isCall=!1,this.callResourceData.nodes=this.callResourceData.nodes.filter(t=>t.id!==this.data[e].id),this.callResourceData.seq-=1,s.a.putScpResourceMaterial(this.callResourceData),this.setPermitedCall(),n(!0)}else this.message.warning(i.message||"\u5220\u9664\u5931\u8d25"),n(!1)},t=>{this.isLoading=!1,this.message.warning(JSON.stringify(t)),n(!1)})})})}nzSortOtrderChange(t){this.order=t,this.getDataList()}delIF(t){return"0"===String(t.useTime)}downloadQrcode(){const t=document.createElement("a");t.setAttribute("href",document.querySelector("#qr-code > img").src),t.setAttribute("download",(this.qrName.indexOf(".")>-1?this.qrName.split(".")[0]:this.qrName)+".png"),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(f.a),c.Ub(b.a),c.Ub(m.e),c.Ub(z.e),c.Ub(P.a),c.Ub(o.a),c.Ub(C.a),c.Ub(c.u))},t.\u0275cmp=c.Ob({type:t,selectors:[["app-read-lib"]],viewQuery:function(t,e){var n;1&t&&c.Vc(V,!0),2&t&&c.Bc(n=c.jc())&&(e.treeContainer=n.first)},features:[c.Bb],decls:80,vars:36,consts:[[1,"container"],[1,"header"],[1,"title"],[3,"select","hidden","professionChange",4,"ngIf"],["nz-button","","nzType","primary","class","margin-btn",3,"click",4,"ngIf"],["nz-dropdown","","nzTrigger","click","nz-button","","nzType","primary","class","margin-btn",3,"nzDropdownMenu",4,"ngIf"],["menu","nzDropdownMenu"],["nz-menu",""],[4,"ngFor","ngForOf"],["nz-row","",1,"resource-container"],["nz-resizable","",1,"left-tree",3,"nzResize"],[2,"display","inline-block","overflow","hidden","margin-right","30px"],["treeContainer",""],["model","click",3,"professionId","allNodes","nodeChange",4,"ngIf"],["nzDirection","right"],[1,"right-wrap"],["nz-icon","","nzType","more","nzTheme","outline",1,"right"],[1,"right-resource"],[1,"search-container"],[1,"list"],[1,"list-title"],["nz-input","","placeholder","\u652f\u6301\u6807\u9898",2,"width","200px",3,"ngModel","ngModelChange","keyup.enter"],[1,"list-title",2,"margin-left","40px"],["nzShowSearch","","nzAllowClear","","nzPlaceHolder","\u8bf7\u9009\u62e9\u8d44\u6e90\u7c7b\u578b","nzMode","multiple",2,"width","200px",3,"ngModel","ngModelChange"],["nzValue","101","nzLabel","\u8bb2\u4e49"],["nzValue","102","nzLabel","\u8d44\u6599"],["nzValue","103","nzLabel","\u89c6\u9891"],["nzMode","multiple","nzShowSearch","",1,"list-input",2,"width","200px",3,"ngModel","ngModelChange"],["nzValue","1","nzLabel","\u4e86\u89e3"],["nzValue","2","nzLabel","\u7406\u89e3"],["nzValue","3","nzLabel","\u638c\u63e1"],["nzValue","4","nzLabel","\u5e94\u7528"],["nzValue","5","nzLabel","\u5206\u6790"],["nzValue","6","nzLabel","\u521b\u65b0"],["nz-button","","nzType","primary",2,"margin-left","40px",3,"click"],["nz-button","","nzType","primary","style","margin-left: 20px;",3,"click",4,"ngIf"],["id","tableScroll",1,"table-container"],[3,"nzData","nzFrontPagination","nzScroll","nzShowSizeChanger","nzShowTotal","nzLoading","nzTotal","nzPageIndex","nzPageSizeOptions","nzPageSize","nzPageIndexChange","nzPageSizeChange"],["ajaxTable",""],[1,"source-header"],["nzWidth","220px"],["nzWidth","120px"],["nzWidth","100px",3,"nzShowSort","nzSortOrder","nzSortOrderChange"],["nzWidth","160px","nzRight",""],["totalTemplate",""],["nzTitle","\u751f\u6210\u4e8c\u7ef4\u7801",3,"nzVisible","nzFooter","nzVisibleChange","nzOnCancel"],[2,"display","flex","justify-content","center","margin-bottom","10px","font-size","18px"],[2,"display","flex","justify-content","center"],["id","qr-code",3,"value","size",4,"ngIf"],["nz-button","",2,"margin","20px 0",3,"nzType","click"],[3,"isPreviewpolyway","previewTitle","resourceUrl","closePreview",4,"ngIf"],[3,"select","hidden","professionChange"],["nz-button","","nzType","primary",1,"margin-btn",3,"click"],["nz-dropdown","","nzTrigger","click","nz-button","","nzType","primary",1,"margin-btn",3,"nzDropdownMenu"],["nz-menu-item","",3,"click"],["model","click",3,"professionId","allNodes","nodeChange"],["nz-button","","nzType","primary",2,"margin-left","20px",3,"click"],[1,"synopsis-text"],[2,"cursor","pointer"],["nz-tooltip","",1,"synopsis-text",3,"nzTooltipTitle"],["nzRight","",4,"ngIf"],["nzRight",""],[3,"click"],["class","light-color",3,"click",4,"ngIf"],[1,"light-color",3,"click"],[3,"click",4,"ngIf"],["style","color: #999;",4,"ngIf"],[2,"color","#999"],["id","qr-code",3,"value","size"],[3,"isPreviewpolyway","previewTitle","resourceUrl","closePreview"]],template:function(t,e){if(1&t&&(c.ac(0,"div",0),c.ac(1,"section",1),c.ac(2,"div",2),c.Pc(3),c.Nc(4,q,1,2,"qkc-change-profession",3),c.Zb(),c.ac(5,"div"),c.Nc(6,B,2,0,"button",4),c.Nc(7,G,2,1,"button",5),c.ac(8,"nz-dropdown-menu",null,6),c.ac(10,"ul",7),c.Nc(11,X,3,1,"ng-container",8),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.ac(12,"section",9),c.ac(13,"section",10),c.ic("nzResize",(function(t){return e.onResize(t)})),c.ac(14,"div",11,12),c.Nc(16,$,1,2,"qkc-tree-knowledgegraph",13),c.Zb(),c.ac(17,"nz-resize-handle",14),c.ac(18,"div",15),c.Vb(19,"i",16),c.Zb(),c.Zb(),c.Zb(),c.ac(20,"section",17),c.ac(21,"section",18),c.ac(22,"div",19),c.ac(23,"div",20),c.Pc(24,"\u5173\u952e\u8bcd\u641c\u7d22\uff1a"),c.Zb(),c.ac(25,"input",21),c.ic("ngModelChange",(function(t){return e.condition=t}))("keyup.enter",(function(){return e.searchData("button")}))("ngModelChange",(function(){return e.storingData()})),c.Zb(),c.ac(26,"div",22),c.Pc(27,"\u8d44\u6e90\u7c7b\u578b\uff1a"),c.Zb(),c.ac(28,"nz-select",23),c.ic("ngModelChange",(function(t){return e.coursewareType=t}))("ngModelChange",(function(){return e.storingData()})),c.Vb(29,"nz-option",24),c.Vb(30,"nz-option",25),c.Vb(31,"nz-option",26),c.Zb(),c.ac(32,"div",22),c.Pc(33,"\u5b66\u4e60\u76ee\u6807\uff1a"),c.Zb(),c.ac(34,"nz-select",27),c.ic("ngModelChange",(function(t){return e.learningGoalCode=t}))("ngModelChange",(function(){return e.storingData()})),c.Vb(35,"nz-option",28),c.Vb(36,"nz-option",29),c.Vb(37,"nz-option",30),c.Vb(38,"nz-option",31),c.Vb(39,"nz-option",32),c.Vb(40,"nz-option",33),c.Zb(),c.ac(41,"button",34),c.ic("click",(function(){return e.searchData("button")})),c.Pc(42,"\u67e5\u8be2"),c.Zb(),c.Nc(43,W,2,0,"button",35),c.Zb(),c.Zb(),c.ac(44,"section",36),c.ac(45,"nz-table",37,38),c.ic("nzPageIndexChange",(function(t){return e.pageIndex=t}))("nzPageSizeChange",(function(t){return e.pageSize=t}))("nzPageIndexChange",(function(){return e.searchData()}))("nzPageSizeChange",(function(){return e.searchData()})),c.ac(47,"thead",39),c.ac(48,"tr"),c.ac(49,"th",40),c.Pc(50,"\u6807\u9898"),c.Zb(),c.ac(51,"th",41),c.Pc(52,"\u8d44\u6e90\u7c7b\u578b"),c.Zb(),c.ac(53,"th",40),c.Pc(54,"\u77e5\u8bc6\u70b9"),c.Zb(),c.ac(55,"th",41),c.Pc(56,"\u5b66\u4e60\u76ee\u6807"),c.Zb(),c.ac(57,"th",41),c.Pc(58,"\u521b\u5efa\u8005"),c.Zb(),c.ac(59,"th",41),c.Pc(60,"\u4f5c\u8005"),c.Zb(),c.ac(61,"th",41),c.Pc(62,"\u66f4\u65b0\u65f6\u95f4"),c.Zb(),c.ac(63,"th",42),c.ic("nzSortOrderChange",(function(t){return e.nzSortOtrderChange(t)})),c.Pc(64,"\u4f7f\u7528\u6b21\u6570 "),c.Zb(),c.ac(65,"th",43),c.Pc(66,"\u64cd\u4f5c"),c.Zb(),c.Zb(),c.Zb(),c.ac(67,"tbody"),c.Nc(68,nt,21,11,"tr",8),c.Zb(),c.Zb(),c.Zb(),c.Nc(69,it,1,1,"ng-template",null,44,c.Oc),c.Zb(),c.Zb(),c.Zb(),c.ac(71,"nz-modal",45),c.ic("nzVisibleChange",(function(t){return e.qrcodeVisible=t}))("nzOnCancel",(function(){return e.qrcodeVisible=!1})),c.ac(72,"div",46),c.Pc(73),c.Zb(),c.ac(74,"div",47),c.Nc(75,ot,1,2,"qr-code",48),c.Zb(),c.ac(76,"div",47),c.ac(77,"button",49),c.ic("click",(function(){return e.downloadQrcode()})),c.Pc(78,"\u4e0b\u8f7d\u4e8c\u7ef4\u7801\u56fe\u7247"),c.Zb(),c.Zb(),c.Zb(),c.Nc(79,at,1,3,"app-resource-preview-modal",50)),2&t){const t=c.Cc(46),n=c.Cc(70);c.Eb(3),c.Rc(" ",null==e.selectedProfesson?null:e.selectedProfesson.name," "),c.Eb(1),c.tc("ngIf",e.changeProfession),c.Eb(2),c.tc("ngIf","scp"===e.from),c.Eb(1),c.tc("ngIf",""===e.from),c.Eb(4),c.tc("ngForOf",e.materialMenus),c.Eb(2),c.Mc("width",e.width,"px"),c.Eb(3),c.tc("ngIf",e.knowledgegraphTree),c.Eb(9),c.tc("ngModel",e.condition),c.Eb(3),c.tc("ngModel",e.coursewareType),c.Eb(6),c.tc("ngModel",e.learningGoalCode),c.Eb(9),c.tc("ngIf","scp"!==e.from),c.Eb(1),c.Kb("no-scoll",!e.data.length),c.Eb(1),c.tc("nzData",e.data)("nzFrontPagination",!1)("nzScroll",c.xc(33,ct,e.height+"px"))("nzShowSizeChanger",!0)("nzShowTotal",n)("nzLoading",e.isLoading)("nzTotal",e.total)("nzPageIndex",e.pageIndex)("nzPageSizeOptions",c.wc(35,rt))("nzPageSize",e.pageSize),c.Eb(18),c.tc("nzShowSort",!0)("nzSortOrder",e.order),c.Eb(5),c.tc("ngForOf",t.data),c.Eb(3),c.tc("nzVisible",e.qrcodeVisible)("nzFooter",null),c.Eb(2),c.Rc(" ",e.qrName," "),c.Eb(2),c.tc("ngIf",e.qrcode),c.Eb(2),c.tc("nzType","primary"),c.Eb(2),c.tc("ngIf",e.previewStart)}},directives:[v.n,y.e,w.c,v.m,O.c,k.a,k.c,M.a,_.a,x.b,S.c,S.o,S.q,E.d,E.a,I.a,T.a,Z.c,Z.j,Z.k,Z.b,Z.h,Z.g,Z.a,Z.e,m.a,L.a,y.b,y.d,w.d,R.a,D.d,F,U.a],styles:[".margin-btn[_ngcontent-%COMP%]{margin-left:15px}.light-color[_ngcontent-%COMP%]{color:red}.gray-color[_ngcontent-%COMP%]{color:#999}.container[_ngcontent-%COMP%]{background-color:#fff;padding:10px;height:100%}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:10px;padding-left:5px}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:500}.resource-container[_ngcontent-%COMP%]{height:calc(100% - 42px);overflow:hidden;display:flex}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]{height:100%;overflow-x:hidden;overflow-y:auto;min-width:200px}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]   .right-wrap[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;justify-content:center}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{background:#fff;border:1px solid #ddd;text-align:center;font-size:12px;height:20px;line-height:20px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]{padding-left:30px;flex:1;height:100%;overflow:hidden;border-left:1px solid #ddd}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]{margin-bottom:10px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]{display:flex;min-height:50px;align-items:center;border-bottom:1px solid #eee}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   .list-title[_ngcontent-%COMP%]{min-width:85px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-block;padding:5px 15px;margin-right:12px;cursor:pointer}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{background-color:#1890ff;border-radius:5px;color:#fff}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   .list-content[_ngcontent-%COMP%]{flex-grow:2}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{height:calc(100% - 260px);overflow:auto}.source-header[_ngcontent-%COMP%]{font-weight:bolder}tr.light-tr[_ngcontent-%COMP%]{background:#e6f7ff}[_nghost-%COMP%]     .ant-table-tbody>tr>td, [_nghost-%COMP%]     .ant-table-thead>tr>th, [_nghost-%COMP%]     .ant-table tfoot>tr>td, [_nghost-%COMP%]     .ant-table tfoot>tr>th{padding:10px 5px}.ant-table-tbody[_ngcontent-%COMP%] > tr.ant-table-row[_ngcontent-%COMP%]:hover > td[_ngcontent-%COMP%]{background:#dde0df}[_nghost-%COMP%]     .ant-table-pagination.ant-pagination{position:fixed;bottom:20px;right:20px;background:#fff}[_nghost-%COMP%]     .ant-spin-container{position:static}[_nghost-%COMP%]     .ant-tree{position:static!important}nz-content[_ngcontent-%COMP%]{flex:1!important}.synopsis-text[_ngcontent-%COMP%]{width:100%;display:-webkit-box!important;word-break:break-all;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}  .no-scoll .ant-table-body{overflow:hidden!important}[_nghost-%COMP%]     .table-container{height:calc(100% - 110px)!important}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   .list-title[_ngcontent-%COMP%]{width:100px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   .list-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:200px}[_nghost-%COMP%]     .ant-tree-title{max-width:200px;display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}"]}),Object(a.b)([Object(u.b)({title:t=>`\u786e\u5b9a\u5220\u9664"${t[0].title}"\u7684\u9605\u8bfb\u8d44\u6e90\uff1f`,content:"",type:"warning"})],t.prototype,"del",null),t})();const lt=["treeContainer"];function dt(t,e){if(1&t){const t=c.bc();c.ac(0,"qkc-change-profession",39),c.ic("professionChange",(function(e){return c.Ec(t),c.lc().professionChange(e)})),c.Zb()}if(2&t){const t=c.lc();c.tc("select",t.selected)("hidden","scp"===t.from)}}function ht(t,e){if(1&t){const t=c.bc();c.ac(0,"button",27),c.ic("click",(function(){return c.Ec(t),c.lc().goback()})),c.Pc(1,"\u5b8c\u6210\u8c03\u7528"),c.Zb()}}function gt(t,e){if(1&t){const t=c.bc();c.ac(0,"button",27),c.ic("click",(function(){return c.Ec(t),c.lc().goAddCase()})),c.Pc(1,"\u65b0\u589e\u6848\u4f8b"),c.Zb()}}function ut(t,e){if(1&t){const t=c.bc();c.ac(0,"qkc-tree-knowledgegraph",40),c.ic("nodeChange",(function(e){return c.Ec(t),c.lc().nodeChange(e)})),c.Zb()}if(2&t){const t=c.lc();c.tc("professionId",null==t.selectedProfesson?null:t.selectedProfesson.id)("allNodes",!0)}}function pt(t,e){if(1&t){const t=c.bc();c.ac(0,"a",47),c.ic("click",(function(){c.Ec(t);const e=c.lc(2).$implicit;return c.lc().del(e)})),c.Pc(1,"\u5220\u9664"),c.Zb()}}function ft(t,e){if(1&t){const t=c.bc();c.ac(0,"td",44),c.ac(1,"a",45),c.ic("click",(function(){c.Ec(t);const e=c.lc().$implicit;return c.lc().copy(e)})),c.Pc(2,"\u590d\u5236 "),c.Zb(),c.ac(3,"a",45),c.ic("click",(function(){c.Ec(t);const e=c.lc().$implicit;return c.lc().preview(e)})),c.Pc(4,"\u9884\u89c8 "),c.Zb(),c.ac(5,"a",45),c.ic("click",(function(){c.Ec(t);const e=c.lc().$implicit;return c.lc().edit(e)})),c.Pc(6,"\u7f16\u8f91 "),c.Zb(),c.Nc(7,pt,2,0,"a",46),c.Zb()}if(2&t){const t=c.lc().$implicit,e=c.lc();c.Eb(7),c.tc("ngIf",e.delIF(t))}}function bt(t,e){if(1&t){const t=c.bc();c.ac(0,"a",45),c.ic("click",(function(){c.Ec(t);const e=c.lc(2),n=e.$implicit,i=e.index;return c.lc().callResource(n,i)})),c.Pc(1,"\u8c03\u7528"),c.Zb()}}function mt(t,e){if(1&t){const t=c.bc();c.ac(0,"a",47),c.ic("click",(function(){c.Ec(t);const e=c.lc(2),n=e.$implicit,i=e.index;return c.lc().cancelCallResource(n,i)})),c.Pc(1,"\u53d6\u6d88\u8c03\u7528"),c.Zb()}}function zt(t,e){1&t&&(c.ac(0,"a",50),c.Pc(1,"\u5df2\u8c03\u7528"),c.Zb())}function Pt(t,e){if(1&t){const t=c.bc();c.ac(0,"td",44),c.ac(1,"a",45),c.ic("click",(function(){c.Ec(t);const e=c.lc().$implicit;return c.lc().preview(e)})),c.Pc(2,"\u9884\u89c8 "),c.Zb(),c.Nc(3,bt,2,0,"a",48),c.Nc(4,mt,2,0,"a",46),c.Nc(5,zt,2,0,"a",49),c.Zb()}if(2&t){const t=c.lc().$implicit,e=c.lc();c.Eb(3),c.tc("ngIf",!t.isCall&&e.permitedCall),c.Eb(1),c.tc("ngIf",t.isCall&&!e.callResourceData.isStandard),c.Eb(1),c.tc("ngIf",t.isCall&&e.callResourceData.isStandard)}}function Ct(t,e){if(1&t&&(c.ac(0,"tr"),c.ac(1,"td"),c.ac(2,"span",41),c.Pc(3),c.Zb(),c.Zb(),c.ac(4,"td"),c.Pc(5),c.Zb(),c.ac(6,"td",42),c.ac(7,"span",41),c.Pc(8),c.Zb(),c.Zb(),c.ac(9,"td"),c.Pc(10),c.Zb(),c.ac(11,"td"),c.Pc(12),c.Zb(),c.ac(13,"td"),c.Pc(14),c.Zb(),c.ac(15,"td"),c.Pc(16),c.Zb(),c.Nc(17,ft,8,1,"td",43),c.Nc(18,Pt,6,3,"td",43),c.Zb()),2&t){const t=e.$implicit,n=c.lc();c.Eb(3),c.Qc(null==t?null:t.title),c.Eb(2),c.Qc(n.getName(null==t?null:t.learningGoalCode,"LEARNING_TARGET")),c.Eb(1),c.tc("nzTooltipTitle",null==t?null:t.pointName),c.Eb(2),c.Qc(null==t?null:t.pointName),c.Eb(2),c.Qc(null==t?null:t.createrName),c.Eb(2),c.Qc(null==t?null:t.authorName),c.Eb(2),c.Qc(n.getDate(null==t?null:t.lastModifiedTime)),c.Eb(2),c.Qc(null==t?null:t.useTime),c.Eb(1),c.tc("ngIf",""==n.from),c.Eb(1),c.tc("ngIf","scp"==n.from)}}function vt(t,e){1&t&&c.Pc(0),2&t&&c.Rc("\u5171 ",e.$implicit," \u6761\u8bb0\u5f55")}const yt=function(){return[15,20,30,40,50]},wt=function(t){return{x:"1260px",y:t}};let Ot=(()=>{class t extends h.l{constructor(t,e,n,i,o,a,c,s){super(),this.menuService=t,this.modalService=e,this.message=n,this.route=i,this.materialLibService=o,this.courseMgService=a,this.statisticsLogService=c,this.locale=s,this._PAGE_ID_="MaterialCaseLibraryComponent",this.id=-1,this.knowledgePointId="",this.conditionObj={category:100,knowledgeSubjectId:"",knowledgeModuleId:"",knowledgeUnitId:"",knowledgePointId:"",condition:"",coursewareType:["104"],learningGoalCode:[""]},this.from="",this.callResourceData={},this.callResourceId="MaterialCallResource",this.selected="",this.knowledgegraphTree=!0,this.changeProfession=!0,this.init=!1,this.permitedCall=!0,this.getName=r.k,this.order=null}initData(){this.selected=s.a.getCasetree()||s.a.getPacketInfoItem("code");const{from:t,task:e}=this.route.snapshot.queryParams;this.task=e,"scp"===t&&(this.from=t,this.callResourceData=s.a.getScpResourceMaterial())}ngOnAttach(){this.selected=s.a.getCasetree()||s.a.getPacketInfoItem("code"),this.collectParam(),this.sybcParam(),this.init=!1,this.knowledgegraphTree=!1,this.changeProfession=!1,Object(d.a)(0).subscribe(()=>{this.knowledgegraphTree=!0,this.changeProfession=!0})}collectParam(){const{condition:t,learningGoalCode:e}=s.a.getSearch(this._PAGE_ID_);this.condition=t||"",this.learningGoalCode=e||[]}sybcParam(){this.conditionObj.condition=this.condition,this.conditionObj.learningGoalCode=this.learningGoalCode}storingData(){const{condition:t,learningGoalCode:e}=this;this.passData({condition:t,learningGoalCode:e})}resetInit(){this.condition="",this.learningGoalCode=[],this.conditionObj.learningGoalCode=[],this.conditionObj.condition=""}searchData(t=!1){t&&(this.pageIndex=1,this.learningGoalCode=[],this.condition="",this.conditionObj.learningGoalCode=[],this.conditionObj.condition="",this.removeData()),this.getDataList()}collectSearch(){this.collectParam(),this.sybcParam(),this.getDataList()}resetSearch(){this.pageIndex=1,this.conditionObj.condition=this.condition,this.conditionObj.learningGoalCode=this.learningGoalCode,this.getDataList()}getDataList(){this.conditionObj.condition=this.conditionObj.condition.trim();const t=Object.assign(Object.assign({},this.conditionObj),{page:this.pageIndex,limit:this.pageSize});this.order&&(t.sort="ascend"===this.order?"useTime|asc":"useTime|desc");const e=t=>{this.isLoading=!1,200===t.status?t.data&&t.data.records&&t.data.records.length?(this.data=t.data.records,this.total=t.data.total,"scp"===this.from&&this.callResourceData.nodes&&this.callResourceData.nodes.length>0&&(this.data=this.data.map(t=>{const e=this.callResourceData.nodes.find(e=>e.id===t.id);return e&&(t.isCall=!0,t.taskId=e.taskId),t}),this.setPermitedCall())):(this.data=[],this.total=0):(this.data=[],this.total=0,this.message.create("error",t.message))},n=t=>{this.isLoading=!1,this.message.create("error",JSON.stringify(t))};this.isLoading=!0;const i=[this.materialLibService.resConditionQuery(t)];Object(l.a)(i).subscribe(t=>{this.isLoading=!1,e(t[0])},t=>{this.isLoading=!1,n(t)})}onResize({width:t}){const e=this.treeContainer&&this.treeContainer.nativeElement&&this.treeContainer.nativeElement.offsetWidth;e&&this.treeContainer.nativeElement.offsetWidth+80<t||e&&this.treeContainer.nativeElement.offsetWidth+10>t||(cancelAnimationFrame(this.id),this.id=requestAnimationFrame(()=>{this.width=t}))}setPermitedCall(){this.callResourceData.hasOwnProperty("limit")&&(this.permitedCall=0===Number(this.callResourceData.limit)||!(this.callResourceData.nodes.length>=this.callResourceData.limit||-1===Number(this.callResourceData.limit)))}professionChange(t){s.a.putCasetree(t.code),this.selectedProfesson=t,this.conditionObj.knowledgeSubjectId=t.id,this.init?(this.pageIndex=1,this.searchData()):(this.init=!0,this.collectSearch())}nodeChange(t){"1"===t.kType?(this.conditionObj.knowledgeSubjectId=t.id,this.conditionObj.knowledgeModuleId="",this.conditionObj.knowledgeUnitId="",this.conditionObj.knowledgePointId=""):"2"===t.kType?(this.conditionObj.knowledgeSubjectId="",this.conditionObj.knowledgeModuleId=t.id,this.conditionObj.knowledgeUnitId="",this.conditionObj.knowledgePointId=""):"3"===t.kType?(this.conditionObj.knowledgeSubjectId="",this.conditionObj.knowledgeModuleId="",this.conditionObj.knowledgeUnitId=t.id,this.conditionObj.knowledgePointId=""):"4"===t.kType&&(this.conditionObj.knowledgeSubjectId="",this.conditionObj.knowledgeModuleId="",this.conditionObj.knowledgeUnitId="",this.conditionObj.knowledgePointId=t.id,this.knowledgePointId=t.id),this.pageIndex=1,this.searchData()}goAddCase(){if(!this.selectedProfesson)return this.message.error("\u8fd8\u6ca1\u6709\u5efa\u7acb\u5b66\u79d1\u54e6~");this.menuService.gotoUrl({url:"/m/rm/material-details",paramUrl:`/0/104/${this.selectedProfesson?this.selectedProfesson.id:0}?t=${(new Date).getTime()}`,title:"\u65b0\u589e\u6848\u4f8b"})}edit(t){this.menuService.gotoUrl({url:"/m/rm/material-details",paramUrl:`/${t.id}/${t.type}/${this.selectedProfesson.id}`,title:"\u7f16\u8f91\u6848\u4f8b"})}preview(t){this.menuService.gotoUrl({url:"/m/rm/material-pre-case",paramUrl:`/${t.id}/${t.type}/${this.selectedProfesson.id}`,title:"\u9884\u89c8\u6848\u4f8b"})}copy(t){return new Promise(e=>{this.materialLibService.copyResource(t.id).subscribe(t=>{201===t.status?(this.searchData(),e(!0)):(500===t.status&&this.message.error("\u670d\u52a1\u5668\u4e1a\u52a1\u5f02\u5e38"),e(!1))},t=>{this.message.error(JSON.stringify(t)),e(!1)})})}goback(){this.menuService.goBack(!1),this.menuService.gotoUrl({title:"\u8bfe\u5305\u5efa\u8bbe",url:"/m/course-manage/prepare-course",paramUrl:""})}del(t){return new Promise(e=>{this.materialLibService.delResource(t.id).subscribe(t=>{200===t.status?(this.searchData(),e(!0)):(500===t.status&&this.message.error("\u670d\u52a1\u5668\u4e1a\u52a1\u5f02\u5e38"),e(!1))},t=>{this.message.error(JSON.stringify(t)),e(!1)})})}delIF(t){return"0"===String(t.useTime)}callResource(t,e){const n=t=>{this.isLoading=!1,this.message.warning(JSON.stringify(t))},i=Object.assign(Object.assign({},this.callResourceData.sectionInfo),{resourceId:t.id,sourceType:1,isGrade:"1"}),o=t=>{if(this.isLoading=!1,201===t.status){const{task:n}=this;let o="";o="1"===n?"learnSet-task-action":"101"===n?"learnSet-lecture-action":"104"===n?"learnSet-material-action":"learnSet-record-action",this.statisticsLogService.statisticsPacketInfoLog({name:"\u6848\u4f8b\u5e93\u8c03\u7528",actionCode:r.j.packetInfo[o].addCode,content:JSON.stringify(i)}),this.data[e].isCall=!0,this.data[e].taskId=t.data.id,this.callResourceData.nodes.push({id:this.data[e].id,taskId:t.data.id}),this.callResourceData.seq+=1,s.a.putScpResourceMaterial(this.callResourceData),this.setPermitedCall()}else this.message.error(500===t.status?"\u670d\u52a1\u5668\u4e1a\u52a1\u5f02\u5e38\u5bfc\u81f4\u8c03\u7528\u5931\u8d25\uff0c\u53ef\u80fd\u6807\u9898\u592a\u957f\uff0c\u8bf7\u4fdd\u630135\u5b57\u7b26\u4ee5\u5185":t.message)};this.isLoading=!0,"1"===this.task?(i.name=t.title,i.taskType="1",i.seq=s.a.getScpResourceMaterial().seq,this.courseMgService.quickCreate_courseSectionResourceTask(i).subscribe(o,n)):(i.title=t.title,i.category=t.category,i.type=this.task,i.seq=s.a.getScpResourceMaterial().seq,this.courseMgService.quickCreate_courseSectionResource(i).subscribe(o,n))}cancelCallResource(t,e){const n=t=>{this.isLoading=!1,this.message.warning(JSON.stringify(t))},i=n=>{if(this.isLoading=!1,204===n.status){const{task:n}=this;let i="";i="1"===n?"learnSet-task-action":"101"===n?"learnSet-lecture-action":"104"===n?"learnSet-material-action":"learnSet-record-action",this.statisticsLogService.statisticsPacketInfoLog({name:"\u6848\u4f8b\u5e93\u53d6\u6d88\u8c03\u7528",actionCode:r.j.packetInfo[i].delCode,content:t.taskId}),this.data[e].isCall=!1,this.callResourceData.nodes=this.callResourceData.nodes.filter(t=>t.id!==this.data[e].id),this.callResourceData.seq-=1,s.a.putScpResourceMaterial(this.callResourceData),this.setPermitedCall()}else this.message.warning(JSON.stringify(n))};this.isLoading=!0,"1"===this.task?this.courseMgService.delInvoke_courseTask(t.taskId).subscribe(i,n):this.courseMgService.delInvoke_course(t.taskId).subscribe(i,n)}nzSortOtrderChange(t){this.order=t,this.getDataList()}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(b.a),c.Ub(m.e),c.Ub(z.e),c.Ub(o.a),c.Ub(f.a),c.Ub(P.a),c.Ub(C.a),c.Ub(c.u))},t.\u0275cmp=c.Ob({type:t,selectors:[["app-case-lib"]],viewQuery:function(t,e){var n;1&t&&c.Vc(lt,!0),2&t&&c.Bc(n=c.jc())&&(e.treeContainer=n.first)},features:[c.Bb],decls:64,vars:27,consts:[[1,"container"],[1,"header"],[1,"title"],[3,"select","hidden","professionChange",4,"ngIf"],["nz-button","","nzType","primary","class","margin-btn",3,"click",4,"ngIf"],["nz-row","",1,"resource-container"],["nz-resizable","",1,"left-tree",3,"nzResize"],[2,"display","inline-block","overflow","hidden","margin-right","30px"],["treeContainer",""],["model","click",3,"professionId","allNodes","nodeChange",4,"ngIf"],["nzDirection","right"],[1,"right-wrap"],["nz-icon","","nzType","more","nzTheme","outline",1,"right"],[1,"right-resource"],[1,"search-container"],[1,"list"],[1,"list-title"],[1,"list-input"],["nz-input","","placeholder","\u652f\u6301\u6807\u9898",3,"ngModel","ngModelChange","keyup.enter"],[1,"list-title",2,"margin-left","20px"],["nzMode","multiple",1,"list-input",2,"width","100%","max-width","300px",3,"ngModel","ngModelChange"],["nzValue","1","nzLabel","\u4e86\u89e3"],["nzValue","2","nzLabel","\u7406\u89e3"],["nzValue","3","nzLabel","\u638c\u63e1"],["nzValue","4","nzLabel","\u5e94\u7528"],["nzValue","5","nzLabel","\u5206\u6790"],["nzValue","6","nzLabel","\u521b\u65b0"],["nz-button","","nzType","primary",1,"margin-btn",3,"click"],["nz-button","","nzType","primary",2,"margin-left","20px",3,"click"],["id","tableScroll",1,"table-container"],[3,"nzData","nzFrontPagination","nzShowSizeChanger","nzPageSizeOptions","nzScroll","nzShowTotal","nzLoading","nzTotal","nzPageIndex","nzPageSize","nzPageIndexChange","nzPageSizeChange"],["ajaxTable",""],[1,"source-header"],["nzWidth","220px"],["nzWidth","120px"],["nzWidth","100px",3,"nzShowSort","nzSortOrder","nzSortOrderChange"],["nzWidth","120px","nzRight",""],[4,"ngFor","ngForOf"],["totalTemplate",""],[3,"select","hidden","professionChange"],["model","click",3,"professionId","allNodes","nodeChange"],[1,"synopsis-text"],["nzTooltipTrigger","click","nz-tooltip","",2,"cursor","pointer",3,"nzTooltipTitle"],["nzRight","",4,"ngIf"],["nzRight",""],[3,"click"],["class","light-color",3,"click",4,"ngIf"],[1,"light-color",3,"click"],[3,"click",4,"ngIf"],["style","color: #999;",4,"ngIf"],[2,"color","#999"]],template:function(t,e){if(1&t&&(c.ac(0,"div",0),c.ac(1,"section",1),c.ac(2,"div",2),c.Pc(3),c.Nc(4,dt,1,2,"qkc-change-profession",3),c.Zb(),c.ac(5,"div"),c.Nc(6,ht,2,0,"button",4),c.Nc(7,gt,2,0,"button",4),c.Zb(),c.Zb(),c.ac(8,"section",5),c.ac(9,"section",6),c.ic("nzResize",(function(t){return e.onResize(t)})),c.ac(10,"div",7,8),c.Nc(12,ut,1,2,"qkc-tree-knowledgegraph",9),c.Zb(),c.ac(13,"nz-resize-handle",10),c.ac(14,"div",11),c.Vb(15,"i",12),c.Zb(),c.Zb(),c.Zb(),c.ac(16,"section",13),c.ac(17,"section",14),c.ac(18,"div",15),c.ac(19,"div",16),c.Pc(20,"\u5173\u952e\u8bcd\u641c\u7d22\uff1a"),c.Zb(),c.ac(21,"div",17),c.ac(22,"input",18),c.ic("ngModelChange",(function(t){return e.condition=t}))("ngModelChange",(function(){return e.storingData()}))("keyup.enter",(function(){return e.resetSearch()})),c.Zb(),c.Zb(),c.Zb(),c.ac(23,"div",15),c.ac(24,"div",19),c.Pc(25,"\u5b66\u4e60\u76ee\u6807\uff1a"),c.Zb(),c.ac(26,"div",17),c.ac(27,"nz-select",20),c.ic("ngModelChange",(function(t){return e.learningGoalCode=t}))("ngModelChange",(function(){return e.storingData()})),c.Pc(28,' nzShowSearch [nzMaxTagPlaceholder]="tagPlaceHolder" '),c.Vb(29,"nz-option",21),c.Vb(30,"nz-option",22),c.Vb(31,"nz-option",23),c.Vb(32,"nz-option",24),c.Vb(33,"nz-option",25),c.Vb(34,"nz-option",26),c.Zb(),c.Zb(),c.Zb(),c.ac(35,"button",27),c.ic("click",(function(){return e.resetSearch()})),c.Pc(36,"\u67e5\u8be2 "),c.Zb(),c.ac(37,"button",28),c.ic("click",(function(){return e.resetData()})),c.Pc(38,"\u91cd\u7f6e"),c.Zb(),c.Zb(),c.ac(39,"section",29),c.ac(40,"nz-table",30,31),c.ic("nzPageIndexChange",(function(t){return e.pageIndex=t}))("nzPageSizeChange",(function(t){return e.pageSize=t}))("nzPageIndexChange",(function(){return e.searchData()}))("nzPageSizeChange",(function(){return e.searchData()})),c.ac(42,"thead",32),c.ac(43,"tr"),c.ac(44,"th",33),c.Pc(45,"\u6807\u9898"),c.Zb(),c.ac(46,"th",34),c.Pc(47,"\u5b66\u4e60\u76ee\u6807"),c.Zb(),c.ac(48,"th",33),c.Pc(49,"\u77e5\u8bc6\u70b9"),c.Zb(),c.ac(50,"th",34),c.Pc(51,"\u521b\u5efa\u8005"),c.Zb(),c.ac(52,"th",34),c.Pc(53,"\u4f5c\u8005"),c.Zb(),c.ac(54,"th",34),c.Pc(55,"\u66f4\u65b0\u65f6\u95f4"),c.Zb(),c.ac(56,"th",35),c.ic("nzSortOrderChange",(function(t){return e.nzSortOtrderChange(t)})),c.Pc(57,"\u4f7f\u7528\u6b21\u6570 "),c.Zb(),c.ac(58,"th",36),c.Pc(59,"\u64cd\u4f5c"),c.Zb(),c.Zb(),c.Zb(),c.ac(60,"tbody"),c.Nc(61,Ct,19,10,"tr",37),c.Zb(),c.Zb(),c.Zb(),c.Nc(62,vt,1,1,"ng-template",null,38,c.Oc),c.Zb(),c.Zb(),c.Zb()),2&t){const t=c.Cc(41),n=c.Cc(63);c.Eb(3),c.Rc(" ",null==e.selectedProfesson?null:e.selectedProfesson.name," "),c.Eb(1),c.tc("ngIf",e.changeProfession),c.Eb(2),c.tc("ngIf","scp"===e.from),c.Eb(1),c.tc("ngIf",""===e.from),c.Eb(2),c.Mc("width",e.width,"px"),c.Eb(3),c.tc("ngIf",e.knowledgegraphTree),c.Eb(10),c.tc("ngModel",e.condition),c.Eb(5),c.tc("ngModel",e.learningGoalCode),c.Eb(12),c.Kb("no-scoll",!e.data.length),c.Eb(1),c.tc("nzData",e.data)("nzFrontPagination",!1)("nzShowSizeChanger",!0)("nzPageSizeOptions",c.wc(24,yt))("nzScroll",c.xc(25,wt,e.height+"px"))("nzShowTotal",n)("nzLoading",e.isLoading)("nzTotal",e.total)("nzPageIndex",e.pageIndex)("nzPageSize",e.pageSize),c.Eb(16),c.tc("nzShowSort",!0)("nzSortOrder",e.order),c.Eb(5),c.tc("ngForOf",t.data)}},directives:[v.n,O.c,k.a,k.c,M.a,_.a,x.b,S.c,S.o,S.q,E.d,E.a,I.a,T.a,Z.c,Z.j,Z.k,Z.b,Z.h,Z.g,Z.a,Z.e,v.m,L.a,R.a,D.d],styles:[".margin-btn[_ngcontent-%COMP%]{margin-left:15px}.light-color[_ngcontent-%COMP%]{color:red}.gray-color[_ngcontent-%COMP%]{color:#999}.container[_ngcontent-%COMP%]{background-color:#fff;padding:10px;height:100%}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:10px;padding-left:5px}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:500}.resource-container[_ngcontent-%COMP%]{height:calc(100% - 42px);overflow:hidden;display:flex}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]{height:100%;overflow-x:hidden;overflow-y:auto;min-width:200px}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]   .right-wrap[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;justify-content:center}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{background:#fff;border:1px solid #ddd;text-align:center;font-size:12px;height:20px;line-height:20px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]{padding-left:30px;flex:1;height:100%;overflow:hidden;border-left:1px solid #ddd}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]{margin-bottom:10px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]{min-height:50px;align-items:center;border-bottom:1px solid #eee}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-block;padding:5px 15px;margin-right:12px;cursor:pointer}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{background-color:#1890ff;border-radius:5px;color:#fff}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   .list-content[_ngcontent-%COMP%]{flex-grow:2}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{height:calc(100% - 260px);overflow:auto}.source-header[_ngcontent-%COMP%]{font-weight:bolder}tr.light-tr[_ngcontent-%COMP%]{background:#e6f7ff}[_nghost-%COMP%]     .ant-table-tbody>tr>td, [_nghost-%COMP%]     .ant-table-thead>tr>th, [_nghost-%COMP%]     .ant-table tfoot>tr>td, [_nghost-%COMP%]     .ant-table tfoot>tr>th{padding:10px 5px}.ant-table-tbody[_ngcontent-%COMP%] > tr.ant-table-row[_ngcontent-%COMP%]:hover > td[_ngcontent-%COMP%]{background:#dde0df}[_nghost-%COMP%]     .ant-table-pagination.ant-pagination{position:fixed;bottom:20px;right:20px;background:#fff}[_nghost-%COMP%]     .ant-spin-container{position:static}[_nghost-%COMP%]     .ant-tree{position:static!important}nz-content[_ngcontent-%COMP%]{flex:1!important}.synopsis-text[_ngcontent-%COMP%]{width:100%;display:-webkit-box!important;word-break:break-all;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}  .no-scoll .ant-table-body{overflow:hidden!important}[_nghost-%COMP%]     .table-container{height:calc(100% - 116px)!important}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]{display:flex;align-items:baseline}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]{flex:1;display:flex}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   .list-title[_ngcontent-%COMP%]{min-width:85px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   .list-input[_ngcontent-%COMP%]{flex:1}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   .list-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;max-width:300px}[_nghost-%COMP%]     .ant-tree-title{max-width:200px;display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}"]}),Object(a.b)([Object(u.b)({title:"\u6848\u4f8b\u590d\u5236",content:t=>"\u60a8\u786e\u5b9a\u590d\u5236"+t[0].title+"\u6848\u4f8b\u5417\uff1f",type:"confirm"})],t.prototype,"copy",null),Object(a.b)([Object(u.b)({title:t=>`\u786e\u5b9a\u5220\u9664"${t[0].title}"\u7684\u6848\u4f8b\u8d44\u6e90\uff1f`,content:"",type:"warning"})],t.prototype,"del",null),t})();var kt=n("3JH+"),Mt=n("ifs9"),_t=n("4tR+"),xt=n("9VW+"),St=n.n(xt),Et=n("mhyn"),It=n("Wc2E"),Tt=n("ocnv"),Zt=n("qAZ0"),Lt=n("zioG"),Rt=n("f3RM");const Dt=["treeContainer"],Nt=["treeknowledge"],jt=["background"],Ft=["analysis"],At=["guide"];function Ut(t,e){1&t&&(c.Yb(0),c.Pc(1,"\u8d44\u6e90\u6807\u9898\u4e0d\u80fd\u8d85\u8fc730\u4e2a\u5b57"),c.Xb())}function Vt(t,e){1&t&&(c.Yb(0),c.Pc(1,"\u8d44\u6e90\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a"),c.Xb())}function qt(t,e){if(1&t&&(c.Nc(0,Ut,2,0,"ng-container",53),c.Nc(1,Vt,2,0,"ng-container",53)),2&t){const t=e.$implicit;c.tc("ngIf",t.hasError("maxlength")),c.Eb(1),c.tc("ngIf",t.hasError("required"))}}function Bt(t,e){1&t&&(c.Yb(0),c.Pc(1,"\u4f5c\u8005\u540d\u79f0\u4e0d\u80fd\u8d85\u8fc730\u4e2a\u5b57"),c.Xb())}function Gt(t,e){1&t&&(c.Yb(0),c.Pc(1,"\u4f5c\u8005\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a"),c.Xb())}function Xt(t,e){if(1&t&&(c.Nc(0,Bt,2,0,"ng-container",53),c.Nc(1,Gt,2,0,"ng-container",53)),2&t){const t=e.$implicit;c.tc("ngIf",t.hasError("maxlength")),c.Eb(1),c.tc("ngIf",t.hasError("required"))}}function $t(t,e){if(1&t&&c.Vb(0,"nz-option",54),2&t){const t=e.$implicit;c.tc("nzValue",t.id)("nzLabel",t.name)}}const Wt=function(t){return{visibility:t}};let Ht=(()=>{class t{constructor(t,e,n,i,o,a,c,s,l,d){this.message=t,this.materialLibService=e,this.fb=n,this.route=i,this.menuService=o,this.modalService=a,this.uploadOssService=c,this.renderer2=s,this.win=l,this.doc=d,this.wid=-1,this.professionId="",this.knowledgePointIds=[],this.title="",this.id="",this.coursewareType="",this.isEdit=!1,this.learnTargetArr=r.f,this.ktype=1,this.minType=5,this.defaultTreeKey=[],this.dailDown0=!1,this.dailDown1=!1,this.dailDown2=!1,this.dailDownMove={0:{isDown:!1,leftCha:0,topCha:0,init:!1},1:{isDown:!1,leftCha:0,topCha:0,init:!1},2:{isDown:!1,leftCha:0,topCha:0,init:!1}},this.Editor=St.a,this.isBackgroundLoading=!1,this.isGuideLoading=!1,this.isAnalysisLoading=!1,this.backgroundConfig=Object.assign({},r.d,this.getImgVideoReosolver("isBackgroundLoading")),this.analysisConfig=Object.assign({},r.d,this.getImgVideoReosolver("isAnalysisLoading")),this.guideConfig=Object.assign({},r.d,this.getImgVideoReosolver("isGuideLoading")),this.current=0,this.dom={},this.domEdit={},this.domContainer={},this.domIcon={},this.domIconOut={},this.domMoveHandler={},this.percent=100,this.saveLoading=!1,this.orgCode=g.a.getOrgCode(),this.win.that=this}ngOnInit(){this.initParam(),this.initializeData()}ngAfterViewInit(){Object(d.a)(1e3).subscribe(()=>{this.win.addEventListener("mousemove",this.nailMove)})}ngOnDestroy(){this.win.removeEventListener("mousemove",this.nailMove),Object.keys(this.domMoveHandler).forEach(t=>{this.domMoveHandler[t].removeEventListener("mousemove",this.startMove),this.domMoveHandler[t].removeEventListener("mouseup",this.endMove)})}initParam(){const t=this.route.snapshot.paramMap;this.id=t.get("id"),this.coursewareType=t.get("type"),this.professionId=t.get("professionId")}percentReport(t){this.percent=t}initializeData(){this.initializeForm({}),"0"===this.id?(this.isEdit=!1,this.title="\u65b0\u589e"+Object(r.k)(this.coursewareType,"MATERIAL_TYPE")):(this.isEdit=!0,this.title="\u7f16\u8f91"+Object(r.k)(this.coursewareType,"MATERIAL_TYPE"),this.materialLibService.getResourceDetail(this.id,this.coursewareType).subscribe(t=>{200===t.status&&this.initializeForm(t.data)},t=>{this.message.warning(JSON.stringify(t))}))}getContentLength(t){return t.replace(/<[^>]+>/g,"").replace(/&nbsp;/g,"a").replace(/\s/g,"a").replace(/[\u0391-\uFFE5]/g,"a").length}mouseDownLabel(){this.dailDownMove[this.current].init||(this.dailDownMove[this.current].init=!0,this.domMoveHandler[this.current].addEventListener("mousedown",this.startMove),this.domMoveHandler[this.current].addEventListener("mouseup",this.endMove))}endMove(t){const e=this.that;e.dailDownMove[e.current].isDown=!1}startMove(t){const e=this.that,n=e.domEdit[e.current];if(!e["dailDown"+e.current])return;const i=t||e.win.event;e.dailDownMove[e.current].leftCha=i.clientX-n.offsetLeft,e.dailDownMove[e.current].topCha=i.clientY-n.offsetTop,e.dailDownMove[e.current].isDown=!0}nailDown(t){this.current=t,this.dom[t]||(this.dom[t]=this.doc.getElementById("editor"+t),this.domEdit[t]=this.dom[t].querySelectorAll(" .ck-editor__top.ck-reset_all")[0],this.domContainer[t]=this.dom[t].querySelectorAll(".ck.ck-editor__main")[0],this.domIcon[t]=this.doc.getElementById("editor-icon"+t),this.domIconOut[t]=this.doc.getElementById("editor-icon-out"+t),this.domMoveHandler[t]=this.doc.getElementById("moveHandler"+t),this.domEdit[t].that=this,this.domMoveHandler[t].that=this),this.mouseDownLabel(),this["dailDown"+t]=!this["dailDown"+t],this["dailDown"+t]?this.fixStyles(t):this.resetStyle(t)}fixStyles(t){this.renderer2.setStyle(this.domContainer[t],"margin-top",this.domEdit[t].offsetHeight+"px"),this.renderer2.setStyle(this.domEdit[t],"border-bottom","1px solid #ccc"),this.fixStyle(this.domIcon[t]),this.fixStyle(this.domIconOut[t]),this.fixStyle(this.domEdit[t]),this.fixStyle(this.domMoveHandler[t])}resetStyle(t){const{renderer2:e}=this;e.removeAttribute(this.domContainer[t],"style"),e.removeAttribute(this.domIconOut[t],"style"),e.removeAttribute(this.domIcon[t],"style"),e.removeAttribute(this.domEdit[t],"style"),e.removeAttribute(this.domMoveHandler[t],"style")}nailMove(t){const e=window.that,n=t||e.win.event;Object.keys(e.dailDownMove).every((t,i)=>{if(!e.dailDownMove[t].isDown)return!0;{const o=e.doc.getElementById("editor"+i).querySelectorAll(" .ck-editor__top.ck-reset_all")[0],a=e.doc.getElementById("editor-icon"+i),c=e.doc.getElementById("editor-icon-out"+i),r=e.doc.getElementById("moveHandler"+i);[a,c,o,r].forEach((i,a)=>{2===a?(i.style.left=n.clientX-e.dailDownMove[t].leftCha+"px",i.style.top=n.clientY-e.dailDownMove[t].topCha+"px"):3===a?(i.style.left=n.clientX-e.dailDownMove[t].leftCha+o.offsetWidth/2-e.domMoveHandler[t].offsetWidth/2+"px",i.style.top=n.clientY-e.dailDownMove[t].topCha-17+"px"):(i.style.left=n.clientX-e.dailDownMove[t].leftCha+o.offsetWidth+"px",i.style.top=n.clientY-e.dailDownMove[t].topCha+"px")})}})}fixStyle(t){const e=t.offsetWidth+"px",n=t.getBoundingClientRect().top+"px",i=t.getBoundingClientRect().left+"px",{renderer2:o}=this;o.setStyle(t,"position","fixed"),o.setStyle(t,"background","white"),o.setStyle(t,"z-index","999"),o.setStyle(t,"width",e),o.setStyle(t,"top",n),o.setStyle(t,"left",i),o.setStyle(t,"transform","inherit")}getImgVideoReosolver(t){return{videoUpload:this.getResolver(t),imageUpload:this.getResolver(t)}}getResolver(t){const e=this;return n=>(e[t]=!0,new Promise((i,o)=>{e.uploadOssService.uploadOss(n,_t.a.editor).subscribe(n=>{e[t]=!1,n?i({url:p.a.OSS_URL+n}):e.message.warning("\u4e0a\u4f20\u5931\u8d25")},n=>{e[t]=!1,e.message.warning("\u4e0a\u4f20\u5931\u8d25"),o(n)})}))}onResize({width:t}){const e=this.treeContainer&&this.treeContainer.nativeElement&&this.treeContainer.nativeElement.offsetWidth;e&&this.treeContainer.nativeElement.offsetWidth+80<t||e&&this.treeContainer.nativeElement.offsetWidth+10>t||(cancelAnimationFrame(this.wid),this.wid=requestAnimationFrame(()=>{this.width=t}))}initializeForm(t){const{coursewareType:e,isEdit:n}=this,{id:i,title:o,learningGoalCode:a,background:c,guide:r,analysis:s,attachment:l,authorName:d}=t;this.validateForm=this.fb.group({id:[n?i:""],points:[[]],type:[e],coursewareType:[e],title:[n?o:"",[S.w.required,Object(kt.b)(),S.w.maxLength(30)]],learningGoalCode:[n?a:"",[S.w.required]],background:[n?c:"",[S.w.required]],guide:[n?r:""],analysis:[n?s:""],caseAttanmentArr:[n?l.map(t=>({name:t.attachmentName,path:t.attachmentPath,title:t.attachmentName})):[]],authorName:[n?d:"zksd"===this.orgCode?"\u8003\u62c9\u65e5\u8bb0":"\u6052\u4f01\u6559\u80b2",[S.w.required,Object(kt.b)(),S.w.maxLength(30)]]}),n&&t.resourcePoints[0].knowledgePointId&&(this.knowledgePointIds=this.defaultTreeKey=t.resourcePoints.map(({knowledgePointId:t})=>t))}submitForm(){const{background:t,analysis:e,guide:n}=this.validateForm.value;for(const a in this.validateForm.controls)this.validateForm.controls[a].markAsDirty(),this.validateForm.controls[a].updateValueAndValidity();if(this.validateForm.invalid)return void this.message.warning("\u8bf7\u6309\u89c4\u5219\u586b\u5199\u6240\u6709\u5fc5\u586b\u9879");if(this.getContentLength(t)>5e3)return void this.message.warning("\u6848\u4f8b\u80cc\u666f\u5df2\u8d85\u51fa\u9650\u5236");if(this.getContentLength(e)>5e3)return void this.message.warning("\u6848\u4f8b\u89e3\u6790\u5df2\u8d85\u51fa\u9650\u5236");if(this.getContentLength(n)>5e3)return void this.message.warning("\u6559\u5b66\u6307\u5bfc\u5185\u5bb9\u5df2\u8d85\u51fa\u9650\u5236");const i=JSON.parse(JSON.stringify(this.validateForm.value));this.knowledgePointIds.length?(i.pointType=1,i.points=this.knowledgePointIds.map(t=>t)):(i.pointType=2,i.points=[this.treeknowledge.nodes[0].id]);const o=i.caseAttanmentArr.map(t=>({attachmentName:t.name,attachmentPath:t.path,aattachmentExt:g.a.getExt(t.path),attachmentType:12}));i.attachments=[...o],delete i.caseAttanmentArr,5===this.minType&&0===this.knowledgePointIds.length?this.modalService.warning({nzTitle:"\u672a\u9009\u62e9\u77e5\u8bc6\u70b9\u8d44\u6599\u5c06\u6302\u5230\u8bfe\u7a0b\uff0c\u786e\u5b9a\u5417\uff1f",nzCancelText:"\u53d6\u6d88",nzOkText:"\u786e\u5b9a",nzOnOk:()=>this.savaRecourse(i)}):2===i.pointType?this.modalService.warning({nzTitle:"\u9009\u62e9\u7684\u8282\u70b9\u672a\u5305\u542b\u77e5\u8bc6\u70b9\uff0c\u8d44\u6599\u5c06\u6302\u5230\u8bfe\u7a0b\uff0c\u786e\u5b9a\u5417\uff1f",nzCancelText:"\u53d6\u6d88",nzOkText:"\u786e\u5b9a",nzOnOk:()=>this.savaRecourse(i)}):this.savaRecourse(i)}savaRecourse(t){return new Promise(e=>{this.saveLoading=!0,this.materialLibService.saveCase(t).subscribe(t=>{this.saveLoading=!1,201===t.status?(e(!0),this.goBack()):(500===t.status&&this.message.error("\u670d\u52a1\u5668\u4e1a\u52a1\u5f02\u5e38"),e(!1))},t=>{e(!1),this.saveLoading=!1,this.message.error(JSON.stringify(t))})})}nodeChange(t){this.knowledgePointIds=this.getCheckedLeafKey(t);const e={minType:5};this.getMinLavel(t,e),this.minType=e.minType}getMinLavel(t,e){t.length&&t.forEach(t=>{t.origin&&t.origin.children&&t.origin.children.length&&this.getMinLavel(t.children,e),e.minType>t.origin.kType&&(e.minType=t.origin.kType)})}getCheckedLeafKey(t){const e=[],n=t=>{for(let i=0;i<t.length;i++){const o=t[i]instanceof Mt.d?t[i].origin:t[i];o.children&&o.children.length>0?n(o.children):o.isLeaf&&o.checked&&"4"===o.kType&&e.push(o.id)}};return n(t),e}goBack(){this.menuService.goBack(!1),this.menuService.gotoUrl({url:"/m/rm/case",paramUrl:"",title:"\u6848\u4f8b\u5e93"})}stopPropagation(t){if(13===t.keyCode)return t.stopPropagation(),!1}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(z.e),c.Ub(f.a),c.Ub(S.d),c.Ub(o.a),c.Ub(b.a),c.Ub(m.e),c.Ub(It.a),c.Ub(c.E),c.Ub(Et.b),c.Ub(v.d))},t.\u0275cmp=c.Ob({type:t,selectors:[["app-material-case"]],viewQuery:function(t,e){var n;1&t&&(c.Vc(Dt,!0),c.Vc(Nt,!0),c.Kc(jt,!0),c.Kc(Ft,!0),c.Kc(At,!0)),2&t&&(c.Bc(n=c.jc())&&(e.treeContainer=n.first),c.Bc(n=c.jc())&&(e.treeknowledge=n.first),c.Bc(n=c.jc())&&(e.background=n.first),c.Bc(n=c.jc())&&(e.analysis=n.first),c.Bc(n=c.jc())&&(e.guide=n.first))},decls:91,vars:92,consts:[[1,"container"],[1,"resource-container"],["nz-resizable","",1,"left-tree",3,"nzResize"],[2,"margin-bottom","15px","font-size","15px"],[2,"display","inline-block","overflow","hidden","margin-right","30px"],["treeContainer",""],["model","check",3,"professionId","defaultCheckedKeys","fullNode","allNodes","nodeChange"],["treeknowledge",""],["nzDirection","right"],[1,"right-wrap"],["nz-icon","","nzType","more","nzTheme","outline",1,"right"],[1,"right-resource"],[1,"right-title"],["nz-form","",1,"case-form",3,"formGroup"],["nzRequired","","nzFor","title",2,"text-align","left","max-width","100px",3,"nzSm","nzXs"],[3,"nzSm","nzXs","nzErrorTip"],["nz-input","","formControlName","title","id","title","placeholder","\u8bf7\u8f93\u5165\u6807\u9898...",2,"width","calc(100% - 80px)",3,"keyup.enter","keydown"],[2,"margin-left","10px"],["titleTpl",""],["nz-row",""],["nz-col","","nzSpan","15"],["nzHasFeedback","",3,"nzSm","nzXs","nzErrorTip"],["nz-input","","formControlName","authorName","placeholder","\u8bf7\u8f93\u5165\u4f5c\u8005\u540d\u79f0...",2,"width","calc(100% - 80px)",3,"keyup.enter"],["nz-col","","nzSpan","12"],["nzRequired","",2,"text-align","left","max-width","100px",3,"nzSm","nzXs"],["nzErrorTip","\u8bf7\u9009\u62e9\u5b66\u4e60\u76ee\u6807",3,"nzSm","nzXs"],["formControlName","learningGoalCode","nzAllowClear","","nzPlaceHolder","\u8bf7\u9009\u62e9\u5b66\u4e60\u76ee\u6807"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzErrorTip","\u6848\u4f8b\u80cc\u666f\u4e0d\u80fd\u4e3a\u7a7a",2,"max-width","calc(100% - 150px)","position","relative",3,"nzSm","nzXs"],["nzTip","\u6587\u4ef6\u4e0a\u4f20\u4e2d...",3,"nzSpinning","nzDelay"],["placeholder","\u8bf7\u8f93\u5165\u6848\u4f8b\u80cc\u666f\u5185\u5bb9","formControlName","background","id","editor0",3,"editor","config"],[2,"float","right"],["nz-icon","","nzType","drag","nzTheme","outline","id","moveHandler0",1,"move-handler",3,"ngStyle"],["nz-icon","","nzType","login","id","editor-icon0","nzTheme","outline","nz-tooltip","","nzTooltipTitle","\u9489\u4f4f\u62d6\u52a8",1,"editor-icon",2,"vertical-align","top",3,"ngStyle","click"],["nz-icon","","nzType","logout","id","editor-icon-out0","nzTheme","outline","nz-tooltip","","nzTooltipTitle","\u56de\u5230\u521d\u59cb\u4f4d\u7f6e",1,"editor-icon",2,"vertical-align","top",3,"ngStyle","click"],[2,"text-align","left","max-width","100px",3,"nzSm","nzXs"],["nzErrorTip","The input is not valid E-mail!","nzExtra","\u4ec5\u96504\u4e2a\uff0c\u652f\u6301\u6269\u5c55\u540d\uff1apdf \u3001doc \u3001docx \u3001xls \u3001xlsx \u3001ppt \u3001pptx \u3001png \u3001jpg \u3001jpeg \u3001mp4 \u3001zip \u3001rar",3,"nzSm","nzXs"],["listType","text","acceptType","pdf ,doc ,docx ,xls ,xlsx ,ppt ,pptx ,png ,jpg ,jpeg ,mp4 ,zip ,rar","limit","4","formControlName","caseAttanmentArr",3,"multiple","percentReport"],["nz-button",""],["nz-icon","","nzType","upload"],[2,"max-width","calc(100% - 150px)","position","relative",3,"nzSm","nzXs"],["placeholder","\u8bf7\u8f93\u5165\u6848\u4f8b\u89e3\u6790","id","editor1","formControlName","analysis",3,"editor","config"],["nz-icon","","nzType","drag","nzTheme","outline","id","moveHandler1",1,"move-handler",3,"ngStyle"],["nz-icon","","nzType","login","id","editor-icon1","nzTheme","outline","nz-tooltip","","nzTooltipTitle","\u9489\u4f4f\u62d6\u52a8",1,"editor-icon",2,"vertical-align","top",3,"ngStyle","click"],["nz-icon","","nzType","logout","id","editor-icon-out1","nzTheme","outline","nz-tooltip","","nzTooltipTitle","\u56de\u5230\u521d\u59cb\u4f4d\u7f6e",1,"editor-icon",2,"vertical-align","top",3,"ngStyle","click"],[2,"margin-top","40px"],["placeholder","\u8bf7\u8f93\u5165\u6559\u5b66\u6307\u5bfc","id","editor2","formControlName","guide",3,"editor","config"],["nz-icon","","nzType","drag","nzTheme","outline","id","moveHandler2",1,"move-handler",3,"ngStyle"],["nz-icon","","nzType","login","id","editor-icon2","nzTheme","outline","nz-tooltip","","nzTooltipTitle","\u9489\u4f4f\u62d6\u52a8",1,"editor-icon",2,"vertical-align","top",3,"ngStyle","click"],["nz-icon","","nzType","logout","id","editor-icon-out2","nzTheme","outline","nz-tooltip","","nzTooltipTitle","\u56de\u5230\u521d\u59cb\u4f4d\u7f6e",1,"editor-icon",2,"vertical-align","top",3,"ngStyle","click"],[1,"submit-footer"],["nz-button","","nzType","default",2,"margin-right","20px",3,"click"],["nz-button","","nzType","primary",3,"disabled","nzLoading","click"],[4,"ngIf"],[3,"nzValue","nzLabel"]],template:function(t,e){if(1&t&&(c.ac(0,"div",0),c.ac(1,"section",1),c.ac(2,"section",2),c.ic("nzResize",(function(t){return e.onResize(t)})),c.ac(3,"p",3),c.Pc(4," \u9009\u62e9\u77e5\u8bc6\u70b9(\u4e0d\u652f\u6301\u8de8\u5b66\u79d1\u77e5\u8bc6\u70b9)"),c.Zb(),c.ac(5,"div",4,5),c.ac(7,"qkc-tree-knowledgegraph",6,7),c.ic("nodeChange",(function(t){return e.nodeChange(t)})),c.Zb(),c.Zb(),c.ac(9,"nz-resize-handle",8),c.ac(10,"div",9),c.Vb(11,"i",10),c.Zb(),c.Zb(),c.Zb(),c.ac(12,"section",11),c.ac(13,"p",12),c.Pc(14),c.Zb(),c.ac(15,"form",13),c.ac(16,"nz-form-item"),c.ac(17,"nz-form-label",14),c.Pc(18,"\u8d44\u6e90\u6807\u9898 "),c.Zb(),c.ac(19,"nz-form-control",15),c.ac(20,"input",16),c.ic("keyup.enter",(function(){return e.submitForm()}))("keydown",(function(t){return e.stopPropagation(t)})),c.Zb(),c.ac(21,"span",17),c.Pc(22),c.Zb(),c.Nc(23,qt,2,2,"ng-template",null,18,c.Oc),c.Zb(),c.Zb(),c.ac(25,"div",19),c.ac(26,"div",20),c.ac(27,"nz-form-item"),c.ac(28,"nz-form-label",14),c.Pc(29,"\u4f5c\u8005\u540d\u79f0 "),c.Zb(),c.ac(30,"nz-form-control",21),c.ac(31,"input",22),c.ic("keyup.enter",(function(){return e.submitForm()})),c.Zb(),c.ac(32,"span",17),c.Pc(33),c.Zb(),c.Nc(34,Xt,2,2,"ng-template",null,18,c.Oc),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.ac(36,"div",19),c.ac(37,"div",23),c.ac(38,"nz-form-item"),c.ac(39,"nz-form-label",24),c.Pc(40,"\u5b66\u4e60\u76ee\u6807 "),c.Zb(),c.ac(41,"nz-form-control",25),c.ac(42,"nz-select",26),c.Nc(43,$t,1,2,"nz-option",27),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.ac(44,"nz-form-item"),c.ac(45,"nz-form-label",24),c.Pc(46,"\u6848\u4f8b\u80cc\u666f "),c.Zb(),c.ac(47,"nz-form-control",28),c.ac(48,"nz-spin",29),c.Vb(49,"ckeditor",30),c.ac(50,"span",31),c.Pc(51),c.Zb(),c.Zb(),c.Vb(52,"i",32),c.Zb(),c.ac(53,"i",33),c.ic("click",(function(){return e.nailDown(0)})),c.Zb(),c.ac(54,"i",34),c.ic("click",(function(){return e.nailDown(0)})),c.Zb(),c.Zb(),c.ac(55,"nz-form-item"),c.ac(56,"nz-form-label",35),c.Pc(57,"\u6848\u4f8b\u9644\u4ef6"),c.Zb(),c.ac(58,"nz-form-control",36),c.ac(59,"qkc-upload",37),c.ic("percentReport",(function(t){return e.percentReport(t)})),c.ac(60,"button",38),c.Vb(61,"i",39),c.ac(62,"span"),c.Pc(63,"\u4e0a\u4f20\u6587\u4ef6"),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.ac(64,"nz-form-item"),c.ac(65,"nz-form-label",35),c.Pc(66,"\u6848\u4f8b\u89e3\u6790 "),c.Zb(),c.ac(67,"nz-form-control",40),c.ac(68,"nz-spin",29),c.Vb(69,"ckeditor",41),c.ac(70,"span",31),c.Pc(71),c.Zb(),c.Zb(),c.Vb(72,"i",42),c.Zb(),c.ac(73,"i",43),c.ic("click",(function(){return e.nailDown(1)})),c.Zb(),c.ac(74,"i",44),c.ic("click",(function(){return e.nailDown(1)})),c.Zb(),c.Zb(),c.ac(75,"nz-form-item",45),c.ac(76,"nz-form-label",35),c.Pc(77,"\u6559\u5b66\u6307\u5bfc "),c.Zb(),c.ac(78,"nz-form-control",40),c.ac(79,"nz-spin",29),c.Vb(80,"ckeditor",46),c.ac(81,"span",31),c.Pc(82),c.Zb(),c.Zb(),c.Vb(83,"i",47),c.Zb(),c.ac(84,"i",48),c.ic("click",(function(){return e.nailDown(2)})),c.Zb(),c.ac(85,"i",49),c.ic("click",(function(){return e.nailDown(2)})),c.Zb(),c.Zb(),c.Zb(),c.ac(86,"div",50),c.ac(87,"button",51),c.ic("click",(function(){return e.goBack()})),c.Pc(88,"\u8fd4\u56de "),c.Zb(),c.ac(89,"button",52),c.ic("click",(function(){return e.submitForm()})),c.Pc(90,"\u4fdd\u5b58"),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb()),2&t){const t=c.Cc(24);c.Eb(2),c.Mc("width",e.width,"px"),c.Eb(5),c.tc("professionId",e.professionId)("defaultCheckedKeys",e.defaultTreeKey)("fullNode",!0)("allNodes",!0),c.Eb(7),c.Qc(e.title),c.Eb(1),c.tc("formGroup",e.validateForm),c.Eb(2),c.tc("nzSm",3)("nzXs",24),c.Eb(2),c.tc("nzSm",21)("nzXs",24)("nzErrorTip",t),c.Eb(3),c.Rc("",e.validateForm.value.title.length,"/30"),c.Eb(6),c.tc("nzSm",6)("nzXs",24),c.Eb(2),c.tc("nzSm",18)("nzXs",24)("nzErrorTip",t),c.Eb(3),c.Rc("",null==e.validateForm.value.authorName?null:e.validateForm.value.authorName.length,"/30"),c.Eb(6),c.tc("nzSm",6)("nzXs",24),c.Eb(2),c.tc("nzSm",18)("nzXs",24),c.Eb(2),c.tc("ngForOf",e.learnTargetArr),c.Eb(2),c.tc("nzSm",3)("nzXs",24),c.Eb(2),c.tc("nzSm",21)("nzXs",24),c.Eb(1),c.tc("nzSpinning",e.isBackgroundLoading)("nzDelay",0),c.Eb(1),c.tc("editor",e.Editor)("config",e.backgroundConfig),c.Eb(1),c.Mc("color",e.getContentLength(e.validateForm.value.background)<5e3?"rgb(95, 95, 95)":"red"),c.Eb(1),c.Rc("",e.getContentLength(e.validateForm.value.background)," /5000"),c.Eb(1),c.tc("ngStyle",c.xc(74,Wt,e.dailDown0?"visible":"hidden")),c.Eb(1),c.tc("ngStyle",c.xc(76,Wt,e.dailDown0?"hidden":"visible")),c.Eb(1),c.tc("ngStyle",c.xc(78,Wt,e.dailDown0?"visible":"hidden")),c.Eb(2),c.tc("nzSm",3)("nzXs",24),c.Eb(2),c.tc("nzSm",21)("nzXs",24),c.Eb(1),c.tc("multiple",!0),c.Eb(6),c.tc("nzSm",3)("nzXs",24),c.Eb(2),c.tc("nzSm",21)("nzXs",24),c.Eb(1),c.tc("nzSpinning",e.isAnalysisLoading)("nzDelay",0),c.Eb(1),c.tc("editor",e.Editor)("config",e.analysisConfig),c.Eb(1),c.Mc("color",e.getContentLength(e.validateForm.value.analysis)<5e3?"rgb(95, 95, 95)":"red"),c.Eb(1),c.Rc("",e.getContentLength(e.validateForm.value.analysis)," /5000"),c.Eb(1),c.tc("ngStyle",c.xc(80,Wt,e.dailDown1?"visible":"hidden")),c.Eb(1),c.tc("ngStyle",c.xc(82,Wt,e.dailDown1?"hidden":"visible")),c.Eb(1),c.tc("ngStyle",c.xc(84,Wt,e.dailDown1?"visible":"hidden")),c.Eb(2),c.tc("nzSm",3)("nzXs",24),c.Eb(2),c.tc("nzSm",21)("nzXs",24),c.Eb(1),c.tc("nzSpinning",e.isGuideLoading)("nzDelay",0),c.Eb(1),c.tc("editor",e.Editor)("config",e.guideConfig),c.Eb(1),c.Mc("color",e.getContentLength(e.validateForm.value.guide)<5e3?"rgb(95, 95, 95)":"red"),c.Eb(1),c.Rc("",e.getContentLength(e.validateForm.value.guide)," /5000"),c.Eb(1),c.tc("ngStyle",c.xc(86,Wt,e.dailDown2?"visible":"hidden")),c.Eb(1),c.tc("ngStyle",c.xc(88,Wt,e.dailDown2?"hidden":"visible")),c.Eb(1),c.tc("ngStyle",c.xc(90,Wt,e.dailDown2?"visible":"hidden")),c.Eb(4),c.tc("disabled",100!==e.percent||null)("nzLoading",e.saveLoading)}},directives:[k.a,R.a,k.c,M.a,_.a,S.y,S.p,Tt.b,S.i,O.c,Tt.c,O.a,Tt.d,Tt.a,x.b,S.c,S.o,S.g,E.d,v.m,Zt.a,Lt.a,v.o,D.d,Rt.a,I.a,T.a,v.n,E.a],styles:[".margin-btn[_ngcontent-%COMP%]{margin-left:15px}.light-color[_ngcontent-%COMP%]{color:red}.container[_ngcontent-%COMP%]{background-color:#fff;padding:10px;height:100%}.container[_ngcontent-%COMP%]   .editor-icon[_ngcontent-%COMP%]{cursor:pointer}.container[_ngcontent-%COMP%]   .move-handler[_ngcontent-%COMP%]{position:absolute;top:-17px;left:50%;transform:translateX(-50%);font-size:17px;cursor:move;color:#777;border-bottom:1px solid #c4c4c4}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:10px}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:500}.resource-container[_ngcontent-%COMP%]{height:100%;overflow:hidden;display:flex;position:relative}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]{min-width:200px;overflow-y:auto;overflow-x:hidden}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]   .right-wrap[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;justify-content:center}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{background:#fff;border:1px solid #ddd;text-align:center;font-size:12px;height:20px;line-height:20px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]{position:relative;padding-left:30px;height:100%;flex:1;border-left:1px solid #ddd;overflow-x:hidden;overflow-y:auto}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .right-title[_ngcontent-%COMP%]{font-size:18px;margin-bottom:15px;position:absolute;top:0;left:26px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .case-form[_ngcontent-%COMP%]{height:calc(100% - 88px);margin-top:44px}.source-header[_ngcontent-%COMP%]{font-weight:bolder}.submit-footer[_ngcontent-%COMP%]{position:absolute;top:0;right:0;text-align:center}[_nghost-%COMP%]     .ant-tree-title{max-width:200px;display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}"]}),t})();var Kt=n("bE2y");const Qt=["treeContainer"],Jt=["treeknowledge"],Yt=function(){return{"max-width":"800px"}};function te(t,e){if(1&t&&c.Vb(0,"i",44),2&t){c.lc();const t=c.Cc(17);c.tc("nzTooltipTitle",t)("nzTooltipOverlayStyle",c.wc(2,Yt))}}function ee(t,e){1&t&&(c.ac(0,"div"),c.Pc(1,"1\u3001\u5efa\u8bae\u4f18\u5148WPS\u5236\u4f5cPPT\uff1b"),c.Zb(),c.ac(2,"div"),c.Pc(3,"2\u3001\u5c3d\u91cf\u5c11\u7528\u7b2c\u4e09\u6a21\u677f\uff1b"),c.Zb(),c.ac(4,"div"),c.Pc(5,"3\u3001PPT\u7684\u6587\u4ef6\u5927\u5c0f\u5e94\u63a7\u5236\u5728100M\u4e4b\u5185"),c.Zb())}const ne=function(){return{standalone:!0}};function ie(t,e){if(1&t){const t=c.bc();c.ac(0,"div",17),c.ac(1,"div",18),c.ac(2,"nz-form-item"),c.ac(3,"nz-form-label",45),c.Pc(4,"\u521b\u5efa\u4eba "),c.Zb(),c.ac(5,"nz-form-control",46),c.ac(6,"input",47),c.ic("ngModelChange",(function(e){return c.Ec(t),c.lc().createrName=e})),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb()}if(2&t){const t=c.lc();c.Eb(3),c.tc("nzSm",6)("nzXs",24),c.Eb(2),c.tc("nzSm",18)("nzXs",24),c.Eb(1),c.tc("ngModel",t.createrName)("ngModelOptions",c.wc(7,ne))("disabled",!0)}}function oe(t,e){if(1&t&&c.Vb(0,"nz-option",48),2&t){const t=e.$implicit;c.tc("nzValue",t.id)("nzLabel",t.name)}}function ae(t,e){1&t&&(c.Yb(0),c.Pc(1,"\u8d44\u6e90\u6807\u9898\u4e0d\u80fd\u8d85\u8fc730\u4e2a\u5b57"),c.Xb())}function ce(t,e){1&t&&(c.Yb(0),c.Pc(1,"\u8d44\u6e90\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a"),c.Xb())}function re(t,e){if(1&t&&(c.Nc(0,ae,2,0,"ng-container",50),c.Nc(1,ce,2,0,"ng-container",50)),2&t){const t=e.$implicit;c.tc("ngIf",t.hasError("maxlength")),c.Eb(1),c.tc("ngIf",t.hasError("required"))}}function se(t,e){if(1&t){const t=c.bc();c.ac(0,"div",18),c.ac(1,"nz-form-item"),c.ac(2,"nz-form-label",32),c.Pc(3,"\u8d44\u6e90\u6807\u9898 "),c.Zb(),c.ac(4,"nz-form-control",33),c.ac(5,"input",49),c.ic("keyup.enter",(function(){return c.Ec(t),c.lc().submitForm()})),c.Zb(),c.ac(6,"span",35),c.Pc(7),c.Zb(),c.Nc(8,re,2,2,"ng-template",null,36,c.Oc),c.Zb(),c.Zb(),c.Zb()}if(2&t){const t=c.Cc(9),e=c.lc();c.Eb(2),c.tc("nzSm",6)("nzXs",24),c.Eb(2),c.tc("nzSm",18)("nzXs",24)("nzErrorTip",t),c.Eb(3),c.Rc("",null==e.validateForm.value.title?null:e.validateForm.value.title.length,"/30")}}function le(t,e){1&t&&(c.Yb(0),c.Pc(1,"\u4f5c\u8005\u540d\u79f0\u4e0d\u80fd\u8d85\u8fc730\u4e2a\u5b57"),c.Xb())}function de(t,e){1&t&&(c.Yb(0),c.Pc(1,"\u4f5c\u8005\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a"),c.Xb())}function he(t,e){if(1&t&&(c.Nc(0,le,2,0,"ng-container",50),c.Nc(1,de,2,0,"ng-container",50)),2&t){const t=e.$implicit;c.tc("ngIf",t.hasError("maxlength")),c.Eb(1),c.tc("ngIf",t.hasError("required"))}}function ge(t,e){1&t&&(c.Yb(0),c.Pc(1,"\u6c34\u5370\u6587\u5b57\u4e0d\u80fd\u8d85\u8fc730\u4e2a\u5b57"),c.Xb())}function ue(t,e){1&t&&(c.Yb(0),c.Pc(1,"\u6c34\u5370\u6587\u5b57\u4e0d\u80fd\u4e3a\u7a7a"),c.Xb())}function pe(t,e){if(1&t&&(c.Nc(0,ge,2,0,"ng-container",50),c.Nc(1,ue,2,0,"ng-container",50)),2&t){const t=e.$implicit;c.tc("ngIf",t.hasError("maxlength")),c.Eb(1),c.tc("ngIf",t.hasError("required"))}}function fe(t,e){if(1&t){const t=c.bc();c.ac(0,"div",17),c.ac(1,"div",18),c.ac(2,"nz-form-item"),c.ac(3,"nz-form-label",32),c.Pc(4,"\u6c34\u5370\u6587\u5b57 "),c.Zb(),c.ac(5,"nz-form-control",33),c.ac(6,"input",51),c.ic("keyup.enter",(function(){return c.Ec(t),c.lc().submitForm()})),c.Zb(),c.ac(7,"span",35),c.Pc(8),c.Zb(),c.Nc(9,pe,2,2,"ng-template",null,36,c.Oc),c.Zb(),c.Zb(),c.Zb(),c.Zb()}if(2&t){const t=c.Cc(10),e=c.lc();c.Eb(3),c.tc("nzSm",6)("nzXs",24),c.Eb(2),c.tc("nzSm",18)("nzXs",24)("nzErrorTip",t),c.Eb(3),c.Rc("",null==e.validateForm.value.watermarkText?null:e.validateForm.value.watermarkText.length,"/30")}}let be=(()=>{class t{constructor(t,e,n,i,o,a){this.message=t,this.materialLibService=e,this.menuService=n,this.fb=i,this.route=o,this.modalService=a,this.wid=-1,this.professionId="",this.knowledgePointIds=[],this.title="",this.id="",this.coursewareType="",this.isEdit=!1,this.learnTargetArr=r.f,this.isSaveLoading=!1,this.defaultTreeKey=[],this.minType=5,this.createrName="",this.code="",this.orgCode=g.a.getOrgCode()}ngOnInit(){this.initParam(),this.initializeData()}initializeData(){"0"===this.id?(this.isEdit=!1,this.title="\u65b0\u589e"+Object(r.k)(this.coursewareType,"MATERIAL_TYPE"),this.initializeForm({})):(this.isEdit=!0,this.title="\u7f16\u8f91"+Object(r.k)(this.coursewareType,"MATERIAL_TYPE"),this.initializeForm({}),this.materialLibService.getResourceDetail(this.id,this.coursewareType).subscribe(t=>{200===t.status&&(this.createrName=t.data.createrName,this.initializeForm(t.data))}))}initParam(){this.code=this.route.snapshot.queryParams.code;const t=this.route.snapshot.paramMap;this.id=t.get("id"),this.coursewareType=t.get("type"),this.professionId=t.get("professionId")}onResize({width:t}){const e=this.treeContainer&&this.treeContainer.nativeElement&&this.treeContainer.nativeElement.offsetWidth;e&&this.treeContainer.nativeElement.offsetWidth+80<t||e&&this.treeContainer.nativeElement.offsetWidth+10>t||(cancelAnimationFrame(this.wid),this.wid=requestAnimationFrame(()=>{this.width=t}))}initializeForm(t){const{id:e,learningGoalCode:n,attachmentName:i,resourceUrl:o,title:a,authorName:c,watermarkText:r,isWatermark:s}=t;this.validateForm=this.fb.group({id:[this.isEdit?e:""],points:[[]],title:this.isEdit?[t.title,[S.w.required,Object(kt.b)(),S.w.maxLength(30)]]:["",[]],type:[this.coursewareType],coursewareType:[this.coursewareType],learningGoalCode:[this.isEdit?n:"",[S.w.required]],uploadFileArr:[this.isEdit?[{name:i,path:o,title:a}]:[]],authorName:[this.isEdit?c:"zksd"===this.orgCode?"\u8003\u62c9\u65e5\u8bb0":"\u6052\u4f01\u6559\u80b2",[S.w.required,Object(kt.b)(),S.w.maxLength(30)]],watermarkText:[this.isEdit?r:"zksd"===this.orgCode?"\u8003\u62c9\u65e5\u8bb0":"\u6052\u4f01\u6559\u80b2",[S.w.required,Object(kt.b)(),S.w.maxLength(30)]],isWatermark:[this.isEdit?s:"1",[S.w.required]]}),this.isEdit&&t.resourcePoints&&t.resourcePoints[0]&&t.resourcePoints[0].knowledgePointId&&(this.knowledgePointIds=this.defaultTreeKey=t.resourcePoints.map(({knowledgePointId:t})=>t))}submitForm(){"1"!==this.validateForm.value.isWatermark?this.validateForm.get("watermarkText").clearValidators():this.validateForm.get("watermarkText").setValidators([S.w.required,Object(kt.b)(),S.w.maxLength(30)]);for(const n in this.validateForm.controls)this.validateForm.controls[n].markAsDirty(),this.validateForm.controls[n].updateValueAndValidity();if(this.validateForm.invalid)return void this.message.warning("\u8bf7\u6309\u89c4\u5219\u586b\u5199\u5b8c\u6574");const t=JSON.parse(JSON.stringify(this.validateForm.value));if(t.type=this.coursewareType,t.coursewareType=this.coursewareType,this.knowledgePointIds.length?(t.pointType=1,t.points=this.knowledgePointIds.map(t=>t)):(t.pointType=2,t.points=[this.treeknowledge.nodes[0].id]),0===t.uploadFileArr.length)return void this.message.warning("\u8bf7\u4e0a\u4f20\u8d44\u6e90");let e=!1;if(this.isEdit)t.attachmentInfos=t.uploadFileArr.map(n=>(n.path||(e=!0),{attachmentName:n.name,attachmentPath:n.path,title:t.title}));else{t.attachmentInfos=[];for(let n=0;n<t.uploadFileArr.length;n++){const i=t.uploadFileArr[n];if(i.path||(e=!0),t.attachmentInfos.push({attachmentName:i.name,attachmentPath:i.path,title:i.title}),!i.title)return void this.message.warning("\u8d44\u6e90\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a")}}e?this.message.warning("\u8bf7\u7b49\u5f85\u8d44\u6e90\u4e0a\u4f20\u5b8c\u6210"):(delete t.uploadFileArr,5===this.minType&&0===this.knowledgePointIds.length?this.modalService.warning({nzTitle:"\u672a\u9009\u62e9\u77e5\u8bc6\u70b9\u8d44\u6599\u5c06\u6302\u5230\u8bfe\u7a0b\uff0c\u786e\u5b9a\u5417\uff1f",nzCancelText:"\u53d6\u6d88",nzOkText:"\u786e\u5b9a",nzOnOk:()=>this.savaRecourse(t)}):2===t.pointType?this.modalService.warning({nzTitle:"\u9009\u62e9\u7684\u8282\u70b9\u672a\u5305\u542b\u77e5\u8bc6\u70b9\uff0c\u8d44\u6599\u5c06\u6302\u5230\u8bfe\u7a0b\uff0c\u786e\u5b9a\u5417\uff1f",nzCancelText:"\u53d6\u6d88",nzOkText:"\u786e\u5b9a",nzOnOk:()=>this.savaRecourse(t)}):this.savaRecourse(t))}savaRecourse(t){return new Promise(e=>{this.isSaveLoading=!0,this.materialLibService.saveCourseware(t).subscribe(t=>{this.isSaveLoading=!1,201===t.status?(e(!0),this.goBack()):(500===t.status&&this.message.error("\u670d\u52a1\u7aef\u4e1a\u52a1\u5f02\u5e38"),e(!1))},()=>{e(!1),this.isSaveLoading=!1})})}nodeChange(t){this.knowledgePointIds=this.getCheckedLeafKey(t);const e={minType:5};this.getMinLavel(t,e),this.minType=e.minType}getMinLavel(t,e){t.length&&t.forEach(t=>{t.origin&&t.origin.children&&t.origin.children.length&&this.getMinLavel(t.children,e),e.minType>t.origin.kType&&(e.minType=t.origin.kType)})}getCheckedLeafKey(t){const e=[],n=t=>{for(let i=0;i<t.length;i++){const o=t[i]instanceof Mt.d?t[i].origin:t[i];o.children&&o.children.length>0?n(o.children):o.isLeaf&&o.checked&&"4"===o.kType&&e.push(o.id)}};return n(t),e}goBack(){this.menuService.goBack(!1),this.menuService.gotoUrl({url:"/m/rm/read",paramUrl:"",title:"\u9605\u8bfb\u5e93"})}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(z.e),c.Ub(f.a),c.Ub(b.a),c.Ub(S.d),c.Ub(o.a),c.Ub(m.e))},t.\u0275cmp=c.Ob({type:t,selectors:[["app-material-other"]],viewQuery:function(t,e){var n;1&t&&(c.Vc(Qt,!0),c.Vc(Jt,!0)),2&t&&(c.Bc(n=c.jc())&&(e.treeContainer=n.first),c.Bc(n=c.jc())&&(e.treeknowledge=n.first))},inputs:{type:"type"},decls:71,vars:39,consts:[[1,"container"],[1,"resource-container"],["nz-resizable","",1,"left-tree",3,"nzResize"],[2,"margin-bottom","15px","font-size","15px"],[2,"display","inline-block","overflow","hidden","margin-right","30px"],["treeContainer",""],["model","check",3,"professionId","defaultCheckedKeys","fullNode","allNodes","nodeChange"],["treeknowledge",""],["nzDirection","right"],[1,"right-wrap"],["nz-icon","","nzType","more","nzTheme","outline",1,"right"],[1,"right-resource"],[2,"margin-bottom","15px","font-size","18px"],["nz-icon","","nzType","question-circle","nzTheme","outline","nz-tooltip","","class","font-question",3,"nzTooltipTitle","nzTooltipOverlayStyle",4,"ngIf"],["titleTip",""],["nz-form","",1,"case-form",3,"formGroup"],["nz-row","",4,"ngIf"],["nz-row",""],["nz-col","","nzSpan","15"],["nzRequired","","nzFor","learningGoalCode",2,"text-align","left",3,"nzSm","nzXs"],["nzErrorTip","\u8bf7\u9009\u62e9\u5b66\u4e60\u76ee\u6807","nzHasFeedback","",3,"nzSm","nzXs"],["formControlName","learningGoalCode","nzAllowClear","","nzPlaceHolder","\u8bf7\u9009\u62e9\u5b66\u4e60\u76ee\u6807"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nz-col","","nzSpan","15",4,"ngIf"],["nz-row","","nzSpan","15"],["nzFor","uploadFileArr","nzRequired","",2,"text-align","left",3,"nzSm","nzXs"],["nzErrorTip","\u8bf7\u4e0a\u4f20\u6587\u4ef6",3,"nzSm","nzXs"],["materialType","other","formControlName","uploadFileArr",2,"width","100%",3,"isDrag","multiple","maxSize","limit","type","acceptType"],[1,"ant-upload-drag-icon"],["nz-icon","","nzType","inbox"],[1,"ant-upload-text"],[1,"ant-upload-hint"],["nzRequired","","nzFor","title",2,"text-align","left",3,"nzSm","nzXs"],["nzHasFeedback","",3,"nzSm","nzXs","nzErrorTip"],["nz-input","","formControlName","authorName","placeholder","\u8bf7\u8f93\u5165\u4f5c\u8005\u540d\u79f0...",2,"width","calc(100% - 80px)",3,"keyup.enter"],[2,"margin-left","10px"],["titleTpl",""],["nzHasFeedback","",3,"nzSm","nzXs"],["formControlName","isWatermark"],["nz-radio","","nzValue","1"],["nz-radio","","nzValue","0"],[1,"submit-footer"],["nz-button","","nzType","default",2,"margin-right","20px",3,"click"],["nz-button","","nzType","primary",3,"nzLoading","click"],["nz-icon","","nzType","question-circle","nzTheme","outline","nz-tooltip","",1,"font-question",3,"nzTooltipTitle","nzTooltipOverlayStyle"],[2,"text-align","left",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],["nz-input","",3,"ngModel","ngModelOptions","disabled","ngModelChange"],[3,"nzValue","nzLabel"],["nz-input","","formControlName","title","placeholder","\u8bf7\u8f93\u5165\u6807\u9898...",2,"width","calc(100% - 80px)",3,"keyup.enter"],[4,"ngIf"],["nz-input","","formControlName","watermarkText","placeholder","\u8bf7\u8f93\u5165\u6c34\u5370\u6587\u5b57...",2,"width","calc(100% - 80px)",3,"keyup.enter"]],template:function(t,e){if(1&t&&(c.ac(0,"div",0),c.ac(1,"section",1),c.ac(2,"section",2),c.ic("nzResize",(function(t){return e.onResize(t)})),c.ac(3,"p",3),c.Pc(4,"\u9009\u62e9\u77e5\u8bc6\u70b9(\u4e0d\u652f\u6301\u8de8\u5b66\u79d1\u77e5\u8bc6\u70b9)"),c.Zb(),c.ac(5,"div",4,5),c.ac(7,"qkc-tree-knowledgegraph",6,7),c.ic("nodeChange",(function(t){return e.nodeChange(t)})),c.Zb(),c.Zb(),c.ac(9,"nz-resize-handle",8),c.ac(10,"div",9),c.Vb(11,"i",10),c.Zb(),c.Zb(),c.Zb(),c.ac(12,"section",11),c.ac(13,"p",12),c.Pc(14),c.Nc(15,te,1,3,"i",13),c.Zb(),c.Nc(16,ee,6,0,"ng-template",null,14,c.Oc),c.ac(18,"form",15),c.Nc(19,ie,7,8,"div",16),c.ac(20,"div",17),c.ac(21,"div",18),c.ac(22,"nz-form-item"),c.ac(23,"nz-form-label",19),c.Pc(24,"\u5b66\u4e60\u76ee\u6807 "),c.Zb(),c.ac(25,"nz-form-control",20),c.ac(26,"nz-select",21),c.Nc(27,oe,1,2,"nz-option",22),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.ac(28,"div",17),c.Nc(29,se,10,6,"div",23),c.Zb(),c.ac(30,"div",17),c.ac(31,"div",18),c.ac(32,"nz-form-item",24),c.ac(33,"nz-form-label",25),c.Pc(34,"\u6dfb\u52a0\u6587\u4ef6 "),c.Zb(),c.ac(35,"nz-form-control",26),c.ac(36,"qkc-upload",27),c.ac(37,"p",28),c.Vb(38,"i",29),c.Zb(),c.ac(39,"p",30),c.Pc(40,"\u70b9\u51fb\u6216\u5c06\u6587\u4ef6\u62d6\u66f3\u5230\u8fd9\u91cc\u4e0a\u4f20"),c.Zb(),c.ac(41,"p",31),c.Pc(42),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.ac(43,"div",17),c.ac(44,"div",18),c.ac(45,"nz-form-item"),c.ac(46,"nz-form-label",32),c.Pc(47,"\u4f5c\u8005\u540d\u79f0 "),c.Zb(),c.ac(48,"nz-form-control",33),c.ac(49,"input",34),c.ic("keyup.enter",(function(){return e.submitForm()})),c.Zb(),c.ac(50,"span",35),c.Pc(51),c.Zb(),c.Nc(52,he,2,2,"ng-template",null,36,c.Oc),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.ac(54,"div",17),c.ac(55,"div",18),c.ac(56,"nz-form-item"),c.ac(57,"nz-form-label",32),c.Pc(58,"\u6c34\u5370\u5f00\u5173 "),c.Zb(),c.ac(59,"nz-form-control",37),c.ac(60,"nz-radio-group",38),c.ac(61,"label",39),c.Pc(62,"\u5f00\u542f"),c.Zb(),c.ac(63,"label",40),c.Pc(64,"\u5173\u95ed"),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Nc(65,fe,11,6,"div",16),c.Zb(),c.ac(66,"div",41),c.ac(67,"button",42),c.ic("click",(function(){return e.goBack()})),c.Pc(68,"\u8fd4\u56de "),c.Zb(),c.ac(69,"button",43),c.ic("click",(function(){return e.submitForm()})),c.Pc(70,"\u4fdd\u5b58 "),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb()),2&t){const t=c.Cc(53);c.Eb(2),c.Mc("width",e.width,"px"),c.Eb(5),c.tc("professionId",e.professionId)("defaultCheckedKeys",e.defaultTreeKey)("fullNode",!0)("allNodes",!0),c.Eb(7),c.Rc("",e.title," "),c.Eb(1),c.tc("ngIf","101"===e.coursewareType),c.Eb(3),c.tc("formGroup",e.validateForm),c.Eb(1),c.tc("ngIf",e.isEdit),c.Eb(4),c.tc("nzSm",6)("nzXs",24),c.Eb(2),c.tc("nzSm",18)("nzXs",24),c.Eb(2),c.tc("ngForOf",e.learnTargetArr),c.Eb(2),c.tc("ngIf",e.isEdit),c.Eb(4),c.tc("nzSm",6)("nzXs",24),c.Eb(2),c.tc("nzSm",18)("nzXs",24),c.Eb(1),c.uc("type",e.isEdit?"other-edit":"other-add"),c.tc("isDrag",!0)("multiple",!0)("maxSize","101"==e.coursewareType?100:void 0)("limit",10)("acceptType","103"==e.coursewareType?"mp4":"png,jpg,jpeg,ppt,pptx,doc,docx,pdf,xls,xlsx,rar,zip"),c.Eb(6),c.Rc(" \u652f\u6301\u6269\u5c55\u540d: ","103"==e.coursewareType?"mp4":"png\u3001jpg\u3001jpeg\u3001ppt\u3001pptx\u3001doc\u3001docx\u3001pdf\u3001xls\u3001xlsx\u3001rar\u3001zip"," "),c.Eb(4),c.tc("nzSm",6)("nzXs",24),c.Eb(2),c.tc("nzSm",18)("nzXs",24)("nzErrorTip",t),c.Eb(3),c.Rc("",null==e.validateForm.value.authorName?null:e.validateForm.value.authorName.length,"/30"),c.Eb(6),c.tc("nzSm",6)("nzXs",24),c.Eb(2),c.tc("nzSm",18)("nzXs",24),c.Eb(6),c.tc("ngIf","1"===e.validateForm.value.isWatermark),c.Eb(4),c.tc("nzLoading",e.isSaveLoading)}},directives:[k.a,R.a,k.c,M.a,_.a,v.n,S.y,S.p,Tt.b,S.i,O.c,O.a,Tt.c,Tt.d,Tt.a,E.d,S.o,S.g,v.m,Rt.a,x.b,S.c,Kt.c,Kt.b,I.a,T.a,D.d,S.q,E.a],styles:[".margin-btn[_ngcontent-%COMP%]{margin-left:15px}.light-color[_ngcontent-%COMP%]{color:red}.container[_ngcontent-%COMP%]{background-color:#fff;padding:10px;height:100%}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:10px}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:500}.resource-container[_ngcontent-%COMP%]{height:100%;overflow:hidden;display:flex}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]{min-width:200px;overflow-y:auto;overflow-x:hidden}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]   .right-wrap[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;justify-content:center}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{background:#fff;border:1px solid #ddd;text-align:center;font-size:12px;height:20px;line-height:20px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]{position:relative;padding-left:30px;height:100%;flex:1;border-left:1px solid #ddd;overflow:hidden}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .case-form[_ngcontent-%COMP%]{height:calc(100% - 88px);overflow:hidden;overflow-y:auto}.source-header[_ngcontent-%COMP%]{font-weight:bolder}.submit-footer[_ngcontent-%COMP%]{position:absolute;top:0;right:0;text-align:center}[_nghost-%COMP%]     .ant-upload.ant-upload-drag .ant-upload{padding:20px}[_nghost-%COMP%]     .ant-tree-title{max-width:200px;display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.font-question[_ngcontent-%COMP%]{font-size:20px;cursor:pointer;color:#fff;background-color:#1890ff;border-radius:50%}"]}),t})();function me(t,e){1&t&&c.Vb(0,"app-material-case")}function ze(t,e){if(1&t&&c.Vb(0,"app-material-other",2),2&t){const t=c.lc();c.tc("type",t.type)}}let Pe=(()=>{class t{constructor(t){this.route=t,this.type=""}ngOnInit(){this.type=this.route.snapshot.paramMap.get("type")}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(o.a))},t.\u0275cmp=c.Ob({type:t,selectors:[["app-material-lib-details"]],decls:2,vars:2,consts:[[4,"ngIf"],[3,"type",4,"ngIf"],[3,"type"]],template:function(t,e){1&t&&(c.Nc(0,me,1,0,"app-material-case",0),c.Nc(1,ze,1,1,"app-material-other",1)),2&t&&(c.tc("ngIf","104"===e.type),c.Eb(1),c.tc("ngIf","104"!==e.type))},directives:[v.n,Ht,be],styles:[""]}),t})();var Ce=n("hB+3"),ve=n("KQH3"),ye=n("5vDB");function we(t,e){if(1&t){const t=c.bc();c.Yb(0),c.ac(1,"li",2),c.ic("click",(function(){c.Ec(t);const n=e.$implicit;return c.lc().selectItem(n)})),c.ac(2,"span",3),c.Pc(3),c.Zb(),c.Zb(),c.Xb()}if(2&t){const t=e.$implicit,n=c.lc();c.Eb(1),c.tc("nzSelected",n.defaultSelect==t.id),c.Eb(2),c.Qc(t.name)}}let Oe=(()=>{class t{constructor(){this.menus=[],this.menuChange=new c.n}ngOnInit(){}selectItem(t){this.menuChange.emit(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Ob({type:t,selectors:[["qkc-menu"]],inputs:{menus:"menus",defaultSelect:"defaultSelect"},outputs:{menuChange:"menuChange"},decls:2,vars:1,consts:[["nz-menu","","nzMode","inline"],[4,"ngFor","ngForOf"],["nz-menu-item","",3,"nzSelected","click"],[1,"c_name"]],template:function(t,e){1&t&&(c.ac(0,"ul",0),c.Nc(1,we,4,2,"ng-container",1),c.Zb()),2&t&&(c.Eb(1),c.tc("ngForOf",e.menus))},directives:[w.c,v.m,w.d],styles:["[_nghost-%COMP%]     .ant-menu-item{text-align:right}.c_name[_ngcontent-%COMP%]{display:inline-block;max-width:200px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}"]}),t})();var ke=n("8pq7");let Me=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Ob({type:t,selectors:[["qkc-media-audio"]],inputs:{title:"title",url:"url"},decls:19,vars:7,consts:[[1,"container"],[1,"header"],["vgFor","my-video"],[1,"body"],[1,"item-size"],[1,"item-size",2,"margin","0"],[1,"timer-container"],["vgFor","my-video",1,"item-size",3,"vgProperty","vgFormat"],[1,"divider"],["id","my-video","preload","auto",3,"vgMedia"],["media",""],["type","audio/mp3",3,"src"]],template:function(t,e){if(1&t&&(c.ac(0,"vg-player",0),c.ac(1,"div",1),c.ac(2,"div"),c.Pc(3),c.Zb(),c.ac(4,"div"),c.Vb(5,"vg-volume",2),c.Zb(),c.Zb(),c.ac(6,"vg-controls",3),c.Vb(7,"vg-play-pause",4),c.ac(8,"vg-scrub-bar",5),c.Vb(9,"vg-scrub-bar-current-time"),c.Vb(10,"vg-scrub-bar-buffering-time"),c.Zb(),c.ac(11,"div",6),c.Vb(12,"vg-time-display",7),c.ac(13,"div",8),c.Pc(14,"/"),c.Zb(),c.Vb(15,"vg-time-display",7),c.Zb(),c.Zb(),c.ac(16,"audio",9,10),c.Vb(18,"source",11),c.Zb(),c.Zb()),2&t){const t=c.Cc(17);c.Eb(3),c.Rc(" ",e.title," "),c.Eb(9),c.tc("vgProperty","current")("vgFormat","mm:ss"),c.Eb(3),c.tc("vgProperty","total")("vgFormat","mm:ss"),c.Eb(1),c.tc("vgMedia",t),c.Eb(2),c.tc("src",e.url,c.Hc)}},directives:[ke.o,ke.h,ke.e,ke.i,ke.j,ke.l,ke.k,ke.m,ke.n],styles:[".container[_ngcontent-%COMP%]{height:60px;display:block;background-color:#3b3b4b}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{height:30px;font-size:14px;color:#fff;padding:0 8px;display:flex;justify-content:space-between;align-items:center}.container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{height:30px;background-color:#3b3b4b}.container[_ngcontent-%COMP%]   .timer-container[_ngcontent-%COMP%]{flex:0 0 95px;justify-content:space-between;display:flex;padding:0 8px}.container[_ngcontent-%COMP%]   .item-size[_ngcontent-%COMP%]{height:30px;width:30px;line-height:30px}.container[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]{height:30px;line-height:30px;color:#fff;font-size:12px}"]}),t})();function _e(t,e){if(1&t&&(c.ac(0,"div"),c.Vb(1,"qkc-media-audio",21),c.Zb()),2&t){const t=c.lc();c.Eb(1),c.tc("title",null==t.data||null==t.data.audioInfo?null:t.data.audioInfo.attachmentName)("url",null==t.data||null==t.data.audioInfo?null:t.data.audioInfo.attachmentPath)}}function xe(t,e){if(1&t&&c.Vb(0,"img",24),2&t){const t=c.lc().$implicit;c.tc("src",null==t?null:t.attachmentPath,c.Hc)}}function Se(t,e){if(1&t&&c.Vb(0,"img",24),2&t){const t=c.lc().$implicit;c.tc("src",null==t?null:t.thumbnail,c.Hc)}}function Ee(t,e){if(1&t){const t=c.bc();c.Yb(0),c.ac(1,"a",22),c.ic("click",(function(){c.Ec(t);const n=e.$implicit;return c.lc().previewAttachment(n)})),c.Nc(2,xe,1,1,"img",23),c.Nc(3,Se,1,1,"img",23),c.ac(4,"span"),c.Pc(5),c.Zb(),c.Zb(),c.Xb()}if(2&t){const t=e.$implicit;c.Eb(2),c.tc("ngIf",null==t?null:t.isPic),c.Eb(1),c.tc("ngIf",!(null!=t&&t.isPic)&&(null==t?null:t.thumbnail)),c.Eb(2),c.Qc(t.attachmentName)}}function Ie(t,e){if(1&t){const t=c.bc();c.ac(0,"app-resource-preview-modal",25),c.ic("closePreview",(function(){return c.Ec(t),c.lc().closePreview()})),c.Zb()}if(2&t){const t=c.lc();c.tc("isPreviewpolyway",t.isPreviewpolyway)("previewTitle",t.previewTitle)("resourceUrl",t.resourceUrl)}}const Te=function(){return{width:"150px"}};let Ze=(()=>{class t{constructor(t,e,n,i,o,a,c,s){this.materialLibService=t,this.route=e,this.menuService=n,this.scrollService=i,this.message=o,this.uploadOssService=a,this.renderer2=c,this.doc=s,this.data={},this.id="",this.type="",this.professionId="",this.activeId="",this.typeList=[{id:"1",name:"\u6848\u4f8b\u80cc\u666f"},{id:"2",name:"\u6848\u4f8b\u89e3\u6790"},{id:"3",name:"\u6559\u5b66\u6307\u5bfc"}],this.isShow=!1,this.isLoading=!1,this.isFullScreen=!1,this.Editor=St.a,this.config=Object.assign({},r.d),this.previewTitle="",this.isPreviewpolyway=!1,this.previewStart=!1}ngOnInit(){this.id=this.route.snapshot.paramMap.get("id"),this.type=this.route.snapshot.paramMap.get("type"),this.professionId=this.route.snapshot.paramMap.get("professionId"),this.getResourceDetail()}getResourceDetail(){this.isLoading=!0,this.materialLibService.getResourceDetail(this.id,this.type).subscribe(t=>{if(this.isLoading=!1,200===t.status){const e=t.data.attachment,n=e.find(t=>"mp3"===t.aattachmentExt);n&&(n.attachmentPath=p.a.OSS_URL+n.attachmentPath);const i=e.filter(t=>"mp3"!==t.aattachmentExt).map(t=>{const e=this.isPicture(t.aattachmentExt),n=this.isVideo(t.aattachmentExt),i=t.attachmentPath,o=p.a.OSS_URL+t.attachmentPath,a=e||n?o:p.a.ow365+o,c=Object(Ce.a)(t.aattachmentExt);return Object.assign(Object.assign({},t),{attachmentPath:a,isPic:e,isVideo:n,thumbnail:c,originAttachmentPath:i})});t.data.audioInfo=n,t.data.caseAttch=i,this.data=t.data}},t=>{this.isLoading=!1})}closePreview(){this.isPreviewpolyway=!1,this.resourceUrl="",this.previewTitle="",this.previewStart=!1}getContentLength(t){return t.replace(/<[^>]+>/g,"").replace(/&nbsp;/g,"a").replace(/\s/g,"a").replace(/[\u0391-\uFFE5]/g,"a").length}isPicture(t){return"jpg,jpeg,png".indexOf(t)>-1}isVideo(t){return/mp4|m2v|mkv|rmvb|wmv|avi|flv|mov/.test(t)}fullChange(t){this.isFullScreen=t}edit(){this.menuService.gotoUrl({url:"/m/sel/material-details",paramUrl:`/${this.id}/${this.type}/${this.professionId}`})}previewAttachment(t){"2"===t.sourceType?(this.resourceUrl=t.originAttachmentPath,this.previewTitle="",this.isPreviewpolyway=!0,this.previewStart=!0):(this.isPreviewpolyway=!1,this.resourceUrl=t.originAttachmentPath,this.previewTitle=t.attachmentName,this.previewStart=!0)}menuChange({id:t}){this.scrollService.scrollToAnchor("materialSection"+t)}backtolist(){this.menuService.goBack()}downloadAttachments(){window.open()}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(f.a),c.Ub(o.a),c.Ub(b.a),c.Ub(ve.l),c.Ub(z.e),c.Ub(It.a),c.Ub(c.E),c.Ub(v.d))},t.\u0275cmp=c.Ob({type:t,selectors:[["app-material-preview-case"]],decls:34,vars:22,consts:[["id","fullContainer",1,"container"],[1,"full-height",3,"nzSpinning","nzDelay"],[1,"header"],[1,"header-title"],["nz-button","","nzType","link","qkcFullscreen","","fullId","fullContainer",2,"float","right",3,"fullScreenChange"],["nz-icon","","nzTheme","outline",3,"nzType"],["nz-button","",2,"float","right","margin-top","3px",3,"click"],[2,"margin","12px 0 24px"],[1,"body"],[1,"left"],[3,"menus","ngStyle","menuChange"],[1,"middle"],["id","materialSection1"],[1,"edit-content",3,"editor","disabled","config","ngModel"],["id","materialSection2"],["id","materialSection3"],[1,"right"],[4,"ngIf"],["nzText","\u9644\u4ef6\u5217\u8868"],[4,"ngFor","ngForOf"],[3,"isPreviewpolyway","previewTitle","resourceUrl","closePreview",4,"ngIf"],[3,"title","url"],[1,"attach-block",3,"click"],["alt","thumbnail",3,"src",4,"ngIf"],["alt","thumbnail",3,"src"],[3,"isPreviewpolyway","previewTitle","resourceUrl","closePreview"]],template:function(t,e){1&t&&(c.ac(0,"div",0),c.ac(1,"nz-spin",1),c.ac(2,"div",2),c.ac(3,"div",3),c.Pc(4),c.Zb(),c.ac(5,"div"),c.ac(6,"button",4),c.ic("fullScreenChange",(function(t){return e.fullChange(t)})),c.Vb(7,"i",5),c.Zb(),c.ac(8,"button",6),c.ic("click",(function(){return e.backtolist()})),c.Pc(9,"\u8fd4\u56de"),c.Zb(),c.Zb(),c.Zb(),c.Vb(10,"nz-divider",7),c.ac(11,"div",8),c.ac(12,"div",9),c.ac(13,"qkc-menu",10),c.ic("menuChange",(function(t){return e.menuChange(t)})),c.Zb(),c.Zb(),c.ac(14,"div",11),c.ac(15,"div",12),c.ac(16,"h2"),c.Pc(17,"\u6848\u4f8b\u80cc\u666f"),c.Zb(),c.Vb(18,"ckeditor",13),c.Zb(),c.ac(19,"div",14),c.ac(20,"h2"),c.Pc(21,"\u6848\u4f8b\u89e3\u6790"),c.Zb(),c.Vb(22,"ckeditor",13),c.Zb(),c.ac(23,"div",15),c.ac(24,"h2"),c.Pc(25,"\u6559\u5b66\u6307\u5bfc"),c.Zb(),c.Vb(26,"ckeditor",13),c.Zb(),c.Zb(),c.ac(27,"div",16),c.ac(28,"div"),c.Nc(29,_e,2,2,"div",17),c.ac(30,"div"),c.Vb(31,"nz-divider",18),c.Nc(32,Ee,6,3,"ng-container",19),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Nc(33,Ie,1,3,"app-resource-preview-modal",20)),2&t&&(c.Eb(1),c.tc("nzSpinning",e.isLoading)("nzDelay",0),c.Eb(3),c.Qc(null==e.data?null:e.data.title),c.Eb(3),c.tc("nzType",e.isFullScreen?"fullscreen-exit":"fullscreen"),c.Eb(6),c.tc("menus",e.typeList)("ngStyle",c.wc(21,Te)),c.Eb(5),c.tc("editor",e.Editor)("disabled",!0)("config",e.config)("ngModel",null==e.data?null:e.data.background),c.Eb(4),c.tc("editor",e.Editor)("disabled",!0)("config",e.config)("ngModel",null==e.data?null:e.data.analysis),c.Eb(4),c.tc("editor",e.Editor)("disabled",!0)("config",e.config)("ngModel",null==e.data?null:e.data.guide),c.Eb(3),c.tc("ngIf",null==e.data?null:e.data.audioInfo),c.Eb(3),c.tc("ngForOf",null==e.data?null:e.data.caseAttch),c.Eb(1),c.tc("ngIf",e.previewStart))},directives:[Zt.a,I.a,M.a,ve.i,_.a,T.a,ye.a,Oe,v.o,Lt.a,S.o,S.q,v.n,v.m,Me,U.a],styles:[".container[_ngcontent-%COMP%]{background-color:#fff;padding:10px;height:100%;overflow:scroll}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.container[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]{font-size:18px;font-weight:500;line-height:32px;margin-left:20px}.container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{display:flex;height:calc(100% - 82px)}.container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{flex:0 0 150px}.container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   .left-fixed[_ngcontent-%COMP%]{position:fixed}.container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .middle[_ngcontent-%COMP%]{flex:1;padding:0 15px 10px;overflow:auto}.container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{flex:0 0 350px;padding:10px}.container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   audio[_ngcontent-%COMP%]{outline:none}.container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .attach-block[_ngcontent-%COMP%]{display:block;margin-bottom:15px;padding:10px;display:flex;flex-direction:column;justify-content:center;align-items:center}.container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .attach-block[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;display:block;margin-bottom:15px}.container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .attach-block[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;text-align:center}.full-height[_ngcontent-%COMP%], [_nghost-%COMP%]     .full-height>.ant-spin-container{height:100%}[_nghost-%COMP%]     .edit-content .ck-editor__top{display:none}[_nghost-%COMP%]     .edit-content .ck-content{border-color:transparent!important}"]}),t})();var Le=n("jhN1");function Re(t,e){if(1&t&&(c.Yb(0),c.Vb(1,"iframe",6),c.Xb()),2&t){const t=c.lc();c.Eb(1),c.tc("src",null==t.data?null:t.data.resourceUrl,c.Gc)}}let De=(()=>{class t{constructor(t,e,n,i){this.materialLibService=t,this.route=e,this.sanitizer=n,this.menuService=i,this.data={},this.id="",this.type="",this.professionId="",this.isShow=!1}ngOnInit(){this.id=this.route.snapshot.paramMap.get("id"),this.type=this.route.snapshot.paramMap.get("type"),this.professionId=this.route.snapshot.paramMap.get("professionId"),this.materialLibService.getResourceDetail(this.id,this.type).subscribe(t=>{200===t.status&&(t.data.resourceUrl=this.sanitizer.bypassSecurityTrustResourceUrl(p.a.ow365+p.a.OSS_URL+t.data.resourceUrl),this.data=t.data,setTimeout(()=>{this.isShow=!0},200))},t=>{})}backtolist(){this.menuService.goBack()}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(f.a),c.Ub(o.a),c.Ub(Le.b),c.Ub(b.a))},t.\u0275cmp=c.Ob({type:t,selectors:[["app-material-preview-other"]],decls:8,vars:2,consts:[["id","fullContainer",1,"container"],[1,"header"],[2,"font-size","18px"],["nz-button","",2,"float","right",3,"click"],[1,"body"],[4,"ngIf"],["allowfullscreen","true",2,"width","100%","height","100%","border","none","min-height","680px",3,"src"]],template:function(t,e){1&t&&(c.ac(0,"div",0),c.ac(1,"div",1),c.ac(2,"div",2),c.Pc(3),c.Zb(),c.ac(4,"button",3),c.ic("click",(function(){return e.backtolist()})),c.Pc(5,"\u8fd4\u56de"),c.Zb(),c.Zb(),c.ac(6,"div",4),c.Nc(7,Re,2,1,"ng-container",5),c.Zb(),c.Zb()),2&t&&(c.Eb(3),c.Qc(null==e.data?null:e.data.title),c.Eb(4),c.tc("ngIf",e.isShow))},directives:[I.a,T.a,M.a,v.n],styles:[".container[_ngcontent-%COMP%]{background-color:#fff;padding:10px;height:100%;width:100%;overflow:scroll}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;height:40px;line-height:40px}.container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center;height:calc(100% - 40px)}"]}),t})();var Ne=n("Lfe1"),je=n("2+G5");const Fe=["treeContainer"];function Ae(t,e){if(1&t){const t=c.bc();c.ac(0,"qkc-change-profession",40),c.ic("professionChange",(function(e){return c.Ec(t),c.lc().professionChange(e)})),c.Zb()}if(2&t){const t=c.lc();c.tc("select",t.selected)("hidden","scp"===t.from)}}function Ue(t,e){if(1&t){const t=c.bc();c.ac(0,"button",28),c.ic("click",(function(){return c.Ec(t),c.lc().goback()})),c.Pc(1,"\u5b8c\u6210\u8c03\u7528"),c.Zb()}}function Ve(t,e){if(1&t){const t=c.bc();c.ac(0,"button",28),c.ic("click",(function(){return c.Ec(t),c.lc().goAddPage()})),c.Pc(1,"\u65b0\u589e\u5b9e\u8bad"),c.Zb()}}function qe(t,e){if(1&t){const t=c.bc();c.ac(0,"qkc-tree-knowledgegraph",41,42),c.ic("nodeChange",(function(e){return c.Ec(t),c.lc().nodeChange(e)})),c.Zb()}if(2&t){const t=c.lc();c.tc("fullNode",!0)("allNodes",!0)("practice",!0)("selectedProfesson",t.selectedProfesson)("professionId",null==t.selectedProfesson?null:t.selectedProfesson.id)}}function Be(t,e){if(1&t){const t=c.bc();c.ac(0,"a",45),c.ic("click",(function(){c.Ec(t);const e=c.lc().$implicit;return c.lc().edit(e)})),c.Pc(1,"\u7f16\u8f91 "),c.Zb()}}function Ge(t,e){if(1&t){const t=c.bc();c.ac(0,"a",49),c.ic("click",(function(){c.Ec(t);const e=c.lc().$implicit;return c.lc().del(e)})),c.Pc(1,"\u5220\u9664"),c.Zb()}}function Xe(t,e){if(1&t){const t=c.bc();c.ac(0,"a",45),c.ic("click",(function(){c.Ec(t);const e=c.lc(),n=e.$implicit,i=e.index;return c.lc().callResource(n,i)})),c.Pc(1,"\u8c03\u7528"),c.Zb()}}function $e(t,e){if(1&t){const t=c.bc();c.ac(0,"a",49),c.ic("click",(function(){c.Ec(t);const e=c.lc(),n=e.$implicit,i=e.index;return c.lc().cancelCallResource(n,i)})),c.Pc(1," \u53d6\u6d88\u8c03\u7528 "),c.Zb()}}function We(t,e){1&t&&(c.ac(0,"a",50),c.Pc(1,"\u5df2\u8c03\u7528"),c.Zb())}function He(t,e){if(1&t){const t=c.bc();c.ac(0,"tr"),c.ac(1,"td"),c.ac(2,"span",43),c.Pc(3),c.Zb(),c.Zb(),c.ac(4,"td"),c.Pc(5),c.Zb(),c.ac(6,"td"),c.Pc(7,"\u6052\u4f01\u5b9e\u4e60\u7cfb\u7edf"),c.Zb(),c.ac(8,"td"),c.Pc(9),c.Zb(),c.ac(10,"td",44),c.ac(11,"a",45),c.ic("click",(function(){c.Ec(t);const n=e.$implicit;return c.lc().preview(n)})),c.Pc(12,"\u67e5\u770b\u8be6\u60c5 "),c.Zb(),c.Nc(13,Be,2,0,"a",46),c.Nc(14,Ge,2,0,"a",47),c.Nc(15,Xe,2,0,"a",46),c.Nc(16,$e,2,0,"a",47),c.Nc(17,We,2,0,"a",48),c.Zb(),c.Zb()}if(2&t){const t=e.$implicit,n=c.lc();c.Eb(3),c.Qc(null==t?null:t.title),c.Eb(2),c.Qc(n.learningCode[null==t?null:t.learningGoalCode]),c.Eb(4),c.Qc(null==t?null:t.accountId),c.Eb(4),c.tc("ngIf",!n.from),c.Eb(1),c.tc("ngIf",!n.from),c.Eb(1),c.tc("ngIf","scp"==n.from&&!t.isCall&&n.permitedCall),c.Eb(1),c.tc("ngIf","scp"==n.from&&t.isCall&&!n.callResourceData.isStandard),c.Eb(1),c.tc("ngIf",t.isCall&&n.callResourceData.isStandard)}}function Ke(t,e){1&t&&c.Pc(0),2&t&&c.Rc("\u5171 ",e.$implicit," \u6761\u8bb0\u5f55")}const Qe=function(){return[15,20,30,40,50]},Je=function(t){return{x:"905px",y:t}};let Ye=(()=>{class t extends h.l{constructor(t,e,n,i,o,a,c,r){super(),this.trainManageService=t,this.materialLibService=e,this.menuService=n,this.modalService=i,this.message=o,this.route=a,this.courseMgService=c,this.statisticsLogService=r,this._PAGE_ID_="TrainLibraryCourseComponent",this.id=-1,this.selectedProfesson={},this.knowledgePointId="",this.conditionObj={industryId:"",keyword:"",learningGoalCodes:[],knowledgeSubjectId:""},this.selected="",this.from="",this.callResourceData={},this.callResourceId="MaterialCallResource",this.learningCode={},this.changeProfession=!0,this.knowledgegraphTree=!0,this.permitedCall=!0,this.init=!1,this.loading=!1}initData(){this.selected=s.a.getTrainTree()||s.a.getPacketInfoItem("code");const{from:t,task:e}=this.route.snapshot.queryParams;this.task=e,"scp"===t&&(this.from=t,this.callResourceData=s.a.getScpResourceMaterial()),r.f.map(t=>{this.learningCode[t.id]=t.name})}ngOnAttach(){this.selected=s.a.getTrainTree()||s.a.getPacketInfoItem("code"),this.collectParam(),this.sybcParam(),this.init=!1,this.changeProfession=!1,Object(d.a)(0).subscribe(()=>{this.changeProfession=!0})}collectParam(){const{keyword:t,learningGoalCodes:e}=s.a.getSearch(this._PAGE_ID_);this.keyword=t||"",this.learningGoalCodes=e||[]}sybcParam(){this.conditionObj.keyword=this.keyword,this.conditionObj.learningGoalCodes=this.learningGoalCodes}storingData(){const{keyword:t,learningGoalCodes:e}=this;this.passData({keyword:t,learningGoalCodes:e})}resetInit(){this.keyword="",this.learningGoalCodes=[],this.conditionObj.learningGoalCodes=[],this.conditionObj.keyword=""}getDataList(){this.conditionObj.keyword=this.conditionObj.keyword.trim();const t=Object.assign(Object.assign({},this.conditionObj),{page:this.pageIndex,limit:this.pageSize}),e=t=>{200===t.status?(this.data=t.data,this.total=t.page.totalResult,"scp"===this.from&&this.callResourceData.nodes&&this.callResourceData.nodes.length>0&&(this.data=this.data.map(t=>{const e=this.callResourceData.nodes.find(e=>e.id===t.id);return e&&(t.isCall=!0,t.taskId=e.taskId),t}),this.setPermitedCall())):(this.data=[],this.total=0,this.message.create("error",JSON.stringify(t)))},n=t=>{this.isLoading=!1,this.message.create("error",JSON.stringify(t))};this.isLoading=!0;const i=[this.trainManageService.queryPracticalPage(t)];Object(l.a)(i).subscribe(t=>{this.isLoading=!1,e(t[0])},t=>{this.isLoading=!1,n(t)})}onResize({width:t}){const e=this.treeContainer&&this.treeContainer.nativeElement&&this.treeContainer.nativeElement.offsetWidth;e&&this.treeContainer.nativeElement.offsetWidth+80<t||e&&this.treeContainer.nativeElement.offsetWidth+10>t||(cancelAnimationFrame(this.id),this.id=requestAnimationFrame(()=>{this.width=t}))}setPermitedCall(){this.callResourceData.hasOwnProperty("limit")&&(this.permitedCall=0===Number(this.callResourceData.limit)||!(this.callResourceData.nodes.length>=this.callResourceData.limit||-1===Number(this.callResourceData.limit)))}professionChange(t){s.a.putTrainTree(t.code),this.selectedProfesson=t,this.conditionObj.knowledgeSubjectId=t.id,this.conditionObj.industryId="",this.init?(this.pageIndex=1,this.searchData()):(this.init=!0,this.searchData("collect"))}nodeChange(t){t.parentNode?(this.conditionObj.industryId=t.key,this.conditionObj.knowledgeSubjectId=""):(this.conditionObj.knowledgeSubjectId=t.key,this.conditionObj.industryId=""),this.pageIndex=1,this.searchData()}edit(t){this.menuService.gotoUrl({url:"/m/rm/save-train",title:"\u7f16\u8f91\u5b9e\u8bad",paramUrl:`/edit/${t.id}/${this.selectedProfesson.id}?select=0`})}goAddPage(){this.menuService.gotoUrl({url:"/m/rm/save-train",title:"\u65b0\u589e\u5b9e\u8bad",paramUrl:"/add/0/"+this.selectedProfesson.id+"?select="+this.conditionObj.industryId+"&t="+(new Date).getTime()})}preview(t){if(t.url)return this.goPage(t.url);const e={id:t.id,accountId:t.accountId};this.loading=!0,this.trainManageService.getPracticalDetail(e).subscribe(e=>{this.loading=!1,200===e.status&&e.data&&(t.url=e.data,this.goPage(e.data))},t=>{this.loading=!1,this.message.create("error",JSON.stringify(t))})}goPage(t){open(t)}goback(){this.menuService.goBack(),Object(d.a)(0).subscribe(()=>{this.menuService.gotoUrl({title:"\u8bfe\u5305\u5efa\u8bbe",url:"/m/course-manage/prepare-course",paramUrl:""})})}del(t){this.curSelectedItem=t,this.materialLibService.preDelCheck(this.curSelectedItem.id).subscribe(t=>{if(200===t.status){let e;e="1"===t.data?"\u8be5\u8d26\u671f\u6b63\u5728\u88ab\u4f7f\u7528\uff0c\u5220\u9664\u540e\u8bfe\u5305\u4e2d\u7684\u5b9e\u8bad\u4efb\u52a1\u5c06\u540c\u6b65\u5220\u9664\uff0c\u786e\u5b9a\u5220\u9664\u5417\uff1f":"\u786e\u5b9a\u5220\u9664\u8be5\u8d26\u671f\u5417\uff1f",this.modalService.error({nzTitle:"\u5220\u9664",nzContent:e,nzCancelText:"\u53d6\u6d88",nzOnOk:()=>new Promise(t=>{this.materialLibService.delResource(this.curSelectedItem.id).subscribe(e=>{200===e.status?(t(!0),this.searchData()):(500===e.status&&this.message.error("\u670d\u52a1\u7aef\u4e1a\u52a1\u5f02\u5e38"),t(!1))},e=>{t(!1),this.message.error(JSON.stringify(e))})})})}else 500===t.status&&this.message.warning("\u68c0\u67e5\u8d26\u671f\u4efb\u52a1\u8c03\u7528\u60c5\u51b5\u670d\u52a1\u7aef\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")})}callResource(t,e){const n=t=>{this.isLoading=!1,this.message.warning(JSON.stringify(t))},i=Object.assign(Object.assign({},this.callResourceData.sectionInfo),{resourceId:t.id,sourceType:1}),o=t=>{if(this.isLoading=!1,201===t.status){const{task:n}=this;let o="";o="1"===n?"learnSet-task-action":"101"===n?"learnSet-lecture-action":"104"===n?"learnSet-material-action":"learnSet-record-action",this.statisticsLogService.statisticsPacketInfoLog({name:"\u5b9e\u8bad\u5e93\u8c03\u7528",actionCode:r.j.packetInfo[o].addCode,content:JSON.stringify(i)}),this.data[e].isCall=!0,this.data[e].taskId=t.data.id,this.callResourceData.nodes.push({id:this.data[e].id,taskId:t.data.id}),this.callResourceData.seq+=1,s.a.putScpResourceMaterial(this.callResourceData),this.setPermitedCall()}else this.message.error(500===t.status?"\u670d\u52a1\u5668\u4e1a\u52a1\u5f02\u5e38\u5bfc\u81f4\u8c03\u7528\u5931\u8d25\uff0c\u53ef\u80fd\u6807\u9898\u592a\u957f\uff0c\u8bf7\u4fdd\u630135\u5b57\u7b26\u4ee5\u5185":t.message)};this.isLoading=!0,"1"===this.task?(i.name=t.title,i.taskType="3",i.seq=s.a.getScpResourceMaterial().seq,this.courseMgService.quickCreate_courseSectionResourceTask(i).subscribe(o,n)):(i.title=t.title,i.category=t.category,i.type=this.task,i.seq=s.a.getScpResourceMaterial().seq,this.courseMgService.quickCreate_courseSectionResource(i).subscribe(o,n))}cancelCallResource(t,e){const n=t=>{this.message.warning(JSON.stringify(t))},i=n=>{if(204===n.status){const{task:n}=this;let i="";i="1"===n?"learnSet-task-action":"101"===n?"learnSet-lecture-action":"104"===n?"learnSet-material-action":"learnSet-record-action",this.statisticsLogService.statisticsPacketInfoLog({name:"\u5b9e\u8bad\u5e93\u53d6\u6d88\u8c03\u7528",actionCode:r.j.packetInfo[i].addCode,content:t.taskId}),this.data[e].isCall=!1,this.callResourceData.nodes=this.callResourceData.nodes.filter(t=>t.id!==this.data[e].id),this.callResourceData.seq-=1,s.a.putScpResourceMaterial(this.callResourceData),this.setPermitedCall()}else this.message.warning(n.message||"\u672a\u77e5\u9519\u8bef")};"1"===this.task?this.courseMgService.delInvoke_courseTask(t.taskId).subscribe(i,n):this.courseMgService.delInvoke_course(t.taskId).subscribe(i,n)}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(je.a),c.Ub(f.a),c.Ub(b.a),c.Ub(m.e),c.Ub(z.e),c.Ub(o.a),c.Ub(P.a),c.Ub(C.a))},t.\u0275cmp=c.Ob({type:t,selectors:[["app-train-course-library"]],viewQuery:function(t,e){var n;1&t&&c.Vc(Fe,!0),2&t&&c.Bc(n=c.jc())&&(e.treeContainer=n.first)},features:[c.Bb],decls:57,vars:31,consts:[[1,"container"],[1,"header"],[1,"title"],[2,"max-width","400px"],[3,"select","hidden","professionChange",4,"ngIf"],["nz-button","","nzType","primary","class","margin-btn",3,"click",4,"ngIf"],["nz-row","",1,"resource-container"],["nz-resizable","",1,"left-tree",3,"nzResize"],[2,"display","inline-block","overflow","hidden","margin-right","30px"],["treeContainer",""],["model","custom",3,"fullNode","allNodes","practice","selectedProfesson","professionId","nodeChange",4,"ngIf"],["nzDirection","right"],[1,"right-wrap"],["nz-icon","","nzType","more","nzTheme","outline",1,"right"],[1,"right-resource"],[1,"search-container"],[1,"list"],[1,"list-title"],[1,"list-input"],["nz-input","","placeholder","\u652f\u6301\u5b9e\u8bad\u6807\u9898/\u8d26\u671fID",3,"ngModel","ngModelChange","keyup.enter"],[1,"list-title",2,"margin-left","20px"],["nzMode","multiple","nzAllowClear","","nzShowSearch","",2,"min-width","150px",3,"ngModel","ngModelChange"],["nzLabel","\u4e86\u89e3",3,"nzValue"],["nzLabel","\u7406\u89e3",3,"nzValue"],["nzLabel","\u638c\u63e1",3,"nzValue"],["nzLabel","\u5e94\u7528",3,"nzValue"],["nzLabel","\u5206\u6790",3,"nzValue"],["nzLabel","\u521b\u65b0",3,"nzValue"],["nz-button","","nzType","primary",1,"margin-btn",3,"click"],["nz-button","","nzType","primary",2,"margin-left","20px",3,"click"],["id","tableScroll",1,"table-container"],[3,"nzData","nzFrontPagination","nzShowSizeChanger","nzPageSizeOptions","nzShowTotal","nzLoading","nzTotal","nzPageIndex","nzPageSize","nzScroll","nzPageIndexChange","nzPageSizeChange"],["ajaxTable",""],[1,"source-header"],["nzWidth","220px"],["nzWidth","120px"],["nzWidth","200px"],["nzWidth","140px","nzRight",""],[4,"ngFor","ngForOf"],["totalTemplate",""],[3,"select","hidden","professionChange"],["model","custom",3,"fullNode","allNodes","practice","selectedProfesson","professionId","nodeChange"],["tree",""],[1,"synopsis-text"],["nzRight",""],[3,"click"],[3,"click",4,"ngIf"],["class","light-color",3,"click",4,"ngIf"],["style","color: #999;",4,"ngIf"],[1,"light-color",3,"click"],[2,"color","#999"]],template:function(t,e){if(1&t&&(c.ac(0,"div",0),c.ac(1,"section",1),c.ac(2,"div",2),c.ac(3,"span",3),c.Pc(4),c.Zb(),c.Nc(5,Ae,1,2,"qkc-change-profession",4),c.Zb(),c.ac(6,"div"),c.Nc(7,Ue,2,0,"button",5),c.Nc(8,Ve,2,0,"button",5),c.Zb(),c.Zb(),c.ac(9,"section",6),c.ac(10,"section",7),c.ic("nzResize",(function(t){return e.onResize(t)})),c.ac(11,"div",8,9),c.Nc(13,qe,2,5,"qkc-tree-knowledgegraph",10),c.Zb(),c.ac(14,"nz-resize-handle",11),c.ac(15,"div",12),c.Vb(16,"i",13),c.Zb(),c.Zb(),c.Zb(),c.ac(17,"section",14),c.ac(18,"section",15),c.ac(19,"div",16),c.ac(20,"div",17),c.Pc(21,"\u5173\u952e\u8bcd\u641c\u7d22\uff1a"),c.Zb(),c.ac(22,"div",18),c.ac(23,"input",19),c.ic("ngModelChange",(function(t){return e.keyword=t}))("keyup.enter",(function(){return e.searchData("button")}))("ngModelChange",(function(){return e.storingData()})),c.Zb(),c.Zb(),c.ac(24,"div",20),c.Pc(25,"\u5b66\u4e60\u76ee\u6807\uff1a"),c.Zb(),c.ac(26,"div",18),c.ac(27,"nz-select",21),c.ic("ngModelChange",(function(t){return e.learningGoalCodes=t}))("ngModelChange",(function(){return e.storingData()})),c.Vb(28,"nz-option",22),c.Vb(29,"nz-option",23),c.Vb(30,"nz-option",24),c.Vb(31,"nz-option",25),c.Vb(32,"nz-option",26),c.Vb(33,"nz-option",27),c.Zb(),c.Zb(),c.ac(34,"button",28),c.ic("click",(function(){return e.searchData("button")})),c.Pc(35,"\u67e5\u8be2 "),c.Zb(),c.ac(36,"button",29),c.ic("click",(function(){return e.resetData()})),c.Pc(37,"\u91cd\u7f6e"),c.Zb(),c.Zb(),c.Zb(),c.ac(38,"section",30),c.ac(39,"nz-table",31,32),c.ic("nzPageIndexChange",(function(t){return e.pageIndex=t}))("nzPageSizeChange",(function(t){return e.pageSize=t}))("nzPageIndexChange",(function(){return e.searchData()}))("nzPageSizeChange",(function(){return e.searchData()})),c.ac(41,"thead",33),c.ac(42,"tr"),c.ac(43,"th",34),c.Pc(44,"\u5b9e\u8bad\u6807\u9898"),c.Zb(),c.ac(45,"th",35),c.Pc(46,"\u5b66\u4e60\u76ee\u6807"),c.Zb(),c.ac(47,"th",36),c.Pc(48,"\u5b9e\u4e60\u7cfb\u7edf"),c.Zb(),c.ac(49,"th",36),c.Pc(50,"\u8d26\u671fID"),c.Zb(),c.ac(51,"th",37),c.Pc(52,"\u64cd\u4f5c"),c.Zb(),c.Zb(),c.Zb(),c.ac(53,"tbody"),c.Nc(54,He,18,8,"tr",38),c.Zb(),c.Zb(),c.Zb(),c.Nc(55,Ke,1,1,"ng-template",null,39,c.Oc),c.Zb(),c.Zb(),c.Zb()),2&t){const t=c.Cc(40),n=c.Cc(56);c.Eb(4),c.Qc(null==e.selectedProfesson?null:e.selectedProfesson.name),c.Eb(1),c.tc("ngIf",e.changeProfession),c.Eb(2),c.tc("ngIf","scp"===e.from),c.Eb(1),c.tc("ngIf",""===e.from),c.Eb(2),c.Mc("width",e.width,"px"),c.Eb(3),c.tc("ngIf",e.knowledgegraphTree),c.Eb(10),c.tc("ngModel",e.keyword),c.Eb(4),c.tc("ngModel",e.learningGoalCodes),c.Eb(1),c.tc("nzValue",1),c.Eb(1),c.tc("nzValue",2),c.Eb(1),c.tc("nzValue",3),c.Eb(1),c.tc("nzValue",4),c.Eb(1),c.tc("nzValue",5),c.Eb(1),c.tc("nzValue",6),c.Eb(5),c.Kb("no-scoll",!e.data.length),c.Eb(1),c.tc("nzData",e.data)("nzFrontPagination",!1)("nzShowSizeChanger",!0)("nzPageSizeOptions",c.wc(28,Qe))("nzShowTotal",n)("nzLoading",e.isLoading)("nzTotal",e.total)("nzPageIndex",e.pageIndex)("nzPageSize",e.pageSize)("nzScroll",c.xc(29,Je,e.height+"px")),c.Eb(15),c.tc("ngForOf",t.data)}},directives:[v.n,O.c,k.a,k.c,M.a,_.a,x.b,S.c,S.o,S.q,E.d,E.a,I.a,T.a,Z.c,Z.j,Z.k,Z.b,Z.h,Z.a,Z.e,v.m,L.a,R.a],styles:[".margin-btn[_ngcontent-%COMP%]{margin-left:15px}.light-color[_ngcontent-%COMP%]{color:red}.gray-color[_ngcontent-%COMP%]{color:#999}.container[_ngcontent-%COMP%]{background-color:#fff;padding:10px;height:100%}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:10px;padding-left:5px}.container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:500}.resource-container[_ngcontent-%COMP%]{height:calc(100% - 42px);overflow:hidden;display:flex}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]{height:100%;overflow-x:hidden;overflow-y:auto;min-width:200px}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]   .right-wrap[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;justify-content:center}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{background:#fff;border:1px solid #ddd;text-align:center;font-size:12px;height:20px;line-height:20px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]{padding-left:30px;flex:1;height:100%;overflow:hidden;border-left:1px solid #ddd}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]{margin-bottom:10px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]{display:flex;min-height:50px;align-items:center;border-bottom:1px solid #eee}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   .list-title[_ngcontent-%COMP%]{min-width:85px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-block;padding:5px 15px;margin-right:12px;cursor:pointer}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{background-color:#1890ff;border-radius:5px;color:#fff}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   .list-content[_ngcontent-%COMP%]{flex-grow:2}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{height:calc(100% - 260px);overflow:auto}.source-header[_ngcontent-%COMP%]{font-weight:bolder}tr.light-tr[_ngcontent-%COMP%]{background:#e6f7ff}[_nghost-%COMP%]     .ant-table-tbody>tr>td, [_nghost-%COMP%]     .ant-table-thead>tr>th, [_nghost-%COMP%]     .ant-table tfoot>tr>td, [_nghost-%COMP%]     .ant-table tfoot>tr>th{padding:10px 5px}.ant-table-tbody[_ngcontent-%COMP%] > tr.ant-table-row[_ngcontent-%COMP%]:hover > td[_ngcontent-%COMP%]{background:#dde0df}[_nghost-%COMP%]     .ant-table-pagination.ant-pagination{position:fixed;bottom:20px;right:20px;background:#fff}[_nghost-%COMP%]     .ant-spin-container{position:static}[_nghost-%COMP%]     .ant-tree{position:static!important}nz-content[_ngcontent-%COMP%]{flex:1!important}.synopsis-text[_ngcontent-%COMP%]{width:100%;display:-webkit-box!important;word-break:break-all;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}  .no-scoll .ant-table-body{overflow:hidden!important}[_nghost-%COMP%]     .table-container{height:calc(100% - 120px)!important;overflow:hidden}.list-title[_ngcontent-%COMP%]{max-width:100px!important}[_nghost-%COMP%]     .ant-tree-title{max-width:200px;display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}"]}),t})();var tn=n("55n1");const en=["treeContainer"];function nn(t,e){if(1&t){const t=c.bc();c.ac(0,"button",1),c.ic("click",(function(){return c.Ec(t),c.lc().onContine()})),c.Pc(1,"\u4fdd\u5b58\u5e76\u7ee7\u7eed\u6dfb\u52a0 "),c.Zb()}if(2&t){const t=c.lc();c.tc("nzType","primary")("nzLoading",t.isLoading)}}function on(t,e){if(1&t&&c.Vb(0,"nz-option",29),2&t){const t=e.$implicit;c.tc("nzLabel",t.name)("nzValue",t.id)}}const an=function(){return{border:"none","padding-left":"10px"}},cn=function(){return{}};let rn=(()=>{class t{constructor(t,e,n,i,o){this.message=t,this.trainManageService=e,this.routerinfo=n,this.menuService=i,this.fb=o,this.id=-1,this.type="add",this.resourceId="",this.curProfessor={},this.curProfessorId="",this.defaultTreeKey=[],this.checkTreeNode=[],this.data={},this.isLoading=!1,this.userInfo=tn.a.getUser(),this.learningTarget=r.f}get titleContent(){return this.modalForms.get("title").value.length}ngOnInit(){this.initParam(),this.initForm(),"add"!==this.type&&this.getData(this.resourceId),this.echoTreeData()}echoTreeData(){const{select:t}=this.routerinfo.snapshot.queryParams;t&&(this.defaultTreeKey=[t],this.checkTreeNode=[t])}initParam(){this.routerinfo.params.subscribe(t=>{const{id:e,type:n,professionId:i}=t;this.type=n,this.resourceId=e,this.curProfessorId=i,this.curProfessor={id:i}})}initForm(){this.modalForms=this.fb.group({authorName:[this.userInfo.nickName,[S.w.required]],authorUnit:["1",[S.w.required]],title:["",[S.w.required,S.w.maxLength(30),Object(kt.b)()]],learningGoalCode:["",[S.w.required]],accountId:["",[S.w.required]]})}onResize({width:t}){const e=this.treeContainer&&this.treeContainer.nativeElement&&this.treeContainer.nativeElement.offsetWidth;e&&this.treeContainer.nativeElement.offsetWidth+80<t||e&&this.treeContainer.nativeElement.offsetWidth+10>t||(cancelAnimationFrame(this.id),this.id=requestAnimationFrame(()=>{this.width=t}))}nodeChange(t){this.checkTreeNode=[t.id]}getData(t){this.isLoading=!0,this.trainManageService.getPracticalById({id:t}).subscribe(t=>{this.data=t.data||{},this.defaultTreeKey=[this.data.industryId],this.checkTreeNode=[this.data.industryId],this.modalForms.patchValue({authorName:this.data.authorName,authorUnit:this.data.authorUnit,title:this.data.title,learningGoalCode:this.data.learningGoalCode,accountId:this.data.accountId}),this.isLoading=!1},t=>{this.isLoading=!1,this.message.create("error",JSON.stringify(t))})}goBack(){this.menuService.goBack(!1),this.menuService.gotoUrl({url:"/m/rm/setting",paramUrl:"",title:"\u5b9e\u8bad\u8bbe\u7f6e"})}onContine(t){for(const e in this.modalForms.controls)this.modalForms.controls[e].markAsDirty(),this.modalForms.controls[e].updateValueAndValidity();if(this.modalForms.valid){if(this.curProfessor.id===this.checkTreeNode[0])return void this.message.warning("\u8bf7\u9009\u62e9\u884c\u4e1a\u65b0\u589e\u5b9e\u8bad\uff0c\u76ee\u524d\u60a8\u9009\u62e9\u4e86\u8bfe\u7a0b");if(!this.checkTreeNode[0])return this.message.warning("\u8bf7\u9009\u62e9\u884c\u4e1a\u518d\u8fdb\u884c\u5b9e\u8bad\u8bbe\u7f6e");const e=Object.assign(Object.assign({},this.modalForms.value),{industryId:this.checkTreeNode[0],companyId:"0"});this.resourceId&&"edit"===this.type&&(e.id=this.resourceId);const n=e=>{if(this.isLoading=!1,201===e.status)if(t)this.goBack();else{this.modalForms.patchValue({title:"",learningGoalCode:"",accountId:""});for(const t in this.modalForms.controls)this.modalForms.controls[t].markAsPristine(),this.modalForms.controls[t].markAsUntouched(),this.modalForms.controls[t].updateValueAndValidity()}},i=()=>{this.isLoading=!1};this.isLoading=!0,this.trainManageService.savePractical(e).subscribe(n,i)}}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(z.e),c.Ub(je.a),c.Ub(o.a),c.Ub(b.a),c.Ub(S.d))},t.\u0275cmp=c.Ob({type:t,selectors:[["app-save-train-course"]],viewQuery:function(t,e){var n;1&t&&c.Vc(en,!0),2&t&&c.Bc(n=c.jc())&&(e.treeContainer=n.first)},decls:45,vars:27,consts:[[1,"header-container"],["nz-button","",2,"float","right","margin","14px 10px 0 0",3,"nzType","nzLoading","click"],["nz-button","","style","float: right;margin:14px 10px 0 0;",3,"nzType","nzLoading","click",4,"ngIf"],["nz-button","",1,"margin-btn",2,"float","right","margin","14px 10px 0 0",3,"click"],[1,"resource-container"],["nz-resizable","",1,"left-tree",3,"hidden","nzResize"],[2,"display","inline-block","overflow","hidden","margin-right","30px"],["treeContainer",""],["model","custom",3,"practice","professionId","defaultCheckedKeys","allNodes","nodeChange"],["tree",""],["nzDirection","right"],[1,"right-wrap"],["nz-icon","","nzType","more","nzTheme","outline",1,"right"],[1,"right-resource",3,"ngStyle"],[3,"nzSpinning","nzDelay"],[1,"title"],["nz-form","",1,"search-container",3,"formGroup"],["nzRequired","",3,"nzSpan"],["nzHasFeedback","","nzErrorTip","\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u5e76\u4e14\u4e0d\u80fd\u8d85\u8fc730\u4e2a\u5b57\u7b26",3,"nzSpan"],["nz-input","","type","text","formControlName","title","placeholder","\u8bf7\u8f93\u5165\u6807\u9898......",3,"keyup.enter"],[2,"line-height","40px","margin-left","10px"],["nzHasFeedback","","nzErrorTip","\u5b66\u4e60\u76ee\u6807\u4e0d\u80fd\u4e3a\u7a7a",3,"nzSpan"],["nzPlaceHolder","\u8bf7\u9009\u62e9","formControlName","learningGoalCode",2,"width","100%"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzHasFeedback","","nzErrorTip","\u5b9e\u4e60\u7cfb\u7edf\u4e0d\u80fd\u4e3a\u7a7a",3,"nzSpan"],["nzPlaceHolder","\u8bf7\u9009\u62e9\u5b9e\u4e60\u7cfb\u7edf","formControlName","authorUnit",2,"width","100%"],["nzLabel","\u6052\u4f01\u5b9e\u4e60\u7cfb\u7edf","nzValue","1"],["nzHasFeedback","","nzErrorTip","\u8d26\u671fID\u4e0d\u80fd\u4e3a\u7a7a",3,"nzSpan"],["nz-input","","type","text","formControlName","accountId","placeholder","\u8bf7\u8f93\u5165\u8d26\u671fID",3,"keyup.enter"],[3,"nzLabel","nzValue"]],template:function(t,e){1&t&&(c.ac(0,"div",0),c.Pc(1," \u5b9e\u8bad\u8bbe\u7f6e "),c.ac(2,"button",1),c.ic("click",(function(){return e.onContine(!0)})),c.Pc(3,"\u4fdd\u5b58 "),c.Zb(),c.Nc(4,nn,2,2,"button",2),c.ac(5,"button",3),c.ic("click",(function(){return e.goBack()})),c.Pc(6,"\u8fd4\u56de"),c.Zb(),c.Zb(),c.ac(7,"section",4),c.ac(8,"section",5),c.ic("nzResize",(function(t){return e.onResize(t)})),c.ac(9,"div",6,7),c.ac(11,"qkc-tree-knowledgegraph",8,9),c.ic("nodeChange",(function(t){return e.nodeChange(t)})),c.Zb(),c.Zb(),c.ac(13,"nz-resize-handle",10),c.ac(14,"div",11),c.Vb(15,"i",12),c.Zb(),c.Zb(),c.Zb(),c.ac(16,"section",13),c.ac(17,"nz-spin",14),c.ac(18,"div",15),c.Pc(19),c.Zb(),c.ac(20,"form",16),c.ac(21,"nz-form-item"),c.ac(22,"nz-form-label",17),c.Pc(23,"\u5b9e\u8bad\u6807\u9898"),c.Zb(),c.ac(24,"nz-form-control",18),c.ac(25,"input",19),c.ic("keyup.enter",(function(){return e.onContine()})),c.Zb(),c.Zb(),c.ac(26,"span",20),c.Pc(27),c.Zb(),c.Zb(),c.ac(28,"nz-form-item"),c.ac(29,"nz-form-label",17),c.Pc(30,"\u5b66\u4e60\u76ee\u6807"),c.Zb(),c.ac(31,"nz-form-control",21),c.ac(32,"nz-select",22),c.Nc(33,on,1,2,"nz-option",23),c.Zb(),c.Zb(),c.Zb(),c.ac(34,"nz-form-item"),c.ac(35,"nz-form-label",17),c.Pc(36,"\u5b9e\u4e60\u7cfb\u7edf"),c.Zb(),c.ac(37,"nz-form-control",24),c.ac(38,"nz-select",25),c.Vb(39,"nz-option",26),c.Zb(),c.Zb(),c.Zb(),c.ac(40,"nz-form-item"),c.ac(41,"nz-form-label",17),c.Pc(42,"\u8d26\u671fID"),c.Zb(),c.ac(43,"nz-form-control",27),c.ac(44,"input",28),c.ic("keyup.enter",(function(){return e.onContine()})),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb(),c.Zb()),2&t&&(c.Eb(2),c.tc("nzType","primary")("nzLoading",e.isLoading),c.Eb(2),c.tc("ngIf","add"===e.type),c.Eb(4),c.Mc("width",e.width,"px"),c.tc("hidden","edit"===e.type),c.Eb(3),c.tc("practice",!0)("professionId",null==e.curProfessor?null:e.curProfessor.id)("defaultCheckedKeys",e.defaultTreeKey)("allNodes",!0),c.Eb(5),c.tc("ngStyle","edit"===e.type?c.wc(25,an):c.wc(26,cn)),c.Eb(1),c.tc("nzSpinning",e.isLoading)("nzDelay",0),c.Eb(2),c.Rc("","add"===e.type?"\u65b0\u589e":"\u7f16\u8f91","\u5b9e\u8bad"),c.Eb(1),c.tc("formGroup",e.modalForms),c.Eb(2),c.tc("nzSpan",3),c.Eb(2),c.tc("nzSpan",15),c.Eb(3),c.Rc("",e.titleContent||0,"/30"),c.Eb(2),c.tc("nzSpan",3),c.Eb(2),c.tc("nzSpan",15),c.Eb(2),c.tc("ngForOf",e.learningTarget),c.Eb(2),c.tc("nzSpan",3),c.Eb(2),c.tc("nzSpan",15),c.Eb(4),c.tc("nzSpan",3),c.Eb(2),c.tc("nzSpan",15))},directives:[I.a,T.a,M.a,v.n,k.a,R.a,k.c,_.a,v.o,Zt.a,S.y,S.p,Tt.b,S.i,O.c,Tt.c,O.a,Tt.d,Tt.a,x.b,S.c,S.o,S.g,E.d,v.m,E.a],styles:[".resource-container[_ngcontent-%COMP%]{overflow:hidden;display:flex;padding:10px;height:calc(100% - 60px)}.resource-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:17px;margin-bottom:15px}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;min-width:200px}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]   .right-wrap[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;justify-content:center}.resource-container[_ngcontent-%COMP%]   .left-tree[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{background:#fff;border:1px solid #ddd;text-align:center;font-size:12px;height:20px;line-height:20px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]{flex:1;padding-left:30px;height:100%;border-left:1px solid #ddd}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]{margin-bottom:10px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]{display:flex;min-height:50px;align-items:center;border-bottom:1px solid #eee}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   .list-title[_ngcontent-%COMP%]{width:80px}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-block;padding:5px 15px;margin-right:12px;cursor:pointer}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{background-color:#1890ff;border-radius:5px;color:#fff}.resource-container[_ngcontent-%COMP%]   .right-resource[_ngcontent-%COMP%]   .search-container[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   .list-content[_ngcontent-%COMP%]{flex-grow:2}.btn-group[_ngcontent-%COMP%]{display:flex;justify-content:center}.btn-group[_ngcontent-%COMP%]   .margin-btn[_ngcontent-%COMP%]{margin-left:15px}.header-container[_ngcontent-%COMP%]{height:60px;font-size:18px;padding-left:20px;line-height:60px;border-bottom:1px solid #ddd}"]}),t})();function sn(t,e){if(1&t&&c.Vb(0,"iframe",3),2&t){const t=c.lc();c.tc("src",t.url,c.Gc)}}const ln=[{path:"read",component:st},{path:"case",component:Ot},{path:"setting",component:Ye},{path:"exercise",component:(()=>{class t{constructor(t){this.sanitizer=t,this._PAGE_ID_="ExerciseLibraryComponent",this.orgCode=g.a.getOrgCode(),this.codeMap={cjsd:1,zksd:2,zxjy:3,hgls:4,qm:5},this.tokenObj=tn.a.getTkToken(),this.getUrl()}getUrl(){return Object(a.a)(this,void 0,void 0,(function*(){const t=yield g.a.getProdIdSync();this.url=this.sanitizer.bypassSecurityTrustResourceUrl(p.a.questionBank+"/#/questionList?proId="+t+"&token="+this.tokenObj.token+"&refreshToken="+this.tokenObj.refreshToken+"&show_layout=false")}))}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(Le.b))},t.\u0275cmp=c.Ob({type:t,selectors:[["app-exercise-library"]],decls:3,vars:1,consts:[["id","fullContainer",1,"container"],[1,"body"],["allowfullscreen","true","style","width: 100%;height:100%;border: none;min-height: 680px;",3,"src",4,"ngIf"],["allowfullscreen","true",2,"width","100%","height","100%","border","none","min-height","680px",3,"src"]],template:function(t,e){1&t&&(c.ac(0,"div",0),c.ac(1,"div",1),c.Nc(2,sn,1,1,"iframe",2),c.Zb(),c.Zb()),2&t&&(c.Eb(2),c.tc("ngIf",e.url))},directives:[v.n],styles:[".container[_ngcontent-%COMP%]{background-color:#fff;height:100%;width:100%;overflow:scroll}.container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center;height:100%}"]}),t})()},{path:"save-train/:type/:id/:professionId",component:rn},{path:"material-details/:id/:type/:professionId",component:Pe},{path:"material-pre-case/:id/:type/:professionId",component:Ze},{path:"material-pre-other/:id/:type/:professionId",component:De},{path:"**",component:Ne.a,data:{title:"404"}}];let dn=(()=>{class t{}return t.\u0275mod=c.Sb({type:t}),t.\u0275inj=c.Rb({factory:function(e){return new(e||t)},imports:[[o.l.forChild(ln)],o.l]}),t})();var hn=n("r1OT");let gn=(()=>{class t{}return t.\u0275mod=c.Sb({type:t}),t.\u0275inj=c.Rb({factory:function(e){return new(e||t)},imports:[[i.a,hn.d,dn,hn.c,Lt.b,A]]}),t})()},xKc1:function(t,e,n){t.exports=function(){"use strict";var t=function(){},e=Object.prototype.hasOwnProperty,n=Array.prototype.slice;function i(t,i,o){for(var a,c,r=0,s=(o=n.call(arguments,2)).length;r<s;r++)for(a in c=o[r])t&&!e.call(c,a)||(i[a]=c[a])}function o(){}o.class_="Nevis",o.super_=Object,o.extend=function(e,n,o,a){var c=this;return"string"!=typeof e&&(a=o,o=n,n=e,e=null),"function"!=typeof n&&(a=o,o=n,n=function(){return c.apply(this,arguments)}),i(!1,n,c,a),n.prototype=function(e,n){var o;return"function"==typeof Object.create?o=Object.create(e):(t.prototype=e,o=new t,t.prototype=null),n&&i(!0,o,n),o}(c.prototype,o),n.prototype.constructor=n,n.class_=e||c.class_,n.super_=c,n};var a=o,c=a.extend((function(t,e,n){this.qrious=t,this.element=e,this.element.qrious=t,this.enabled=Boolean(n)}),{draw:function(t){},getElement:function(){return this.enabled||(this.enabled=!0,this.render()),this.element},getModuleSize:function(t){var e=this.qrious,n=Math.floor((e.size-2*(e.padding||0))/t.width);return Math.max(1,n)},getOffset:function(t){var e=this.qrious,n=e.padding;if(null!=n)return n;var i=this.getModuleSize(t),o=Math.floor((e.size-i*t.width)/2);return Math.max(0,o)},render:function(t){this.enabled&&(this.resize(),this.reset(),this.draw(t))},reset:function(){},resize:function(){}}),r=c.extend({draw:function(t){var e,n,i=this.qrious,o=this.getModuleSize(t),a=this.getOffset(t),c=this.element.getContext("2d");for(c.fillStyle=i.foreground,c.globalAlpha=i.foregroundAlpha,e=0;e<t.width;e++)for(n=0;n<t.width;n++)t.buffer[n*t.width+e]&&c.fillRect(o*e+a,o*n+a,o,o)},reset:function(){var t=this.qrious,e=this.element.getContext("2d"),n=t.size;e.lineWidth=1,e.clearRect(0,0,n,n),e.fillStyle=t.background,e.globalAlpha=t.backgroundAlpha,e.fillRect(0,0,n,n)},resize:function(){var t=this.element;t.width=t.height=this.qrious.size}}),s=a.extend(null,{BLOCK:[0,11,15,19,23,27,31,16,18,20,22,24,26,28,20,22,24,24,26,28,28,22,24,24,26,26,28,28,24,24,26,26,26,28,28,24,26,26,26,28,28]}),l=a.extend(null,{BLOCKS:[1,0,19,7,1,0,16,10,1,0,13,13,1,0,9,17,1,0,34,10,1,0,28,16,1,0,22,22,1,0,16,28,1,0,55,15,1,0,44,26,2,0,17,18,2,0,13,22,1,0,80,20,2,0,32,18,2,0,24,26,4,0,9,16,1,0,108,26,2,0,43,24,2,2,15,18,2,2,11,22,2,0,68,18,4,0,27,16,4,0,19,24,4,0,15,28,2,0,78,20,4,0,31,18,2,4,14,18,4,1,13,26,2,0,97,24,2,2,38,22,4,2,18,22,4,2,14,26,2,0,116,30,3,2,36,22,4,4,16,20,4,4,12,24,2,2,68,18,4,1,43,26,6,2,19,24,6,2,15,28,4,0,81,20,1,4,50,30,4,4,22,28,3,8,12,24,2,2,92,24,6,2,36,22,4,6,20,26,7,4,14,28,4,0,107,26,8,1,37,22,8,4,20,24,12,4,11,22,3,1,115,30,4,5,40,24,11,5,16,20,11,5,12,24,5,1,87,22,5,5,41,24,5,7,24,30,11,7,12,24,5,1,98,24,7,3,45,28,15,2,19,24,3,13,15,30,1,5,107,28,10,1,46,28,1,15,22,28,2,17,14,28,5,1,120,30,9,4,43,26,17,1,22,28,2,19,14,28,3,4,113,28,3,11,44,26,17,4,21,26,9,16,13,26,3,5,107,28,3,13,41,26,15,5,24,30,15,10,15,28,4,4,116,28,17,0,42,26,17,6,22,28,19,6,16,30,2,7,111,28,17,0,46,28,7,16,24,30,34,0,13,24,4,5,121,30,4,14,47,28,11,14,24,30,16,14,15,30,6,4,117,30,6,14,45,28,11,16,24,30,30,2,16,30,8,4,106,26,8,13,47,28,7,22,24,30,22,13,15,30,10,2,114,28,19,4,46,28,28,6,22,28,33,4,16,30,8,4,122,30,22,3,45,28,8,26,23,30,12,28,15,30,3,10,117,30,3,23,45,28,4,31,24,30,11,31,15,30,7,7,116,30,21,7,45,28,1,37,23,30,19,26,15,30,5,10,115,30,19,10,47,28,15,25,24,30,23,25,15,30,13,3,115,30,2,29,46,28,42,1,24,30,23,28,15,30,17,0,115,30,10,23,46,28,10,35,24,30,19,35,15,30,17,1,115,30,14,21,46,28,29,19,24,30,11,46,15,30,13,6,115,30,14,23,46,28,44,7,24,30,59,1,16,30,12,7,121,30,12,26,47,28,39,14,24,30,22,41,15,30,6,14,121,30,6,34,47,28,46,10,24,30,2,64,15,30,17,4,122,30,29,14,46,28,49,10,24,30,24,46,15,30,4,18,122,30,13,32,46,28,48,14,24,30,42,32,15,30,20,4,117,30,40,7,47,28,43,22,24,30,10,67,15,30,19,6,118,30,18,31,47,28,34,34,24,30,20,61,15,30],FINAL_FORMAT:[30660,29427,32170,30877,26159,25368,27713,26998,21522,20773,24188,23371,17913,16590,20375,19104,13663,12392,16177,14854,9396,8579,11994,11245,5769,5054,7399,6608,1890,597,3340,2107],LEVELS:{L:1,M:2,Q:3,H:4}}),d=a.extend(null,{EXPONENT:[1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,0],LOG:[255,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182,163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117,44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175]}),h=a.extend(null,{BLOCK:[3220,1468,2713,1235,3062,1890,2119,1549,2344,2936,1117,2583,1330,2470,1667,2249,2028,3780,481,4011,142,3098,831,3445,592,2517,1776,2234,1951,2827,1070,2660,1345,3177]}),g=a.extend((function(t){var e,n,i,o,a,c=t.value.length;for(this._badness=[],this._level=l.LEVELS[t.level],this._polynomial=[],this._value=t.value,this._version=0,this._stringBuffer=[];this._version<40&&(this._version++,i=4*(this._level-1)+16*(this._version-1),o=l.BLOCKS[i++],a=l.BLOCKS[i++],e=l.BLOCKS[i++],n=l.BLOCKS[i],!(c<=(i=e*(o+a)+a-3+(this._version<=9)))););this._dataBlock=e,this._eccBlock=n,this._neccBlock1=o,this._neccBlock2=a;var r=this.width=17+4*this._version;this.buffer=g._createArray(r*r),this._ecc=g._createArray(e+(e+n)*(o+a)+a),this._mask=g._createArray((r*(r+1)+1)/2),this._insertFinders(),this._insertAlignments(),this.buffer[8+r*(r-8)]=1,this._insertTimingGap(),this._reverseMask(),this._insertTimingRowAndColumn(),this._insertVersion(),this._syncMask(),this._convertBitStream(c),this._calculatePolynomial(),this._appendEccToData(),this._interleaveBlocks(),this._pack(),this._finish()}),{_addAlignment:function(t,e){var n,i=this.buffer,o=this.width;for(i[t+o*e]=1,n=-2;n<2;n++)i[t+n+o*(e-2)]=1,i[t-2+o*(e+n+1)]=1,i[t+2+o*(e+n)]=1,i[t+n+1+o*(e+2)]=1;for(n=0;n<2;n++)this._setMask(t-1,e+n),this._setMask(t+1,e-n),this._setMask(t-n,e-1),this._setMask(t+n,e+1)},_appendData:function(t,e,n,i){var o,a,c,r=this._polynomial,s=this._stringBuffer;for(a=0;a<i;a++)s[n+a]=0;for(a=0;a<e;a++){if(255!==(o=d.LOG[s[t+a]^s[n]]))for(c=1;c<i;c++)s[n+c-1]=s[n+c]^d.EXPONENT[g._modN(o+r[i-c])];else for(c=n;c<n+i;c++)s[c]=s[c+1];s[n+i-1]=255===o?0:d.EXPONENT[g._modN(o+r[0])]}},_appendEccToData:function(){var t,e=0,n=this._dataBlock,i=this._calculateMaxLength(),o=this._eccBlock;for(t=0;t<this._neccBlock1;t++)this._appendData(e,n,i,o),e+=n,i+=o;for(t=0;t<this._neccBlock2;t++)this._appendData(e,n+1,i,o),e+=n+1,i+=o},_applyMask:function(t){var e,n,i,o,a=this.buffer,c=this.width;switch(t){case 0:for(o=0;o<c;o++)for(i=0;i<c;i++)i+o&1||this._isMasked(i,o)||(a[i+o*c]^=1);break;case 1:for(o=0;o<c;o++)for(i=0;i<c;i++)1&o||this._isMasked(i,o)||(a[i+o*c]^=1);break;case 2:for(o=0;o<c;o++)for(e=0,i=0;i<c;i++,e++)3===e&&(e=0),e||this._isMasked(i,o)||(a[i+o*c]^=1);break;case 3:for(n=0,o=0;o<c;o++,n++)for(3===n&&(n=0),e=n,i=0;i<c;i++,e++)3===e&&(e=0),e||this._isMasked(i,o)||(a[i+o*c]^=1);break;case 4:for(o=0;o<c;o++)for(e=0,n=o>>1&1,i=0;i<c;i++,e++)3===e&&(e=0,n=!n),n||this._isMasked(i,o)||(a[i+o*c]^=1);break;case 5:for(n=0,o=0;o<c;o++,n++)for(3===n&&(n=0),e=0,i=0;i<c;i++,e++)3===e&&(e=0),(i&o&1)+!(!e|!n)||this._isMasked(i,o)||(a[i+o*c]^=1);break;case 6:for(n=0,o=0;o<c;o++,n++)for(3===n&&(n=0),e=0,i=0;i<c;i++,e++)3===e&&(e=0),(i&o&1)+(e&&e===n)&1||this._isMasked(i,o)||(a[i+o*c]^=1);break;case 7:for(n=0,o=0;o<c;o++,n++)for(3===n&&(n=0),e=0,i=0;i<c;i++,e++)3===e&&(e=0),(e&&e===n)+(i+o&1)&1||this._isMasked(i,o)||(a[i+o*c]^=1)}},_calculateMaxLength:function(){return this._dataBlock*(this._neccBlock1+this._neccBlock2)+this._neccBlock2},_calculatePolynomial:function(){var t,e,n=this._eccBlock,i=this._polynomial;for(i[0]=1,t=0;t<n;t++){for(i[t+1]=1,e=t;e>0;e--)i[e]=i[e]?i[e-1]^d.EXPONENT[g._modN(d.LOG[i[e]]+t)]:i[e-1];i[0]=d.EXPONENT[g._modN(d.LOG[i[0]]+t)]}for(t=0;t<=n;t++)i[t]=d.LOG[i[t]]},_checkBadness:function(){var t,e,n,i,o,a=0,c=this._badness,r=this.buffer,s=this.width;for(o=0;o<s-1;o++)for(i=0;i<s-1;i++)(r[i+s*o]&&r[i+1+s*o]&&r[i+s*(o+1)]&&r[i+1+s*(o+1)]||!(r[i+s*o]||r[i+1+s*o]||r[i+s*(o+1)]||r[i+1+s*(o+1)]))&&(a+=g.N2);var l=0;for(o=0;o<s;o++){for(n=0,c[0]=0,t=0,i=0;i<s;i++)t===(e=r[i+s*o])?c[n]++:c[++n]=1,l+=(t=e)?1:-1;a+=this._getBadness(n)}l<0&&(l=-l);var d=0,h=l;for(h+=h<<2,h<<=1;h>s*s;)h-=s*s,d++;for(a+=d*g.N4,i=0;i<s;i++){for(n=0,c[0]=0,t=0,o=0;o<s;o++)t===(e=r[i+s*o])?c[n]++:c[++n]=1,t=e;a+=this._getBadness(n)}return a},_convertBitStream:function(t){var e,n,i=this._ecc,o=this._version;for(n=0;n<t;n++)i[n]=this._value.charCodeAt(n);var a=this._stringBuffer=i.slice(),c=this._calculateMaxLength();t>=c-2&&(t=c-2,o>9&&t--);var r=t;if(o>9){for(a[r+2]=0,a[r+3]=0;r--;)a[r+3]|=255&(e=a[r])<<4,a[r+2]=e>>4;a[2]|=255&t<<4,a[1]=t>>4,a[0]=64|t>>12}else{for(a[r+1]=0,a[r+2]=0;r--;)a[r+2]|=255&(e=a[r])<<4,a[r+1]=e>>4;a[1]|=255&t<<4,a[0]=64|t>>4}for(r=t+3-(o<10);r<c;)a[r++]=236,a[r++]=17},_getBadness:function(t){var e,n=0,i=this._badness;for(e=0;e<=t;e++)i[e]>=5&&(n+=g.N1+i[e]-5);for(e=3;e<t-1;e+=2)i[e-2]===i[e+2]&&i[e+2]===i[e-1]&&i[e-1]===i[e+1]&&3*i[e-1]===i[e]&&(0===i[e-3]||e+3>t||3*i[e-3]>=4*i[e]||3*i[e+3]>=4*i[e])&&(n+=g.N3);return n},_finish:function(){var t,e;this._stringBuffer=this.buffer.slice();var n=0,i=3e4;for(e=0;e<8&&(this._applyMask(e),(t=this._checkBadness())<i&&(i=t,n=e),7!==n);e++)this.buffer=this._stringBuffer.slice();n!==e&&this._applyMask(n),i=l.FINAL_FORMAT[n+(this._level-1<<3)];var o=this.buffer,a=this.width;for(e=0;e<8;e++,i>>=1)1&i&&(o[a-1-e+8*a]=1,e<6?o[8+a*e]=1:o[8+a*(e+1)]=1);for(e=0;e<7;e++,i>>=1)1&i&&(o[8+a*(a-7+e)]=1,e?o[6-e+8*a]=1:o[7+8*a]=1)},_interleaveBlocks:function(){var t,e,n=this._dataBlock,i=this._ecc,o=this._eccBlock,a=0,c=this._calculateMaxLength(),r=this._neccBlock1,s=this._neccBlock2,l=this._stringBuffer;for(t=0;t<n;t++){for(e=0;e<r;e++)i[a++]=l[t+e*n];for(e=0;e<s;e++)i[a++]=l[r*n+t+e*(n+1)]}for(e=0;e<s;e++)i[a++]=l[r*n+t+e*(n+1)];for(t=0;t<o;t++)for(e=0;e<r+s;e++)i[a++]=l[c+t+e*o];this._stringBuffer=i},_insertAlignments:function(){var t,e,n,i=this._version,o=this.width;if(i>1)for(t=s.BLOCK[i],n=o-7;;){for(e=o-7;e>t-3&&(this._addAlignment(e,n),!(e<t));)e-=t;if(n<=t+9)break;this._addAlignment(6,n-=t),this._addAlignment(n,6)}},_insertFinders:function(){var t,e,n,i,o=this.buffer,a=this.width;for(t=0;t<3;t++){for(e=0,i=0,1===t&&(e=a-7),2===t&&(i=a-7),o[i+3+a*(e+3)]=1,n=0;n<6;n++)o[i+n+a*e]=1,o[i+a*(e+n+1)]=1,o[i+6+a*(e+n)]=1,o[i+n+1+a*(e+6)]=1;for(n=1;n<5;n++)this._setMask(i+n,e+1),this._setMask(i+1,e+n+1),this._setMask(i+5,e+n),this._setMask(i+n+1,e+5);for(n=2;n<4;n++)o[i+n+a*(e+2)]=1,o[i+2+a*(e+n+1)]=1,o[i+4+a*(e+n)]=1,o[i+n+1+a*(e+4)]=1}},_insertTimingGap:function(){var t,e,n=this.width;for(e=0;e<7;e++)this._setMask(7,e),this._setMask(n-8,e),this._setMask(7,e+n-7);for(t=0;t<8;t++)this._setMask(t,7),this._setMask(t+n-8,7),this._setMask(t,n-8)},_insertTimingRowAndColumn:function(){var t,e=this.buffer,n=this.width;for(t=0;t<n-14;t++)1&t?(this._setMask(8+t,6),this._setMask(6,8+t)):(e[8+t+6*n]=1,e[6+n*(8+t)]=1)},_insertVersion:function(){var t,e,n,i,o=this.buffer,a=this._version,c=this.width;if(a>6)for(t=h.BLOCK[a-7],e=17,n=0;n<6;n++)for(i=0;i<3;i++,e--)1&(e>11?a>>e-12:t>>e)?(o[5-n+c*(2-i+c-11)]=1,o[2-i+c-11+c*(5-n)]=1):(this._setMask(5-n,2-i+c-11),this._setMask(2-i+c-11,5-n))},_isMasked:function(t,e){var n=g._getMaskBit(t,e);return 1===this._mask[n]},_pack:function(){var t,e,n,i=1,o=1,a=this.width,c=a-1,r=a-1,s=(this._dataBlock+this._eccBlock)*(this._neccBlock1+this._neccBlock2)+this._neccBlock2;for(e=0;e<s;e++)for(t=this._stringBuffer[e],n=0;n<8;n++,t<<=1){128&t&&(this.buffer[c+a*r]=1);do{o?c--:(c++,i?0!==r?r--:(i=!i,6==(c-=2)&&(c--,r=9)):r!==a-1?r++:(i=!i,6==(c-=2)&&(c--,r-=8))),o=!o}while(this._isMasked(c,r))}},_reverseMask:function(){var t,e,n=this.width;for(t=0;t<9;t++)this._setMask(t,8);for(t=0;t<8;t++)this._setMask(t+n-8,8),this._setMask(8,t);for(e=0;e<7;e++)this._setMask(8,e+n-7)},_setMask:function(t,e){var n=g._getMaskBit(t,e);this._mask[n]=1},_syncMask:function(){var t,e,n=this.width;for(e=0;e<n;e++)for(t=0;t<=e;t++)this.buffer[t+n*e]&&this._setMask(t,e)}},{_createArray:function(t){var e,n=[];for(e=0;e<t;e++)n[e]=0;return n},_getMaskBit:function(t,e){var n;return t>e&&(n=t,t=e,e=n),n=e,n+=e*e,(n>>=1)+t},_modN:function(t){for(;t>=255;)t=((t-=255)>>8)+(255&t);return t},N1:3,N2:3,N3:40,N4:10}),u=g,p=c.extend({draw:function(){this.element.src=this.qrious.toDataURL()},reset:function(){this.element.src=""},resize:function(){var t=this.element;t.width=t.height=this.qrious.size}}),f=a.extend((function(t,e,n,i){this.name=t,this.modifiable=Boolean(e),this.defaultValue=n,this._valueTransformer=i}),{transform:function(t){var e=this._valueTransformer;return"function"==typeof e?e(t,this):t}}),b=a.extend(null,{abs:function(t){return null!=t?Math.abs(t):null},hasOwn:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},noop:function(){},toUpperCase:function(t){return null!=t?t.toUpperCase():null}}),m=a.extend((function(t){this.options={},t.forEach((function(t){this.options[t.name]=t}),this)}),{exists:function(t){return null!=this.options[t]},get:function(t,e){return m._get(this.options[t],e)},getAll:function(t){var e,n=this.options,i={};for(e in n)b.hasOwn(n,e)&&(i[e]=m._get(n[e],t));return i},init:function(t,e,n){var i,o;for(i in"function"!=typeof n&&(n=b.noop),this.options)b.hasOwn(this.options,i)&&(m._set(o=this.options[i],o.defaultValue,e),m._createAccessor(o,e,n));this._setAll(t,e,!0)},set:function(t,e,n){return this._set(t,e,n)},setAll:function(t,e){return this._setAll(t,e)},_set:function(t,e,n,i){var o=this.options[t];if(!o)throw new Error("Invalid option: "+t);if(!o.modifiable&&!i)throw new Error("Option cannot be modified: "+t);return m._set(o,e,n)},_setAll:function(t,e,n){if(!t)return!1;var i,o=!1;for(i in t)b.hasOwn(t,i)&&this._set(i,t[i],e,n)&&(o=!0);return o}},{_createAccessor:function(t,e,n){var i={get:function(){return m._get(t,e)}};t.modifiable&&(i.set=function(i){m._set(t,i,e)&&n(i,t)}),Object.defineProperty(e,t.name,i)},_get:function(t,e){return e["_"+t.name]},_set:function(t,e,n){var i="_"+t.name,o=n[i],a=t.transform(null!=e?e:t.defaultValue);return n[i]=a,a!==o}}),z=m,P=a.extend((function(){this._services={}}),{getService:function(t){var e=this._services[t];if(!e)throw new Error("Service is not being managed with name: "+t);return e},setService:function(t,e){if(this._services[t])throw new Error("Service is already managed with name: "+t);e&&(this._services[t]=e)}}),C=new z([new f("background",!0,"white"),new f("backgroundAlpha",!0,1,b.abs),new f("element"),new f("foreground",!0,"black"),new f("foregroundAlpha",!0,1,b.abs),new f("level",!0,"L",b.toUpperCase),new f("mime",!0,"image/png"),new f("padding",!0,null,b.abs),new f("size",!0,100,b.abs),new f("value",!0,"")]),v=new P,y=a.extend((function(t){C.init(t,this,this.update.bind(this));var e=C.get("element",this),n=v.getService("element"),i=e&&n.isCanvas(e)?e:n.createCanvas(),o=e&&n.isImage(e)?e:n.createImage();this._canvasRenderer=new r(this,i,!0),this._imageRenderer=new p(this,o,o===e),this.update()}),{get:function(){return C.getAll(this)},set:function(t){C.setAll(t,this)&&this.update()},toDataURL:function(t){return this.canvas.toDataURL(t||this.mime)},update:function(){var t=new u({level:this.level,value:this.value});this._canvasRenderer.render(t),this._imageRenderer.render(t)}},{use:function(t){v.setService(t.getName(),t)}});Object.defineProperties(y.prototype,{canvas:{get:function(){return this._canvasRenderer.getElement()}},image:{get:function(){return this._imageRenderer.getElement()}}});var w=y,O=a.extend({getName:function(){}}).extend({createCanvas:function(){},createImage:function(){},getName:function(){return"element"},isCanvas:function(t){},isImage:function(t){}}).extend({createCanvas:function(){return document.createElement("canvas")},createImage:function(){return document.createElement("img")},isCanvas:function(t){return t instanceof HTMLCanvasElement},isImage:function(t){return t instanceof HTMLImageElement}});return w.use(new O),w}()}}]);
//# sourceMappingURL=13-es2015.caf4c1a0ec5ee1ed632f.js.map