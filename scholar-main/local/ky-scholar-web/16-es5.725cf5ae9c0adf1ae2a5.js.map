{"version":3,"sources":["webpack:///layout/study-outline/study-outline.component.html","webpack:///layout/study-outline/study-outline.component.ts","webpack:///layout/study-outline/study-outline.module.ts","webpack:///layout/study-outline/study-outline-routes.module.ts"],"names":["StudyOutlineComponent","StudyOutlineModule","StudyOutlineRoutingModule","message","courseMgService","aliOss","courseData","getPacketInfo","outline","isVisible","chineseNumber","handouts","handoutsMaterial","handoutsRecording","this","getChapter","chapters","index","children","chapterChange","section","data","download","knowledge","window","open","id","attachmentPath","getList_courseChapter","subscribe","res","status","forEach","length","chapter","forkJoin","getList_courseSection","sectionFileList_courseSectionFile","res2","res1","idList","push","countTheNumberOfKnowledgePoints","every","child","j","courseSectionId","knowledgePointCount","result","filter","itemM","type","itemR","sort","a","b","seq","setExtendData","itemMa","showData","height","routes","path","pathMatch","component","title","forChild"],"mappings":"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","file":"x","sourcesContent":["<div class=\"outline-container\"\r\n     *ngFor=\"let chapters of outline;let i = index\">\r\n  <div class=\"item\"\r\n       (click)=\"switchChapters(chapters,i)\"\r\n       [ngClass]=\"{'close': chapters.open || !chapters.children}\">\r\n    <span>第{{chineseNumber[i]}}章：{{chapters.name}}</span>\r\n    <i nz-icon\r\n       *ngIf=\"chapters.open \"\r\n       nzType=\"up\"\r\n       nzTheme=\"outline\">\r\n    </i>\r\n    <i nz-icon\r\n       *ngIf=\"!chapters.open\"\r\n       nzType=\"down\"\r\n       nzTheme=\"outline\">\r\n    </i>\r\n  </div>\r\n  <div class=\"outline-detail\"\r\n       *ngIf=\"chapters.children &&\r\n      chapters.children.length > 0 && chapters.open\"\r\n  >\r\n    <div class=\"chapters\"\r\n         *ngFor=\"let section of chapters.children,let s=index\">\r\n      <div class=\"section-name\">\r\n        <span>\r\n          <span class=\"name\">第{{chineseNumber[s]}}节：{{section.name}}</span>\r\n          <span class=\"size\" *ngIf=\"courseData.isSmart == '1'\">{{section.knowledgePointCount || 0}}个知识点</span>\r\n        </span>\r\n        <span class=\"document\" (click)=\"showData(section)\" *ngIf='section?.handoutsMaterial?.length'>\r\n          <i nz-icon nzType=\"folder\" nzTheme=\"outline\"></i>\r\n          <span>资料</span>\r\n        </span>\r\n      </div>\r\n      <div class=\"\">\r\n        <div class=\"section\">\r\n          <div class=\"item\"\r\n               *ngFor=\"let knowledge of section.handoutsRecording\"\r\n               (click)=\"goToBreakthrough(knowledge,section)\">\r\n            <i nz-icon nzType=\"play-circle\" nzTheme=\"outline\"></i>\r\n            <div class=\"description\">\r\n              <span class=\"name\"\r\n                    [ngStyle]=\"{color:'#3A3C42'}\">{{knowledge.title}}</span>\r\n              <span class=\"time\">{{knowledge.videoLength || 0}}分钟</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<nz-modal\r\n  [(nzVisible)]=\"isVisible\"\r\n  [nzTitle]=\"modalTitle\"\r\n  [nzContent]=\"modalContent\"\r\n  [nzFooter]=\"null\"\r\n  nzClassName=\"data\"\r\n  (nzOnCancel)=\"showData('')\"\r\n>\r\n  <ng-template #modalTitle>\r\n    资料\r\n  </ng-template>\r\n  <ng-template #modalContent>\r\n    <div class=\"box-inner\">\r\n      <ul>\r\n        <li *ngFor=\"let item of handoutsMaterial, let i=index\" (click)=\"download(item)\">\r\n          <img src=\"assets/images/file.png\" alt=\"\">\r\n          {{item.attachmentName}}\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  </ng-template>\r\n</nz-modal>\r\n","import {Component, OnInit, Input, Output, EventEmitter} from '@angular/core';\r\nimport {trigger, state, style, transition, animate} from '@angular/animations';\r\nimport {NzMessageService} from 'ng-zorro-antd/message';\r\nimport {SessionStorageUtil} from 'core/utils/sessionstorage.util';\r\nimport {AliOssService} from 'core/services/ali-oss.service';\r\nimport {CourseManageService} from '@app/busi-services';\r\nimport {forkJoin} from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-study-outline-recorded',\r\n  templateUrl: './study-outline.component.html',\r\n  styleUrls: ['./study-outline.component.less'],\r\n  animations: [\r\n    trigger('collapse', [\r\n      state('open', style({\r\n        height: 0\r\n      })),\r\n      state('close', style({\r\n        height: 'auto'\r\n      })),\r\n      transition('open <=> close', [\r\n        animate('0.3s')\r\n      ])\r\n    ])\r\n  ]\r\n})\r\nexport class StudyOutlineComponent implements OnInit {\r\n  courseData = SessionStorageUtil.getPacketInfo();\r\n  outline: Array<any> = [];// 所有章\r\n  isVisible = false;\r\n  chineseNumber = ['一', '二', '三', '四', '五', '六', '七', '八', '九', '十',\r\n    '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十',\r\n    '二十一', '二十二', '二十三', '二十四', '二十五', '二十六', '二十七', '二十八', '二十九', '三十'];\r\n  handouts = []; // 所有资料\r\n  handoutsMaterial = []; // 章下资料\r\n  handoutsRecording = []; // 章下录播\r\n\r\n\r\n  constructor(\r\n    private message: NzMessageService,\r\n    private courseMgService: CourseManageService,\r\n    private aliOss: AliOssService,\r\n  ) {\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.getChapter();\r\n  }\r\n\r\n  switchChapters(chapters, index: number): void {\r\n    if (this.outline[index]['open']) {\r\n      this.outline[index]['open'] = false;\r\n    } else {\r\n      this.outline[index]['open'] = true;\r\n    }\r\n    if (!chapters.children) {\r\n      this.chapterChange(this.outline[index]);\r\n    }\r\n  }\r\n\r\n  showData(section) {\r\n    this.isVisible = !this.isVisible;\r\n    if (!section) {\r\n      return false;\r\n    }\r\n    this.handoutsMaterial = section.handoutsMaterial;\r\n  }\r\n\r\n// 下载节的资料\r\n  download(data) {\r\n    this.aliOss.download(data);\r\n  }\r\n\r\n  goToBreakthrough(knowledge, section) {\r\n    const url = `#/chapter-study/${section.id}/2${knowledge.attachmentPath ? '/' + knowledge.attachmentPath : ''}`;\r\n    window.open(url);\r\n  }\r\n\r\n// 获取所有章\r\n  getChapter(): void {\r\n    this.courseMgService.getList_courseChapter(this.courseData.id).subscribe(res => {\r\n      if (res.status === 200) {\r\n        res.data.forEach(data => {\r\n          data.open = false;\r\n        });\r\n        this.outline = res.data;\r\n        if (this.outline.length > 0) {\r\n          this.outline[0].open = true;\r\n          if (!this.outline[0].children || this.outline[0].children.length === 0) {\r\n            this.chapterChange(this.outline[0]);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n// 获取章下详细信息\r\n  private chapterChange(chapter) {\r\n    forkJoin(\r\n      [this.courseMgService.getList_courseSection(chapter.id), // 获取章下所有节\r\n        this.courseMgService.sectionFileList_courseSectionFile(null, chapter.id)] // 获取章下所有资料\r\n    ).subscribe(([res1, res2]) => {\r\n      if (res1.status === 200) {\r\n        chapter.children = res1.data || [];\r\n        if (chapter.children.length) {\r\n          const idList = [];\r\n          chapter.children.forEach(children => {\r\n            idList.push(children.id);\r\n          });\r\n          this.courseMgService.countTheNumberOfKnowledgePoints(idList).subscribe((res) => {\r\n            if (res.status === 200) {\r\n              res.data.forEach((data, index) => {\r\n                chapter.children.every((child, j) => {\r\n                  if (child.id === data.courseSectionId) {\r\n                    chapter.children[j].knowledgePointCount = data.knowledgePointCount; // 增加节的知识点统计\r\n                  } else {\r\n                    return true;\r\n                  }\r\n                });\r\n              });\r\n            }\r\n          });\r\n        }\r\n      }\r\n      if (res2.status === 200) {\r\n        const result = res2.data || [];\r\n        chapter.handoutsMaterial = result.filter(itemM => itemM.type === '102'); // 章下录播\r\n        chapter.handoutsRecording = result.filter(itemR => itemR.type === '103').sort((a, b) => {\r\n          if (a.seq > b.seq) {\r\n            return -1;\r\n          }\r\n          if (a.seq < b.seq) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        }); // 章下资料\r\n        this.setExtendData(chapter, 'handoutsMaterial');  // 把对应资料放到对应节\r\n        this.setExtendData(chapter, 'handoutsRecording'); // 把对应录播放到对应节\r\n      }\r\n    });\r\n  }\r\n\r\n  private setExtendData(chapter, type) {\r\n    chapter[type].forEach((itemMa,) => {\r\n      if (chapter.children.length) {\r\n        chapter.children.every((child, j) => {\r\n          if (child.id === itemMa.courseSectionId) {\r\n            if (chapter.children[j][type]) {\r\n              chapter.children[j][type].push(itemMa);\r\n            } else {\r\n              chapter.children[j][type] = [itemMa];\r\n            }\r\n          } else {\r\n            return true;\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n}\r\n","import {NgModule} from '@angular/core';\r\nimport {CourseManageService} from '@app/busi-services';\r\nimport {StudyOutlineComponent} from './study-outline.component';\r\nimport {SharedModule} from '@app/shared/shared.module';\r\nimport {StudyOutlineRoutingModule} from './study-outline-routes.module';\r\n\r\n@NgModule({\r\n  declarations: [ StudyOutlineComponent],\r\n  imports: [\r\n    StudyOutlineRoutingModule,\r\n    SharedModule,\r\n  ],\r\n  providers: [ CourseManageService]\r\n})\r\nexport class StudyOutlineModule {\r\n}\r\n","import {NgModule} from '@angular/core';\r\nimport {Routes, RouterModule} from '@angular/router';\r\nimport {StudyOutlineComponent} from './study-outline.component';\r\nimport {NoFoundComponent} from '../404/404.component';\r\nimport {StudyOutlineFl} from '../study-outline-fl/study-outline-fl.component';\r\n\r\nconst routes: Routes = [\r\n  {path: 'outline', pathMatch: 'full', component: StudyOutlineComponent},\r\n  {path: 'outline-fl', component: StudyOutlineFl},\r\n  {\r\n    path: '**',\r\n    component: NoFoundComponent,\r\n    data: {title: '404'}\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class StudyOutlineRoutingModule {\r\n}\r\n"]}